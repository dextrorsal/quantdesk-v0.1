<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Devnet-Deployment-Guide - QuantDesk Documentation</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <style>
        body {
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace;
            line-height: 1.6;
            color: #ffffff;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #000000;
            font-size: 14px;
        }
        .container {
            background: #000000;
            padding: 30px;
            border-radius: 8px;
            border: 1px solid #333333;
        }
        .back-link {
            margin-bottom: 20px;
        }
        .back-link a {
            color: #3b82f6;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s ease;
        }
        .back-link a:hover {
            color: #60a5fa;
            text-decoration: underline;
        }
        h1, h2, h3, h4, h5, h6 {
            color: #ffffff;
            margin-top: 30px;
            margin-bottom: 15px;
            font-weight: 600;
        }
        h1 {
            border-bottom: 2px solid #333333;
            padding-bottom: 10px;
        }
        h2 {
            border-bottom: 1px solid #333333;
            padding-bottom: 8px;
        }
        code {
            background: #1a1a1a;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace;
            color: #ffffff;
            border: 1px solid #333333;
        }
        pre {
            background: #0a0a0a;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            border: 1px solid #333333;
            margin: 20px 0;
        }
        pre code {
            background: none;
            padding: 0;
            color: #ffffff;
            border: none;
        }
        blockquote {
            border-left: 4px solid #3b82f6;
            margin: 0;
            padding-left: 20px;
            color: #d9d9d9;
            background: #1a1a1a;
            padding: 15px 20px;
            border-radius: 0 8px 8px 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            border: 1px solid #333333;
        }
        th, td {
            border: 1px solid #333333;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #1a1a1a;
            font-weight: bold;
            color: #ffffff;
        }
        td {
            color: #d9d9d9;
        }
        ul, ol {
            color: #d9d9d9;
        }
        li {
            margin-bottom: 8px;
        }
        a {
            color: #3b82f6;
            text-decoration: none;
        }
        a:hover {
            color: #60a5fa;
            text-decoration: underline;
        }
        /* Syntax Highlighting Overrides */
        pre[class*="language-"] {
            background: #0a0a0a !important;
            border: 1px solid #333333 !important;
            border-radius: 8px !important;
            padding: 20px !important;
            margin: 20px 0 !important;
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace !important;
            font-size: 13px !important;
            line-height: 1.5 !important;
        }
        .token.comment { color: #6a9955 !important; }
        .token.keyword { color: #569cd6 !important; }
        .token.string { color: #ce9178 !important; }
        .token.number { color: #b5cea8 !important; }
        .token.function { color: #dcdcaa !important; }
        .token.class-name { color: #4ec9b0 !important; }
        .token.operator { color: #d4d4d4 !important; }
        .token.punctuation { color: #d4d4d4 !important; }
        .token.variable { color: #9cdcfe !important; }
        .token.constant { color: #4fc1ff !important; }
    </style>
</head>
<body>
    <div class="container">
        <div class="back-link">
            <a href="/">&larr; Back to Documentation</a>
        </div>
        <h1>QuantDesk Devnet Deployment Guide</h1>
<h2>Overview</h2>
<p>This guide will walk you through deploying QuantDesk to Solana devnet for testing and development.</p>
<h2>Prerequisites</h2>
<h3>Required Tools</h3>
<ul>
<li>Node.js &gt;= 18.0.0</li>
<li>pnpm package manager</li>
<li>Solana CLI tools</li>
<li>Anchor CLI v0.32.1</li>
<li>Git</li>
</ul>
<h3>Required Accounts</h3>
<ul>
<li>Supabase project (free tier works)</li>
<li>Solana devnet wallet with SOL</li>
</ul>
<h2>Phase 1: Environment Setup</h2>
<h3>1.1 Clone and Install Dependencies</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Clone repository (if not already cloned)</span>
git<span class="w"> </span>clone<span class="w"> </span>&lt;your-repo-url&gt;
<span class="nb">cd</span><span class="w"> </span>quantdesk-1.0.6

<span class="c1"># Install workspace dependencies</span>
pnpm<span class="w"> </span>install

<span class="c1"># Install backend dependencies</span>
<span class="nb">cd</span><span class="w"> </span>backend<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>pnpm<span class="w"> </span>install<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>..

<span class="c1"># Install frontend dependencies</span>
<span class="nb">cd</span><span class="w"> </span>frontend<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>pnpm<span class="w"> </span>install<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>..

<span class="c1"># Install sandbox dependencies</span>
<span class="nb">cd</span><span class="w"> </span>solana-sandbox<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>pnpm<span class="w"> </span>install<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>..
</code></pre></div>

<h3>1.2 Solana Wallet Setup</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Set Solana CLI to devnet</span>
solana<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>--url<span class="w"> </span>https://api.devnet.solana.com

<span class="c1"># Create or use existing wallet</span>
solana-keygen<span class="w"> </span>new<span class="w"> </span>--no-bip39-passphrase

<span class="c1"># Get your wallet address</span>
solana<span class="w"> </span>address

<span class="c1"># Request devnet SOL</span>
solana<span class="w"> </span>airdrop<span class="w"> </span><span class="m">2</span>

<span class="c1"># Verify balance</span>
solana<span class="w"> </span>balance
</code></pre></div>

<h3>1.3 Configure Backend Environment</h3>
<p>Create <code>backend/.env</code> from the template:</p>
<div class="codehilite"><pre><span></span><code>cp<span class="w"> </span>backend/.env.example<span class="w"> </span>backend/.env
</code></pre></div>

<p>Edit <code>backend/.env</code> with your values:</p>
<div class="codehilite"><pre><span></span><code># Solana Configuration
SOLANA_NETWORK=devnet
RPC_URL=https://api.devnet.solana.com
SOLANA_RPC_URL=https://api.devnet.solana.com
PROGRAM_ID=GcpEyGMJg9AvEx8LgAyzyUNTPWFxovHxtmQ4vVWuWu3a
QUANTDESK_PROGRAM_ID=GcpEyGMJg9AvEx8LgAyzyUNTPWFxovHxtmQ4vVWuWu3a

# Supabase Configuration
SUPABASE_URL=&lt;your_supabase_project_url&gt;
SUPABASE_ANON_KEY=&lt;your_supabase_anon_key&gt;
SUPABASE_ACCESS_TOKEN=&lt;your_supabase_access_token&gt;
SUPABASE_PROJECT_ID=&lt;your_supabase_project_id&gt;
DATABASE_URL=&lt;your_database_connection_string&gt;

# JWT Configuration
JWT_SECRET=&lt;generate_random_secret&gt;
JWT_EXPIRES_IN=7d

# Oracle Configuration (Devnet Pyth Feeds)
PYTH_PRICE_FEED_SOL=J83w4HKfqxwcq3BEMMkPFSppX3gqekLyLJBexebFVkix
PYTH_PRICE_FEED_BTC=HovQMDrbAgAYPCmHVSrezcSmkMtXSSUsLDFANExrZh2J
PYTH_PRICE_FEED_ETH=EdVCmQ9FSPcVe5YySXDPCRmc8aDQLKJ9xvYBMZPie1Vw
</code></pre></div>

<h2>Phase 2: Smart Contract Deployment</h2>
<h3>2.1 Build Smart Contracts</h3>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>contracts

<span class="c1"># Build the program</span>
anchor<span class="w"> </span>build

<span class="c1"># Verify program ID matches</span>
anchor<span class="w"> </span>keys<span class="w"> </span>list

<span class="c1"># If Program ID doesn&#39;t match, update in:</span>
<span class="c1"># - Anchor.toml</span>
<span class="c1"># - lib.rs (declare_id!)</span>
<span class="c1"># - backend/.env</span>
<span class="c1"># - frontend/src/contexts/ProgramContext.tsx</span>
</code></pre></div>

<h3>2.2 Deploy to Devnet</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Deploy program</span>
anchor<span class="w"> </span>deploy<span class="w"> </span>--provider.cluster<span class="w"> </span>devnet

<span class="c1"># Verify deployment</span>
solana<span class="w"> </span>program<span class="w"> </span>show<span class="w"> </span>GcpEyGMJg9AvEx8LgAyzyUNTPWFxovHxtmQ4vVWuWu3a
</code></pre></div>

<h3>2.3 Copy IDL to Frontend</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># From contracts/smart-contracts directory</span>
cp<span class="w"> </span>target/idl/quantdesk_perp_dex.json<span class="w"> </span>../../frontend/src/types/
</code></pre></div>

<h2>Phase 3: Database Setup</h2>
<h3>3.1 Run Supabase Migrations</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Apply production schema</span>
psql<span class="w"> </span>&lt;your_database_url&gt;<span class="w"> </span>&lt;<span class="w"> </span>database/production-schema.sql

<span class="c1"># Apply security fixes</span>
psql<span class="w"> </span>&lt;your_database_url&gt;<span class="w"> </span>&lt;<span class="w"> </span>database/security-audit-fixes.sql

<span class="c1"># Seed initial markets (optional)</span>
psql<span class="w"> </span>&lt;your_database_url&gt;<span class="w"> </span>&lt;<span class="w"> </span>database/seed-markets.sql
</code></pre></div>

<h3>3.2 Initialize Devnet Markets</h3>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>backend
pnpm<span class="w"> </span>run<span class="w"> </span>init:devnet
</code></pre></div>

<p>This will:
- Verify database connectivity
- Check Solana devnet connection
- Verify program deployment
- Seed SOL/USD, BTC/USD, ETH/USD markets</p>
<h2>Phase 4: Testing &amp; Verification</h2>
<h3>4.1 Run Sandbox Tests</h3>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>solana-sandbox

<span class="c1"># Copy environment template</span>
cp<span class="w"> </span>env.example<span class="w"> </span>.env

<span class="c1"># Setup devnet environment</span>
pnpm<span class="w"> </span>run<span class="w"> </span>setup

<span class="c1"># Verify program deployment</span>
pnpm<span class="w"> </span>run<span class="w"> </span>check-program

<span class="c1"># Run complete trading flow test</span>
pnpm<span class="w"> </span>run<span class="w"> </span>test:flow
</code></pre></div>

<p>Expected output:</p>
<div class="codehilite"><pre><span></span><code>✓ User Account PDA derivation
✓ Market PDA derivation
✓ Position PDA derivation
✓ Collateral PDA derivation
✓ Program verification
</code></pre></div>

<h3>4.2 Validate IDL Consistency</h3>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>solana-sandbox
pnpm<span class="w"> </span>run<span class="w"> </span>validate-idl
</code></pre></div>

<p>If mismatch detected, rebuild contracts and recopy IDL.</p>
<h2>Phase 5: Start Services</h2>
<h3>5.1 Start Backend</h3>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>backend
pnpm<span class="w"> </span>run<span class="w"> </span>dev
</code></pre></div>

<p>Backend should start on port 3002. Verify:
- http://localhost:3002/api/health
- http://localhost:3002/api/markets</p>
<h3>5.2 Start Frontend</h3>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>frontend
pnpm<span class="w"> </span>run<span class="w"> </span>dev
</code></pre></div>

<p>Frontend should start on port 3001.</p>
<h2>Phase 6: Frontend Testing</h2>
<h3>6.1 Connect Wallet</h3>
<ol>
<li>Open http://localhost:3001</li>
<li>Click "Connect Wallet"</li>
<li>Select Phantom or Solflare</li>
<li>Ensure wallet is on devnet</li>
<li>Approve connection</li>
</ol>
<h3>6.2 Create User Account</h3>
<p>Frontend will check if user account exists. If not:
1. Click "Create Account"
2. Approve transaction
3. Wait for confirmation
4. Verify account appears in UI</p>
<h3>6.3 Test Trading Flow</h3>
<ol>
<li><strong>View Markets</strong>: Check that SOL/USD, BTC/USD, ETH/USD appear</li>
<li><strong>Add Collateral</strong>: (if implemented) deposit test tokens</li>
<li><strong>Open Position</strong>: Try opening a small long/short position</li>
<li><strong>Close Position</strong>: Close the test position</li>
<li><strong>Check Portfolio</strong>: Verify position appears correctly</li>
</ol>
<h2>Common Issues &amp; Solutions</h2>
<h3>Issue: Program ID Mismatch</h3>
<p><strong>Symptoms</strong>: Frontend shows "Program not found" or deserialization errors</p>
<p><strong>Solution</strong>:
1. Check Program ID in <code>contracts/programs/src/lib.rs</code> (declare_id!)
2. Update in <code>Anchor.toml</code>
3. Rebuild: <code>anchor build</code>
4. Redeploy: <code>anchor deploy --provider.cluster devnet</code>
5. Update in <code>backend/.env</code> and <code>frontend/src/contexts/ProgramContext.tsx</code></p>
<h3>Issue: AccountDidNotDeserialize Error</h3>
<p><strong>Symptoms</strong>: Error 3003 when fetching accounts</p>
<p><strong>Solution</strong>:
1. Verify IDL is up-to-date: <code>pnpm run validate-idl</code> in sandbox
2. Rebuild contracts if IDL changed
3. Copy fresh IDL to frontend
4. Check PDA derivation matches Rust code</p>
<h3>Issue: Transaction Fails with "Account Not Found"</h3>
<p><strong>Symptoms</strong>: User account or market not initialized</p>
<p><strong>Solution</strong>:
1. Run <code>pnpm run init:devnet</code> in backend to seed markets
2. Create user account in frontend before trading
3. Verify program is deployed: <code>solana program show &lt;PROGRAM_ID&gt;</code></p>
<h3>Issue: Insufficient SOL Balance</h3>
<p><strong>Symptoms</strong>: "Insufficient funds" errors</p>
<p><strong>Solution</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Request more devnet SOL</span>
solana<span class="w"> </span>airdrop<span class="w"> </span><span class="m">2</span>

<span class="c1"># Or use faucet</span>
<span class="c1"># https://faucet.solana.com</span>
</code></pre></div>

<h3>Issue: RPC Rate Limiting</h3>
<p><strong>Symptoms</strong>: Frequent timeouts or "429 Too Many Requests"</p>
<p><strong>Solution</strong>:
1. Use a paid RPC provider (Helius, QuickNode)
2. Update <code>RPC_URL</code> in backend/.env
3. Implement retry logic with exponential backoff</p>
<h3>Issue: Stale Oracle Prices</h3>
<p><strong>Symptoms</strong>: "Price stale" errors</p>
<p><strong>Solution</strong>:
1. Verify Pyth price feeds are correct for devnet
2. Check oracle update logic in smart contract
3. Ensure price updates happen within staleness window (5 min)</p>
<h2>Debugging Tools</h2>
<h3>Sandbox Utilities</h3>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>solana-sandbox

<span class="c1"># Inspect account data</span>
pnpm<span class="w"> </span>run<span class="w"> </span>inspect<span class="w"> </span>--<span class="w"> </span>&lt;account_pubkey&gt;

<span class="c1"># Derive PDA</span>
pnpm<span class="w"> </span>run<span class="w"> </span>derive<span class="w"> </span>--<span class="w"> </span>--wallet<span class="w"> </span>&lt;wallet_pubkey&gt;<span class="w"> </span>--index<span class="w"> </span><span class="m">0</span>

<span class="c1"># Analyze transaction</span>
pnpm<span class="w"> </span>run<span class="w"> </span>analyze<span class="w"> </span>--<span class="w"> </span>&lt;transaction_signature&gt;

<span class="c1"># Check program status</span>
pnpm<span class="w"> </span>run<span class="w"> </span>check-program
</code></pre></div>

<h3>Browser DevTools</h3>
<p>Check console for:
- PDA derivation logs
- Transaction signatures
- Account fetch errors
- WebSocket connection issues</p>
<h3>Solana Explorer</h3>
<p>View transactions on devnet:
- https://explorer.solana.com/?cluster=devnet
- Paste transaction signature or account address
- Check program logs and instruction details</p>
<h2>Next Steps</h2>
<p>After successful devnet deployment:</p>
<ol>
<li><strong>Load Testing</strong>: Test with multiple concurrent users</li>
<li><strong>Oracle Integration</strong>: Verify real-time Pyth price updates</li>
<li><strong>Error Handling</strong>: Test edge cases (insufficient collateral, liquidations)</li>
<li><strong>Performance</strong>: Monitor transaction confirmation times</li>
<li><strong>Security Audit</strong>: Review smart contract security</li>
<li><strong>Mainnet Prep</strong>: Plan mainnet deployment strategy</li>
</ol>
<h2>Monitoring &amp; Maintenance</h2>
<h3>Health Checks</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Backend health</span>
curl<span class="w"> </span>http://localhost:3002/api/health

<span class="c1"># Market data</span>
curl<span class="w"> </span>http://localhost:3002/api/markets

<span class="c1"># Oracle prices</span>
curl<span class="w"> </span>http://localhost:3002/api/oracle/prices
</code></pre></div>

<h3>Logs</h3>
<p>Check logs for errors:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Backend logs</span>
tail<span class="w"> </span>-f<span class="w"> </span>backend/logs/backend-dev.log

<span class="c1"># Frontend logs</span>
Check<span class="w"> </span>browser<span class="w"> </span>console

<span class="c1"># Smart contract logs</span>
solana<span class="w"> </span>logs<span class="w"> </span>&lt;program_id&gt;
</code></pre></div>

<h3>Regular Maintenance</h3>
<ul>
<li>Monitor devnet SOL balance in program accounts</li>
<li>Check for failed transactions</li>
<li>Verify oracle price updates</li>
<li>Monitor database growth</li>
<li>Update dependencies regularly</li>
</ul>
<h2>Support &amp; Resources</h2>
<ul>
<li><strong>Documentation</strong>: <code>/docs</code></li>
<li><strong>Sandbox Guide</strong>: <code>/solana-sandbox/README.md</code></li>
<li><strong>API Docs</strong>: http://localhost:3002/api/docs/swagger</li>
<li><strong>Solana Docs</strong>: https://docs.solana.com</li>
<li><strong>Anchor Docs</strong>: https://www.anchor-lang.com</li>
</ul>
<h2>Checklist</h2>
<p>Before going live on devnet:</p>
<ul>
<li>[ ] Program deployed to devnet</li>
<li>[ ] IDL synced to frontend</li>
<li>[ ] Database schema applied</li>
<li>[ ] Markets initialized</li>
<li>[ ] Backend running and healthy</li>
<li>[ ] Frontend connecting to backend</li>
<li>[ ] Wallet connects successfully</li>
<li>[ ] User account creation works</li>
<li>[ ] Can view markets</li>
<li>[ ] Oracle prices updating</li>
<li>[ ] Position opening works</li>
<li>[ ] Position closing works</li>
<li>[ ] Error handling working</li>
<li>[ ] Logs configured</li>
<li>[ ] Monitoring set up</li>
</ul>
<hr />
<p><strong>Last Updated</strong>: October 2025<br />
<strong>Status</strong>: Devnet Ready ✅<br />
<strong>Version</strong>: 1.0.6</p>
    </div>
</body>
</html>