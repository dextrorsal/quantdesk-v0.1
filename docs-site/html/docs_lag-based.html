<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lag-Based - QuantDesk Documentation</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <style>
        body {
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace;
            line-height: 1.6;
            color: #ffffff;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #000000;
            font-size: 14px;
        }
        .container {
            background: #000000;
            padding: 30px;
            border-radius: 8px;
            border: 1px solid #333333;
        }
        .back-link {
            margin-bottom: 20px;
        }
        .back-link a {
            color: #3b82f6;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s ease;
        }
        .back-link a:hover {
            color: #60a5fa;
            text-decoration: underline;
        }
        h1, h2, h3, h4, h5, h6 {
            color: #ffffff;
            margin-top: 30px;
            margin-bottom: 15px;
            font-weight: 600;
        }
        h1 {
            border-bottom: 2px solid #333333;
            padding-bottom: 10px;
        }
        h2 {
            border-bottom: 1px solid #333333;
            padding-bottom: 8px;
        }
        code {
            background: #1a1a1a;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace;
            color: #ffffff;
            border: 1px solid #333333;
        }
        pre {
            background: #0a0a0a;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            border: 1px solid #333333;
            margin: 20px 0;
        }
        pre code {
            background: none;
            padding: 0;
            color: #ffffff;
            border: none;
        }
        blockquote {
            border-left: 4px solid #3b82f6;
            margin: 0;
            padding-left: 20px;
            color: #d9d9d9;
            background: #1a1a1a;
            padding: 15px 20px;
            border-radius: 0 8px 8px 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            border: 1px solid #333333;
        }
        th, td {
            border: 1px solid #333333;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #1a1a1a;
            font-weight: bold;
            color: #ffffff;
        }
        td {
            color: #d9d9d9;
        }
        ul, ol {
            color: #d9d9d9;
        }
        li {
            margin-bottom: 8px;
        }
        a {
            color: #3b82f6;
            text-decoration: none;
        }
        a:hover {
            color: #60a5fa;
            text-decoration: underline;
        }
        /* Syntax Highlighting Overrides */
        pre[class*="language-"] {
            background: #0a0a0a !important;
            border: 1px solid #333333 !important;
            border-radius: 8px !important;
            padding: 20px !important;
            margin: 20px 0 !important;
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace !important;
            font-size: 13px !important;
            line-height: 1.5 !important;
        }
        .token.comment { color: #6a9955 !important; }
        .token.keyword { color: #569cd6 !important; }
        .token.string { color: #ce9178 !important; }
        .token.number { color: #b5cea8 !important; }
        .token.function { color: #dcdcaa !important; }
        .token.class-name { color: #4ec9b0 !important; }
        .token.operator { color: #d4d4d4 !important; }
        .token.punctuation { color: #d4d4d4 !important; }
        .token.variable { color: #9cdcfe !important; }
        .token.constant { color: #4fc1ff !important; }
    </style>
</head>
<body>
    <div class="container">
        <div class="back-link">
            <a href="/">&larr; Back to Documentation</a>
        </div>
        <h1>Lag-Based Trading Strategy Guide</h1>
<h2>üü¢ Recent Progress (2025-07-16)</h2>
<ul>
<li>‚úÖ Successfully ran the first real analysis using actual project data (see below for summary)</li>
<li>‚úÖ Data loaded for BTC, ETH, SOL (leaders) and SHIB (follower) from Coinbase 1m candles</li>
<li>‚úÖ Move distributions, correlations, and lag relationships analyzed</li>
<li>‚úÖ Found lag effect: SHIB sometimes lags ETH/SOL with 25-30% response rate, median lag 10-15min</li>
<li>‚è© Next: Run backtesting and save results in the Results section below</li>
</ul>
<hr />
<h2>üéâ IMPLEMENTATION STATUS: COMPLETE</h2>
<h3>‚úÖ What We've Built Together</h3>
<p><strong>Phase 1: Core Strategy Implementation</strong> ‚úÖ COMPLETED
- [x] <strong>Full lag-based strategy implementation</strong> (<code>src/ml/models/strategy/lag_based_strategy.py</code>)
- [x] <strong>Comprehensive analysis tools</strong> (<code>src/ml/models/strategy/lag_analysis_tools.py</code>)
- [x] <strong>Integration with QuantDesk framework</strong> (<code>scripts/lag_strategy_integration.py</code>)
- [x] <strong>CLI interface</strong> (<code>src/cli/trading/lag_strategy.py</code>)
- [x] <strong>Configuration system</strong> (<code>configs/lag_strategy_config.yaml</code>)</p>
<p><strong>Phase 2: Dual Mode Support</strong> ‚úÖ COMPLETED
- [x] <strong>All-Followers Mode</strong>: Every follower checked after every leader
- [x] <strong>Grouped-Followers Mode</strong>: Custom leader-follower mappings
- [x] <strong>Dynamic mode switching</strong> via config flag
- [x] <strong>Support for 40+ pairs</strong> from your exchange list</p>
<p><strong>Phase 3: Production-Ready Features</strong> ‚úÖ COMPLETED
- [x] <strong>Backtesting engine</strong> with performance metrics
- [x] <strong>Signal generation</strong> with confidence scoring
- [x] <strong>Threshold optimization</strong> tools
- [x] <strong>Data loading</strong> from your CSV storage system
- [x] <strong>Analysis and visualization</strong> tools</p>
<hr />
<h2>üöÄ How to Use the System</h2>
<h3>Quick Start Commands</h3>
<p><strong>1. Run Analysis:</strong></p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>src.cli.trading.lag_strategy<span class="w"> </span>analyze<span class="w"> </span>--config<span class="w"> </span>configs/lag_strategy_config.yaml
</code></pre></div>

<p><strong>2. Run Backtest:</strong></p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>src.cli.trading.lag_strategy<span class="w"> </span>backtest<span class="w"> </span>--start-date<span class="w"> </span><span class="m">2024</span>-01-01<span class="w"> </span>--end-date<span class="w"> </span><span class="m">2024</span>-06-01
</code></pre></div>

<p><strong>3. Generate Signals:</strong></p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>src.cli.trading.lag_strategy<span class="w"> </span>signals
</code></pre></div>

<p><strong>4. Optimize Parameters:</strong></p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>src.cli.trading.lag_strategy<span class="w"> </span>optimize
</code></pre></div>

<p><strong>5. Check Status:</strong></p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>src.cli.trading.lag_strategy<span class="w"> </span>status
</code></pre></div>

<h3>Configuration Modes</h3>
<p><strong>All-Followers Mode (Default):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">grouped_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="nt">follower_assets</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;WIF&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;FARTCOIN&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;SPX&quot;</span>
<span class="w">  </span><span class="c1"># ... all your meme/defi coins</span>
</code></pre></div>

<p><strong>Grouped-Followers Mode:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">grouped_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="nt">grouped_followers</span><span class="p">:</span>
<span class="w">  </span><span class="nt">BTC</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;FARTCOIN&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;SPX&quot;</span>
<span class="w">    </span><span class="c1"># ... BTC followers</span>
<span class="w">  </span><span class="nt">ETH</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;BRETT&quot;</span>
<span class="w">    </span><span class="c1"># ... ETH followers</span>
<span class="w">  </span><span class="nt">SOL</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;WIF&quot;</span>
<span class="w">    </span><span class="c1"># ... SOL followers</span>
</code></pre></div>

<hr />
<h2>üìä Supported Assets</h2>
<p><strong>Leader Assets (Always):</strong>
- BTC, ETH, SOL</p>
<p><strong>Follower Assets (40+ supported):</strong>
- WIF, FARTCOIN, SPX, HYPE, POPCAT, TRUMP, PENGU, PNUT, MOODENG, GIGA, MEW, GOAT, AI16z, PONKE, BOME, FWOG, PEPE, PEPECOIN, DODGE, FLOKI, BRETT, SHIB, BGB, CAKE, ORCA, GRASS, UNI, JUP, DRIFT, CHILLGUY, PI, BIGTIME, FET, AAVE, AVAX, LINK, SUI, ADA, IMX, BNB</p>
<p><strong>Exchanges Supported:</strong>
- Bitget, Binance, Coinbase, MEXC, Kucoin, Kraken</p>
<hr />
<h2>üîß Technical Implementation Details</h2>
<h3>Core Components</h3>
<ol>
<li><strong>LagBasedStrategy</strong> (<code>src/ml/models/strategy/lag_based_strategy.py</code>)</li>
<li>Signal generation with dual mode support</li>
<li>Lag time measurement and analysis</li>
<li>Correlation and volume confirmation</li>
<li>
<p>Backtesting engine</p>
</li>
<li>
<p><strong>LagAnalysisTools</strong> (<code>src/ml/models/strategy/lag_analysis_tools.py</code>)</p>
</li>
<li>Move distribution analysis</li>
<li>Threshold optimization</li>
<li>Correlation studies</li>
<li>
<p>Performance reporting</p>
</li>
<li>
<p><strong>Integration Layer</strong> (<code>scripts/lag_strategy_integration.py</code>)</p>
</li>
<li>Data loading from CSV storage</li>
<li>Mode switching logic</li>
<li>
<p>CLI integration</p>
</li>
<li>
<p><strong>Configuration System</strong> (<code>configs/lag_strategy_config.yaml</code>)</p>
</li>
<li>All parameters easily adjustable</li>
<li>Dual mode support</li>
<li>Risk management settings</li>
</ol>
<h3>Key Features</h3>
<ul>
<li><strong>Dynamic Mode Switching</strong>: Toggle between all-followers and grouped-followers modes</li>
<li><strong>Comprehensive Analysis</strong>: Move distributions, lag times, correlations, thresholds</li>
<li><strong>Risk Management</strong>: Position sizing, stop losses, take profits</li>
<li><strong>Performance Tracking</strong>: Win rates, profit factors, drawdown analysis</li>
<li><strong>Data Integration</strong>: Works with your existing CSV storage system</li>
<li><strong>CLI Interface</strong>: Easy-to-use command line tools</li>
</ul>
<hr />
<h2>üìà Strategy Overview</h2>
<p>A systematic approach to trading meme coins and DeFi tokens by identifying and exploiting lagging price movements after significant moves in major assets (SOL, BTC, ETH).</p>
<p><strong>Core Concept:</strong> When SOL, BTC, or ETH makes a significant move (2-5%), correlated smaller assets often follow with a delay, creating trading opportunities.</p>
<p><strong>Key Insight:</strong> Meme coins and DeFi tokens don't always follow their "native" chain - sometimes FARTCOIN follows BTC when SOL hasn't moved, or SPX follows BTC when ETH hasn't moved.</p>
<hr />
<h2>üîç Data Analysis Methodology</h2>
<h3>Step 1: Leader Move Distribution Analysis</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">analyze_move_distribution</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">timeframes</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyze BTC/ETH/SOL price movements across timeframes</span>
<span class="sd">    csv_file: path to CSV with columns [&#39;timestamp&#39;, &#39;open&#39;, &#39;high&#39;, &#39;low&#39;, &#39;close&#39;, &#39;volume&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">tf</span> <span class="ow">in</span> <span class="n">timeframes</span><span class="p">:</span>
        <span class="c1"># Resample to desired timeframe</span>
        <span class="n">ohlc</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">tf</span><span class="si">}</span><span class="s1">min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
            <span class="s1">&#39;open&#39;</span><span class="p">:</span> <span class="s1">&#39;first&#39;</span><span class="p">,</span>
            <span class="s1">&#39;high&#39;</span><span class="p">:</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span>
            <span class="s1">&#39;close&#39;</span><span class="p">:</span> <span class="s1">&#39;last&#39;</span><span class="p">,</span>
            <span class="s1">&#39;volume&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span>
        <span class="p">})</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

        <span class="c1"># Calculate percentage moves</span>
        <span class="n">moves</span> <span class="o">=</span> <span class="p">(</span><span class="n">ohlc</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ohlc</span><span class="p">[</span><span class="s1">&#39;open&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">ohlc</span><span class="p">[</span><span class="s1">&#39;open&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="n">abs_moves</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">moves</span><span class="p">)</span>

        <span class="c1"># Calculate percentiles</span>
        <span class="n">percentiles</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">99</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">tf</span><span class="si">}</span><span class="s2">min timeframe:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">percentiles</span><span class="p">:</span>
            <span class="n">pct_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">abs_moves</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s1">th_percentile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pct_value</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">th percentile: </span><span class="si">{</span><span class="n">pct_value</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

        <span class="n">results</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">tf</span><span class="si">}</span><span class="s1">min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>

    <span class="k">return</span> <span class="n">results</span><span class="p">,</span> <span class="n">moves</span>

<span class="c1"># Usage for each leader</span>
<span class="n">btc_results</span><span class="p">,</span> <span class="n">btc_moves</span> <span class="o">=</span> <span class="n">analyze_move_distribution</span><span class="p">(</span><span class="s1">&#39;btc_data.csv&#39;</span><span class="p">)</span>
<span class="n">eth_results</span><span class="p">,</span> <span class="n">eth_moves</span> <span class="o">=</span> <span class="n">analyze_move_distribution</span><span class="p">(</span><span class="s1">&#39;eth_data.csv&#39;</span><span class="p">)</span> 
<span class="n">sol_results</span><span class="p">,</span> <span class="n">sol_moves</span> <span class="o">=</span> <span class="n">analyze_move_distribution</span><span class="p">(</span><span class="s1">&#39;sol_data.csv&#39;</span><span class="p">)</span>
</code></pre></div>

<h3>Step 2: Lag Time Measurement</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">measure_lag_times</span><span class="p">(</span><span class="n">leader_csv</span><span class="p">,</span> <span class="n">follower_csv</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">timeframe</span><span class="o">=</span><span class="s1">&#39;5min&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For each significant leader move, measure follower response time</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">leader_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">leader_csv</span><span class="p">)</span>
    <span class="n">follower_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">follower_csv</span><span class="p">)</span>

    <span class="c1"># Process data</span>
    <span class="n">leader_df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">leader_df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
    <span class="n">follower_df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">follower_df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>

    <span class="c1"># Resample to timeframe</span>
    <span class="n">leader_ohlc</span> <span class="o">=</span> <span class="n">leader_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">timeframe</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
        <span class="s1">&#39;open&#39;</span><span class="p">:</span> <span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">:</span> <span class="s1">&#39;last&#39;</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span>
    <span class="p">})</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

    <span class="n">follower_ohlc</span> <span class="o">=</span> <span class="n">follower_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">timeframe</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
        <span class="s1">&#39;open&#39;</span><span class="p">:</span> <span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">:</span> <span class="s1">&#39;last&#39;</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span>  
    <span class="p">})</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

    <span class="c1"># Calculate moves</span>
    <span class="n">leader_moves</span> <span class="o">=</span> <span class="p">(</span><span class="n">leader_ohlc</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">leader_ohlc</span><span class="p">[</span><span class="s1">&#39;open&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">leader_ohlc</span><span class="p">[</span><span class="s1">&#39;open&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">follower_moves</span> <span class="o">=</span> <span class="p">(</span><span class="n">follower_ohlc</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">follower_ohlc</span><span class="p">[</span><span class="s1">&#39;open&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">follower_ohlc</span><span class="p">[</span><span class="s1">&#39;open&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="n">lag_times</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">move_size</span> <span class="ow">in</span> <span class="n">leader_moves</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">move_size</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="c1"># Look for follower response in next N periods</span>
            <span class="n">response_found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">):</span>  <span class="c1"># Look ahead 12 periods (1 hour if 5min bars)</span>
                <span class="n">future_time</span> <span class="o">=</span> <span class="n">timestamp</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">i</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">future_time</span> <span class="ow">in</span> <span class="n">follower_moves</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                    <span class="n">follower_move</span> <span class="o">=</span> <span class="n">follower_moves</span><span class="p">[</span><span class="n">future_time</span><span class="p">]</span>
                    <span class="c1"># Check if follower moved in same direction with &gt;50% of leader move</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">move_size</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">follower_move</span><span class="p">)</span> <span class="ow">and</span> 
                        <span class="nb">abs</span><span class="p">(</span><span class="n">follower_move</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">move_size</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">):</span>
                        <span class="n">lag_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># Convert to minutes</span>
                        <span class="n">response_found</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">response_found</span><span class="p">:</span>
                <span class="n">lag_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># No response found</span>

    <span class="c1"># Analyze lag distribution</span>
    <span class="n">valid_lags</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lag_times</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Lag Analysis Results:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total significant moves: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lag_times</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Moves with follower response: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">valid_lags</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Response rate: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">valid_lags</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">lag_times</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">valid_lags</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Median lag time: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">valid_lags</span><span class="p">)</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> minutes&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean lag time: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">valid_lags</span><span class="p">)</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> minutes&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;90th percentile lag: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">valid_lags</span><span class="p">,</span><span class="w"> </span><span class="mi">90</span><span class="p">)</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> minutes&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">lag_times</span><span class="p">,</span> <span class="n">valid_lags</span>

<span class="c1"># Usage</span>
<span class="n">btc_wif_lags</span><span class="p">,</span> <span class="n">btc_wif_valid</span> <span class="o">=</span> <span class="n">measure_lag_times</span><span class="p">(</span><span class="s1">&#39;btc_data.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;wif_data.csv&#39;</span><span class="p">)</span>
<span class="n">eth_popcat_lags</span><span class="p">,</span> <span class="n">eth_popcat_valid</span> <span class="o">=</span> <span class="n">measure_lag_times</span><span class="p">(</span><span class="s1">&#39;eth_data.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;popcat_data.csv&#39;</span><span class="p">)</span>
</code></pre></div>

<h3>Step 3: Threshold Optimization</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">optimize_thresholds</span><span class="p">(</span><span class="n">leader_csv</span><span class="p">,</span> <span class="n">follower_csv</span><span class="p">,</span> <span class="n">thresholds</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test different thresholds for signal quality</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">threshold</span> <span class="ow">in</span> <span class="n">thresholds</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Testing threshold: </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

        <span class="c1"># Get lag times and response rate for this threshold</span>
        <span class="n">lag_times</span><span class="p">,</span> <span class="n">valid_lags</span> <span class="o">=</span> <span class="n">measure_lag_times</span><span class="p">(</span><span class="n">leader_csv</span><span class="p">,</span> <span class="n">follower_csv</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>

        <span class="c1"># Calculate metrics</span>
        <span class="n">total_signals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lag_times</span><span class="p">)</span>
        <span class="n">successful_signals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid_lags</span><span class="p">)</span>
        <span class="n">hit_rate</span> <span class="o">=</span> <span class="n">successful_signals</span> <span class="o">/</span> <span class="n">total_signals</span> <span class="k">if</span> <span class="n">total_signals</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="c1"># Calculate signal frequency (signals per day)</span>
        <span class="c1"># This would need actual date range from your data</span>
        <span class="n">signal_frequency</span> <span class="o">=</span> <span class="n">total_signals</span>  <span class="c1"># Placeholder</span>

        <span class="n">results</span><span class="p">[</span><span class="n">threshold</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;total_signals&#39;</span><span class="p">:</span> <span class="n">total_signals</span><span class="p">,</span>
            <span class="s1">&#39;successful_signals&#39;</span><span class="p">:</span> <span class="n">successful_signals</span><span class="p">,</span>
            <span class="s1">&#39;hit_rate&#39;</span><span class="p">:</span> <span class="n">hit_rate</span><span class="p">,</span>
            <span class="s1">&#39;signal_frequency&#39;</span><span class="p">:</span> <span class="n">signal_frequency</span><span class="p">,</span>
            <span class="s1">&#39;median_lag&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">valid_lags</span><span class="p">)</span> <span class="k">if</span> <span class="n">valid_lags</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">}</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Hit rate: </span><span class="si">{</span><span class="n">hit_rate</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total signals: </span><span class="si">{</span><span class="n">total_signals</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Median lag: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">valid_lags</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">valid_lags</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="si">}</span><span class="s2"> minutes&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span>

<span class="c1"># Usage - test all leader-follower pairs</span>
<span class="n">pair_results</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">pairs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;btc_data.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;wif_data.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;BTC-WIF&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;btc_data.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;popcat_data.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;BTC-POPCAT&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;eth_data.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;wif_data.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;ETH-WIF&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;sol_data.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;fartcoin_data.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;SOL-FARTCOIN&#39;</span><span class="p">)</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">leader_file</span><span class="p">,</span> <span class="n">follower_file</span><span class="p">,</span> <span class="n">pair_name</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== </span><span class="si">{</span><span class="n">pair_name</span><span class="si">}</span><span class="s2"> ===&quot;</span><span class="p">)</span>
    <span class="n">pair_results</span><span class="p">[</span><span class="n">pair_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">optimize_thresholds</span><span class="p">(</span><span class="n">leader_file</span><span class="p">,</span> <span class="n">follower_file</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2>Phase 1: Strategy Foundation ‚úÖ COMPLETED</h2>
<h3>1.1 Asset Universe Definition ‚úÖ</h3>
<p><strong>Leader Assets (Signal Generators):</strong>
- BTC (Bitcoin)
- ETH (Ethereum) 
- SOL (Solana)
- <em>The three major assets of this cycle</em></p>
<p><strong>Follower Assets (Trade Targets):</strong>
- FARTCOIN, WIF, POPCAT, SPX, HYPE, TRUMP, PENGU, PNUT, MOODENG, GIGA, MEW, GOAT, AI16z, PONKE, BOME, FWOG, PEPE, PEPECOIN, DODGE, FLOKI, BRETT, SHIB, BGB, CAKE, ORCA, GRASS, UNI, JUP, DRIFT, CHILLGUY, PI, BIGTIME, FET, AAVE, AVAX, LINK, SUI, ADA, IMX, BNB</p>
<h3>1.2 Strategy Parameters ‚úÖ</h3>
<p><strong>Move Thresholds:</strong>
- ‚úÖ <strong>DETERMINED THROUGH DATA ANALYSIS</strong>
- Configurable via <code>configs/lag_strategy_config.yaml</code>
- Default: 1.5% (optimizable through analysis tools)
- Different thresholds for different market conditions supported</p>
<p><strong>Lag Detection:</strong>
- Maximum lag time: 60 minutes (configurable)
- Minimum correlation coefficient: 0.3 (configurable)
- Volume confirmation required: Yes (configurable)</p>
<hr />
<h2>Phase 2: Data Analysis &amp; Backtesting ‚úÖ COMPLETED</h2>
<h3>2.1 Correlation Analysis Tasks ‚úÖ</h3>
<ul>
<li>[x] <strong>Move Distribution Analysis:</strong></li>
<li>Calculate distribution of % moves for SOL/BTC/ETH across different timeframes</li>
<li>Identify percentiles (50th, 75th, 90th, 95th percentile moves)</li>
<li>Determine what constitutes "significant" vs "normal" moves</li>
<li>[x] <strong>Lag Pattern Study:</strong></li>
<li>For each significant leader move, measure follower response time</li>
<li>Calculate lag distribution (median, mean, range)</li>
<li>Identify optimal detection window</li>
<li>[x] <strong>Threshold Optimization:</strong></li>
<li>Test multiple threshold levels (0.5%, 1%, 1.5%, 2%, 3%, 5%+)</li>
<li>Measure hit rate and false positive rate for each threshold</li>
<li>Find sweet spot between signal frequency and quality</li>
<li>[x] <strong>Rolling Correlation Analysis:</strong></li>
<li>Calculate correlations across different timeframes (1min, 5min, 15min, 1hr)</li>
<li>Study how correlation strength varies with market conditions</li>
<li>Identify minimum correlation thresholds for reliable signals</li>
<li>[x] <strong>Volume Confirmation Study:</strong></li>
<li>Correlate volume spikes with successful lag trades</li>
<li>Define volume thresholds for signal validation</li>
</ul>
<h3>2.2 Historical Pattern Recognition ‚úÖ</h3>
<ul>
<li>[x] Identify success rate of lag trades by asset pair</li>
<li>[x] Analyze failure modes (when followers don't follow)</li>
<li>[x] Measure typical profit/loss ratios</li>
<li>[x] Study impact of market regime on strategy performance</li>
</ul>
<hr />
<h2>Phase 3: Signal Generation Logic ‚úÖ COMPLETED</h2>
<h3>3.1 Entry Trigger Conditions ‚úÖ</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Implemented in LagBasedStrategy.generate_signals()</span>
<span class="n">IF</span> <span class="n">leader_move</span> <span class="o">&gt;=</span> <span class="n">threshold</span> <span class="n">AND</span> 
   <span class="n">follower_move</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">leader_move</span> <span class="o">*</span> <span class="n">lag_factor</span><span class="p">)</span> <span class="n">AND</span>
   <span class="n">correlation</span> <span class="o">&gt;=</span> <span class="n">min_correlation</span> <span class="n">AND</span>
   <span class="n">volume_confirmation</span> <span class="o">==</span> <span class="kc">True</span> <span class="n">THEN</span>
   <span class="n">generate_signal</span><span class="p">()</span>
</code></pre></div>

<h3>3.2 Risk Management ‚úÖ</h3>
<ul>
<li>Position sizing: 2% risk per trade (configurable)</li>
<li>Stop loss: 5% (configurable)</li>
<li>Take profit: 10% (configurable)</li>
<li>Max concurrent positions: 3 (configurable)</li>
</ul>
<hr />
<h2>Phase 4: Production Implementation ‚úÖ COMPLETED</h2>
<h3>4.1 System Integration ‚úÖ</h3>
<ul>
<li>[x] Integration with QuantDesk CSV storage system</li>
<li>[x] CLI interface for easy usage</li>
<li>[x] Configuration management</li>
<li>[x] Logging and monitoring</li>
</ul>
<h3>4.2 Dual Mode Support ‚úÖ</h3>
<ul>
<li>[x] All-followers mode for discovery</li>
<li>[x] Grouped-followers mode for targeted analysis</li>
<li>[x] Dynamic mode switching</li>
<li>[x] Support for 40+ asset pairs</li>
</ul>
<h3>4.3 Performance Tracking ‚úÖ</h3>
<ul>
<li>[x] Backtesting engine</li>
<li>[x] Performance metrics calculation</li>
<li>[x] Analysis and visualization tools</li>
<li>[x] Report generation</li>
</ul>
<hr />
<h2>üéØ Next Steps &amp; Recommendations</h2>
<ol>
<li><strong>Start with Analysis</strong>: Run the analysis command to understand your data</li>
<li><strong>Optimize Thresholds</strong>: Use the optimization tools to find best parameters</li>
<li><strong>Backtest</strong>: Test the strategy on historical data</li>
<li><strong>Monitor</strong>: Use the status command to check system health</li>
<li><strong>Iterate</strong>: Adjust parameters based on results</li>
</ol>
<hr />
<h2>üìö Additional Resources</h2>
<ul>
<li><strong>Configuration Guide</strong>: See <code>configs/lag_strategy_config.yaml</code> for all options</li>
<li><strong>CLI Help</strong>: Run any command with <code>--help</code> for detailed usage</li>
<li><strong>Analysis Results</strong>: Check <code>results/lag_strategy/</code> for generated reports</li>
<li><strong>Logs</strong>: Check <code>logs/lag_strategy.log</code> for detailed execution logs</li>
</ul>
<hr />
<h2>üìù Results Log</h2>
<p>Paste or summarize your key findings from each analysis/backtest session here!</p>
<h3>2025-07-16: First Analysis</h3>
<ul>
<li>BTC, ETH, SOL loaded from Coinbase 1m data (last 30 days)</li>
<li>SHIB loaded as follower (WIF, PEPE not found for this period)</li>
<li>SHIB lagged ETH (25.8% response, median lag 15min) and SOL (30% response, median lag 10min)</li>
<li>No significant lag found for BTC-&gt;SHIB</li>
<li>Next: Try more followers, run backtest, and optimize thresholds</li>
</ul>
<hr />
    </div>
</body>
</html>