<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oauth Setup Instructions - QuantDesk Documentation</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <style>
        body {
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace;
            line-height: 1.6;
            color: #ffffff;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #000000;
            font-size: 14px;
        }
        .container {
            background: #000000;
            padding: 30px;
            border-radius: 8px;
            border: 1px solid #333333;
        }
        .back-link {
            margin-bottom: 20px;
        }
        .back-link a {
            color: #3b82f6;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s ease;
        }
        .back-link a:hover {
            color: #60a5fa;
            text-decoration: underline;
        }
        h1, h2, h3, h4, h5, h6 {
            color: #ffffff;
            margin-top: 30px;
            margin-bottom: 15px;
            font-weight: 600;
        }
        h1 {
            border-bottom: 2px solid #333333;
            padding-bottom: 10px;
        }
        h2 {
            border-bottom: 1px solid #333333;
            padding-bottom: 8px;
        }
        code {
            background: #1a1a1a;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace;
            color: #ffffff;
            border: 1px solid #333333;
        }
        pre {
            background: #0a0a0a;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            border: 1px solid #333333;
            margin: 20px 0;
        }
        pre code {
            background: none;
            padding: 0;
            color: #ffffff;
            border: none;
        }
        blockquote {
            border-left: 4px solid #3b82f6;
            margin: 0;
            padding-left: 20px;
            color: #d9d9d9;
            background: #1a1a1a;
            padding: 15px 20px;
            border-radius: 0 8px 8px 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            border: 1px solid #333333;
        }
        th, td {
            border: 1px solid #333333;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #1a1a1a;
            font-weight: bold;
            color: #ffffff;
        }
        td {
            color: #d9d9d9;
        }
        ul, ol {
            color: #d9d9d9;
        }
        li {
            margin-bottom: 8px;
        }
        a {
            color: #3b82f6;
            text-decoration: none;
        }
        a:hover {
            color: #60a5fa;
            text-decoration: underline;
        }
        /* Syntax Highlighting Overrides */
        pre[class*="language-"] {
            background: #0a0a0a !important;
            border: 1px solid #333333 !important;
            border-radius: 8px !important;
            padding: 20px !important;
            margin: 20px 0 !important;
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace !important;
            font-size: 13px !important;
            line-height: 1.5 !important;
        }
        .token.comment { color: #6a9955 !important; }
        .token.keyword { color: #569cd6 !important; }
        .token.string { color: #ce9178 !important; }
        .token.number { color: #b5cea8 !important; }
        .token.function { color: #dcdcaa !important; }
        .token.class-name { color: #4ec9b0 !important; }
        .token.operator { color: #d4d4d4 !important; }
        .token.punctuation { color: #d4d4d4 !important; }
        .token.variable { color: #9cdcfe !important; }
        .token.constant { color: #4fc1ff !important; }
    </style>
</head>
<body>
    <div class="container">
        <div class="back-link">
            <a href="/">&larr; Back to Documentation</a>
        </div>
        <h1>OAuth Setup Instructions</h1>
<h2>Google OAuth Setup</h2>
<h3>Step 1: Create Google Cloud Project</h3>
<ol>
<li>Go to <a href="https://console.cloud.google.com/">Google Cloud Console</a></li>
<li>Click "Select a project" → "New Project"</li>
<li>Enter project name: <code>QuantDesk Admin</code></li>
<li>Click "Create"</li>
</ol>
<h3>Step 2: Enable Google+ API</h3>
<ol>
<li>In the Google Cloud Console, go to "APIs &amp; Services" → "Library"</li>
<li>Search for "Google+ API"</li>
<li>Click on it and press "Enable"</li>
</ol>
<h3>Step 3: Create OAuth 2.0 Credentials</h3>
<ol>
<li>Go to "APIs &amp; Services" → "Credentials"</li>
<li>Click "Create Credentials" → "OAuth 2.0 Client ID"</li>
<li>If prompted, configure the OAuth consent screen:</li>
<li>User Type: External</li>
<li>App name: <code>QuantDesk Admin Dashboard</code></li>
<li>User support email: your email</li>
<li>Developer contact: your email</li>
<li>Save and continue through the steps</li>
</ol>
<h3>Step 4: Configure OAuth Client</h3>
<ol>
<li>Application type: Web application</li>
<li>Name: <code>QuantDesk Admin Dashboard</code></li>
<li>Authorized redirect URIs:</li>
<li>Development: <code>http://localhost:3002/api/admin/auth/google/callback</code></li>
<li>Production: <code>https://your-backend-domain.com/api/admin/auth/google/callback</code></li>
<li>Click "Create"</li>
</ol>
<h3>Step 5: Get Credentials</h3>
<ul>
<li>Copy the <strong>Client ID</strong> and <strong>Client Secret</strong></li>
<li>Add them to your <code>.env</code> file:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nv">GOOGLE_CLIENT_ID</span><span class="o">=</span>your_google_client_id_here
<span class="nv">GOOGLE_CLIENT_SECRET</span><span class="o">=</span>your_google_client_secret_here
</code></pre></div>

<hr />
<h2>GitHub OAuth Setup</h2>
<h3>Step 1: Create GitHub OAuth App</h3>
<ol>
<li>Go to <a href="https://github.com/settings/developers">GitHub Developer Settings</a></li>
<li>Click "New OAuth App"</li>
</ol>
<h3>Step 2: Configure OAuth App</h3>
<ol>
<li><strong>Application name</strong>: <code>QuantDesk Admin Dashboard</code></li>
<li><strong>Homepage URL</strong>: </li>
<li>Development: <code>http://localhost:3001</code></li>
<li>Production: <code>https://your-frontend-domain.com</code></li>
<li><strong>Application description</strong>: <code>Admin dashboard for QuantDesk perpetual DEX</code></li>
<li><strong>Authorization callback URL</strong>:</li>
<li>Development: <code>http://localhost:3002/api/admin/auth/github/callback</code></li>
<li>Production: <code>https://your-backend-domain.com/api/admin/auth/github/callback</code></li>
<li>Click "Register application"</li>
</ol>
<h3>Step 3: Get Credentials</h3>
<ul>
<li>Copy the <strong>Client ID</strong> and <strong>Client Secret</strong></li>
<li>Add them to your <code>.env</code> file:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nv">GITHUB_CLIENT_ID</span><span class="o">=</span>your_github_client_id_here
<span class="nv">GITHUB_CLIENT_SECRET</span><span class="o">=</span>your_github_client_secret_here
</code></pre></div>

<hr />
<h2>Environment Variables to Add</h2>
<p>Add these to your existing <code>.env</code> file:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># OAuth Configuration (Admin)</span>
<span class="nv">GOOGLE_CLIENT_ID</span><span class="o">=</span>your_google_client_id_here
<span class="nv">GOOGLE_CLIENT_SECRET</span><span class="o">=</span>your_google_client_secret_here
<span class="nv">GITHUB_CLIENT_ID</span><span class="o">=</span>your_github_client_id_here
<span class="nv">GITHUB_CLIENT_SECRET</span><span class="o">=</span>your_github_client_secret_here

<span class="c1"># Admin JWT Secret (generate a strong secret)</span>
<span class="nv">ADMIN_JWT_SECRET</span><span class="o">=</span>your_strong_admin_jwt_secret_here

<span class="c1"># Backend URL for OAuth redirects</span>
<span class="nv">BACKEND_URL</span><span class="o">=</span>http://localhost:3002
<span class="nv">FRONTEND_URL</span><span class="o">=</span>http://localhost:3001

<span class="c1"># AI Service URL</span>
<span class="nv">MIKEY_AI_URL</span><span class="o">=</span>http://localhost:3000
</code></pre></div>

<hr />
<h2>Testing OAuth Setup</h2>
<h3>1. Start the Backend</h3>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>backend
pnpm<span class="w"> </span>run<span class="w"> </span>dev
</code></pre></div>

<h3>2. Test OAuth Endpoints</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Test Google OAuth (should redirect to Google)</span>
curl<span class="w"> </span>-v<span class="w"> </span>http://localhost:3002/api/admin/auth/google

<span class="c1"># Test GitHub OAuth (should redirect to GitHub)</span>
curl<span class="w"> </span>-v<span class="w"> </span>http://localhost:3002/api/admin/auth/github
</code></pre></div>

<h3>3. Test Admin Dashboard</h3>
<ol>
<li>Navigate to <code>http://localhost:3001/admin</code></li>
<li>Click "Continue with Google" or "Continue with GitHub"</li>
<li>Complete OAuth flow</li>
<li>Should redirect back to admin dashboard with access</li>
</ol>
<hr />
<h2>Troubleshooting</h2>
<h3>Common Issues</h3>
<h4>1. "Invalid redirect URI" Error</h4>
<ul>
<li>Check that the redirect URI in OAuth app matches exactly</li>
<li>Ensure no trailing slashes</li>
<li>Check for typos in the URL</li>
</ul>
<h4>2. "Client ID not found" Error</h4>
<ul>
<li>Verify the Client ID is correct</li>
<li>Check that the OAuth app is properly configured</li>
<li>Ensure the project is active</li>
</ul>
<h4>3. "Redirect URI mismatch" Error</h4>
<ul>
<li>Double-check the redirect URI in both Google/GitHub settings</li>
<li>Make sure the backend URL is correct</li>
<li>Check for HTTP vs HTTPS mismatches</li>
</ul>
<h4>4. OAuth Flow Completes but No Access</h4>
<ul>
<li>Check that your email is in the <code>admin_users</code> table</li>
<li>Verify the admin user has <code>is_active = true</code></li>
<li>Check backend logs for errors</li>
</ul>
<h3>Debug Steps</h3>
<ol>
<li><strong>Check Environment Variables</strong>:</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="nv">$GOOGLE_CLIENT_ID</span>
<span class="nb">echo</span><span class="w"> </span><span class="nv">$GITHUB_CLIENT_ID</span>
<span class="nb">echo</span><span class="w"> </span><span class="nv">$ADMIN_JWT_SECRET</span>
</code></pre></div>

<ol>
<li><strong>Check Backend Logs</strong>:</li>
</ol>
<div class="codehilite"><pre><span></span><code>tail<span class="w"> </span>-f<span class="w"> </span>logs/backend-dev.log
</code></pre></div>

<ol>
<li><strong>Test OAuth Endpoints</strong>:</li>
</ol>
<div class="codehilite"><pre><span></span><code>curl<span class="w"> </span>-v<span class="w"> </span>http://localhost:3002/api/admin/auth/google
curl<span class="w"> </span>-v<span class="w"> </span>http://localhost:3002/api/admin/auth/github
</code></pre></div>

<ol>
<li><strong>Check Database Connection</strong>:</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="c1"># Test if admin_users table exists and is accessible</span>
psql<span class="w"> </span>-d<span class="w"> </span>your_database<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;SELECT COUNT(*) FROM admin_users;&quot;</span>
</code></pre></div>

<hr />
<h2>Production Deployment</h2>
<h3>Update OAuth Apps for Production</h3>
<h4>Google OAuth</h4>
<ol>
<li>Go to Google Cloud Console</li>
<li>Update OAuth client settings</li>
<li>Add production redirect URI:</li>
<li><code>https://your-backend-domain.com/api/admin/auth/google/callback</code></li>
</ol>
<h4>GitHub OAuth</h4>
<ol>
<li>Go to GitHub Developer Settings</li>
<li>Update OAuth app settings</li>
<li>Update callback URL:</li>
<li><code>https://your-backend-domain.com/api/admin/auth/github/callback</code></li>
</ol>
<h3>Environment Variables for Production</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Production URLs</span>
<span class="nv">BACKEND_URL</span><span class="o">=</span>https://your-backend-domain.com
<span class="nv">FRONTEND_URL</span><span class="o">=</span>https://your-frontend-domain.com

<span class="c1"># Same OAuth credentials (they work for both dev and prod)</span>
<span class="nv">GOOGLE_CLIENT_ID</span><span class="o">=</span>your_google_client_id
<span class="nv">GOOGLE_CLIENT_SECRET</span><span class="o">=</span>your_google_client_secret
<span class="nv">GITHUB_CLIENT_ID</span><span class="o">=</span>your_github_client_id
<span class="nv">GITHUB_CLIENT_SECRET</span><span class="o">=</span>your_github_client_secret
</code></pre></div>

<hr />
<h2>Security Notes</h2>
<ol>
<li><strong>Never commit OAuth secrets</strong> to version control</li>
<li><strong>Use strong JWT secrets</strong> (at least 32 characters)</li>
<li><strong>Rotate OAuth secrets</strong> regularly</li>
<li><strong>Monitor admin access logs</strong> for suspicious activity</li>
<li><strong>Use HTTPS</strong> in production</li>
<li><strong>Implement IP whitelisting</strong> for admin access in production</li>
</ol>
<hr />
<h2>Next Steps After OAuth Setup</h2>
<ol>
<li>✅ <strong>OAuth Setup Complete</strong></li>
<li>⏳ <strong>Apply Database Security Fixes</strong> (next step)</li>
<li>⏳ <strong>Test Admin Dashboard</strong></li>
<li>⏳ <strong>Deploy to Production</strong></li>
</ol>
<p>Once OAuth is set up, we'll proceed with applying the database security fixes!</p>
    </div>
</body>
</html>