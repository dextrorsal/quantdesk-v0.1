<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Full-Services-Architecture - QuantDesk Documentation</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <style>
        body {
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace;
            line-height: 1.6;
            color: #ffffff;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #000000;
            font-size: 14px;
        }
        .container {
            background: #000000;
            padding: 30px;
            border-radius: 8px;
            border: 1px solid #333333;
        }
        .back-link {
            margin-bottom: 20px;
        }
        .back-link a {
            color: #3b82f6;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s ease;
        }
        .back-link a:hover {
            color: #60a5fa;
            text-decoration: underline;
        }
        h1, h2, h3, h4, h5, h6 {
            color: #ffffff;
            margin-top: 30px;
            margin-bottom: 15px;
            font-weight: 600;
        }
        h1 {
            border-bottom: 2px solid #333333;
            padding-bottom: 10px;
        }
        h2 {
            border-bottom: 1px solid #333333;
            padding-bottom: 8px;
        }
        code {
            background: #1a1a1a;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace;
            color: #ffffff;
            border: 1px solid #333333;
        }
        pre {
            background: #0a0a0a;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            border: 1px solid #333333;
            margin: 20px 0;
        }
        pre code {
            background: none;
            padding: 0;
            color: #ffffff;
            border: none;
        }
        blockquote {
            border-left: 4px solid #3b82f6;
            margin: 0;
            padding-left: 20px;
            color: #d9d9d9;
            background: #1a1a1a;
            padding: 15px 20px;
            border-radius: 0 8px 8px 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            border: 1px solid #333333;
        }
        th, td {
            border: 1px solid #333333;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #1a1a1a;
            font-weight: bold;
            color: #ffffff;
        }
        td {
            color: #d9d9d9;
        }
        ul, ol {
            color: #d9d9d9;
        }
        li {
            margin-bottom: 8px;
        }
        a {
            color: #3b82f6;
            text-decoration: none;
        }
        a:hover {
            color: #60a5fa;
            text-decoration: underline;
        }
        /* Syntax Highlighting Overrides */
        pre[class*="language-"] {
            background: #0a0a0a !important;
            border: 1px solid #333333 !important;
            border-radius: 8px !important;
            padding: 20px !important;
            margin: 20px 0 !important;
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace !important;
            font-size: 13px !important;
            line-height: 1.5 !important;
        }
        .token.comment { color: #6a9955 !important; }
        .token.keyword { color: #569cd6 !important; }
        .token.string { color: #ce9178 !important; }
        .token.number { color: #b5cea8 !important; }
        .token.function { color: #dcdcaa !important; }
        .token.class-name { color: #4ec9b0 !important; }
        .token.operator { color: #d4d4d4 !important; }
        .token.punctuation { color: #d4d4d4 !important; }
        .token.variable { color: #9cdcfe !important; }
        .token.constant { color: #4fc1ff !important; }
    </style>
</head>
<body>
    <div class="container">
        <div class="back-link">
            <a href="/">&larr; Back to Documentation</a>
        </div>
        <h1>QuantDesk Architecture Documentation</h1>
<h2>Executive Summary</h2>
<p>QuantDesk implements a sophisticated multi-service architecture optimized for Solana-based perpetual trading. The platform features enterprise-grade security, real-time data ingestion, AI-powered trading assistance, and professional-grade infrastructure designed for institutional and retail traders.</p>
<h2>Architecture Overview</h2>
<h3>Multi-Service Architecture</h3>
<table>
<thead>
<tr>
<th>Service</th>
<th>Port</th>
<th>Technology</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Backend</strong></td>
<td>3002</td>
<td>Node.js/Express/TypeScript</td>
<td>API Gateway, Database, Oracle</td>
</tr>
<tr>
<td><strong>Frontend</strong></td>
<td>3001</td>
<td>React/Vite/TypeScript</td>
<td>Trading Interface, Portfolio</td>
</tr>
<tr>
<td><strong>MIKEY-AI</strong></td>
<td>3000</td>
<td>LangChain/TypeScript</td>
<td>AI Trading Agent</td>
</tr>
<tr>
<td><strong>Data Ingestion</strong></td>
<td>3003</td>
<td>Node.js/Pipeline</td>
<td>Real-time Data Collection</td>
</tr>
</tbody>
</table>
<h3>Core Design Principles</h3>
<ol>
<li><strong>Backend-Centric Oracle</strong>: Pyth prices fetched by backend, normalized and cached</li>
<li><strong>Consolidated Database Service</strong>: Single abstraction layer prevents direct Supabase usage</li>
<li><strong>Multi-Service Coordination</strong>: Services communicate via backend API gateway</li>
<li><strong>Enterprise-Grade Security</strong>: Multi-layer security with comprehensive monitoring</li>
</ol>
<h2>Technology Stack</h2>
<h3>Core Technologies</h3>
<ul>
<li><strong>Backend</strong>: Node.js 20+, Express.js, TypeScript, pnpm</li>
<li><strong>Frontend</strong>: React 18, Vite, Tailwind CSS, TypeScript</li>
<li><strong>Smart Contracts</strong>: Rust, Anchor Framework, Solana</li>
<li><strong>Database</strong>: Supabase (PostgreSQL)</li>
<li><strong>Oracle</strong>: Pyth Network</li>
<li><strong>AI</strong>: LangChain, Multi-LLM routing</li>
</ul>
<h3>Deployment Infrastructure</h3>
<ul>
<li><strong>Frontend/Backend</strong>: Vercel</li>
<li><strong>Optional</strong>: Railway for backend</li>
<li><strong>Smart Contracts</strong>: Solana devnet/mainnet</li>
<li><strong>Monitoring</strong>: Grafana dashboards</li>
</ul>
<h2>Service Architecture</h2>
<h3>Backend Service (Port 3002)</h3>
<ul>
<li><strong>API Gateway</strong>: Centralized API management</li>
<li><strong>Database Service</strong>: Supabase abstraction layer</li>
<li><strong>Oracle Integration</strong>: Pyth Network price feeds</li>
<li><strong>Authentication</strong>: Multi-factor authentication</li>
<li><strong>Rate Limiting</strong>: Tiered rate limits</li>
<li><strong>Error Handling</strong>: Custom error classes</li>
</ul>
<h3>Frontend Service (Port 3001)</h3>
<ul>
<li><strong>Trading Interface</strong>: Professional trading terminal</li>
<li><strong>Portfolio Management</strong>: Real-time portfolio tracking</li>
<li><strong>User Dashboard</strong>: Account management and analytics</li>
<li><strong>Responsive Design</strong>: Mobile and desktop optimized</li>
</ul>
<h3>MIKEY-AI Service (Port 3000)</h3>
<ul>
<li><strong>AI Trading Agent</strong>: LangChain-powered assistant</li>
<li><strong>Market Analysis</strong>: Real-time market intelligence</li>
<li><strong>Trading Recommendations</strong>: AI-powered suggestions</li>
<li><strong>Multi-LLM Routing</strong>: Intelligent LLM selection</li>
</ul>
<h3>Data Ingestion Service (Port 3003)</h3>
<ul>
<li><strong>Real-time Data</strong>: Market data collection</li>
<li><strong>Data Processing</strong>: Data normalization and storage</li>
<li><strong>Pipeline Management</strong>: Data flow orchestration</li>
<li><strong>Monitoring</strong>: Data quality and pipeline health</li>
</ul>
<h2>Security Architecture</h2>
<h3>Enterprise-Grade Security Implementation</h3>
<ul>
<li><strong>Multi-Layer Security</strong>: Defense in depth strategy</li>
<li><strong>Multi-Factor Authentication</strong>: Enhanced user verification</li>
<li><strong>Dynamic Oracle Staleness Protection</strong>: Real-time oracle validation</li>
<li><strong>Comprehensive Monitoring</strong>: Real-time security monitoring</li>
<li><strong>Audit Trails</strong>: Complete transaction logging</li>
</ul>
<h3>Security Validation</h3>
<ul>
<li><strong>QA Score</strong>: 95/100 security validation</li>
<li><strong>Status</strong>: PASS - Enterprise-grade security achieved</li>
<li><strong>Last Updated</strong>: October 18, 2025</li>
</ul>
<h2>Database Architecture</h2>
<h3>Supabase Integration</h3>
<ul>
<li><strong>PostgreSQL</strong>: Primary database</li>
<li><strong>Real-time Subscriptions</strong>: Live data updates</li>
<li><strong>Row Level Security</strong>: Data access control</li>
<li><strong>API Integration</strong>: RESTful and GraphQL APIs</li>
</ul>
<h3>Database Schema</h3>
<h4>Core Tables</h4>
<ul>
<li><strong>users</strong>: Wallet-based authentication with KYC, risk levels, referral tracking</li>
<li><strong>markets</strong>: Perpetual contract configuration with Pyth price feeds</li>
<li><strong>positions</strong>: Trading positions with health factors and liquidation tracking</li>
<li><strong>orders</strong>: Advanced order types (market, limit, stop-loss, take-profit, trailing-stop)</li>
<li><strong>trades</strong>: Trade execution history with PnL tracking</li>
<li><strong>user_balances</strong>: Multi-asset balance management</li>
<li><strong>funding_payments</strong>: Funding rate calculations and payments</li>
<li><strong>liquidations</strong>: Liquidation events and insurance fund usage</li>
<li><strong>chat_channels</strong>: Multi-channel chat system</li>
<li><strong>chat_messages</strong>: Message history with mentions and system announcements</li>
<li><strong>system_events</strong>: Monitoring and debugging events</li>
</ul>
<h4>Data Types</h4>
<ul>
<li><strong>Custom ENUMs</strong>: <code>position_side</code>, <code>order_type</code>, <code>order_status</code>, <code>trade_side</code>, <code>liquidation_type</code></li>
<li><strong>JSONB Fields</strong>: Flexible metadata storage for extensibility</li>
<li><strong>TimescaleDB</strong>: Time-series data for market data and analytics</li>
<li><strong>UUID Primary Keys</strong>: Distributed system compatibility</li>
</ul>
<h4>Performance Optimizations</h4>
<ul>
<li><strong>Indexes</strong>: Optimized for trading queries (user_id, market_id, created_at)</li>
<li><strong>Partitioning</strong>: Time-based partitioning for high-volume tables</li>
<li><strong>Connection Pooling</strong>: Efficient database connection management</li>
</ul>
<h2>Smart Contract Architecture</h2>
<h3>Solana Program Structure</h3>
<ul>
<li><strong>Program ID</strong>: <code>HsSzXVuSwiqGQvocT2zMX8zc86KQ9TYfZFZcfmmejzso</code></li>
<li><strong>Anchor Framework</strong>: Rust-based smart contracts</li>
<li><strong>Modular Design</strong>: Organized instruction modules by domain</li>
</ul>
<h3>Contract Components</h3>
<ul>
<li><strong>Market Management</strong>: <code>initialize_market()</code>, <code>update_oracle_price()</code>, <code>settle_funding()</code></li>
<li><strong>Position Management</strong>: <code>open_position()</code>, <code>close_position()</code> - Critical trading functions</li>
<li><strong>Order Management</strong>: <code>place_order()</code>, <code>cancel_order()</code>, <code>execute_order()</code> - Advanced order types</li>
<li><strong>Collateral Management</strong>: <code>deposit_native_sol()</code>, <code>withdraw_native_sol()</code> - SOL operations</li>
<li><strong>Vault Management</strong>: <code>initialize_token_vault()</code>, <code>deposit_tokens()</code>, <code>withdraw_tokens()</code> - Token operations</li>
<li><strong>User Account Management</strong>: <code>create_user_account()</code>, <code>update_user_account()</code> - Account lifecycle</li>
<li><strong>Security Management</strong>: Enterprise-grade security controls and validation</li>
</ul>
<h3>Account Structures</h3>
<ul>
<li><strong>UserAccount</strong>: User state management with sub-accounts</li>
<li><strong>TokenVault</strong>: Token vault with authority and deposit tracking</li>
<li><strong>ProtocolSolVault</strong>: Protocol-level SOL vault management</li>
<li><strong>Market</strong>: Market configuration and state</li>
<li><strong>Position</strong>: Position data with health factors</li>
<li><strong>Order</strong>: Order management with advanced types</li>
</ul>
<h2>AI Architecture</h2>
<h3>MIKEY-AI Implementation</h3>
<ul>
<li><strong>LangChain Framework</strong>: AI agent orchestration</li>
<li><strong>Multi-LLM Routing</strong>: Intelligent model selection</li>
<li><strong>Tool Integration</strong>: Trading and analysis tools</li>
<li><strong>Memory Management</strong>: Context and conversation memory</li>
</ul>
<h3>AI Capabilities</h3>
<ul>
<li><strong>Market Analysis</strong>: Real-time market intelligence</li>
<li><strong>Trading Recommendations</strong>: AI-powered suggestions</li>
<li><strong>Risk Assessment</strong>: Automated risk analysis</li>
<li><strong>User Assistance</strong>: Natural language interaction</li>
</ul>
<h3>AI Service Architecture</h3>
<ul>
<li><strong>Port 3000</strong>: Dedicated AI service</li>
<li><strong>API Integration</strong>: <code>/api/ai/*</code>, <code>/api/chat/*</code> endpoints</li>
<li><strong>WebSocket Support</strong>: Real-time AI interactions</li>
<li><strong>Tool Ecosystem</strong>: Trading tools, market analysis, portfolio management</li>
<li><strong>Memory Persistence</strong>: Conversation and context management</li>
</ul>
<h2>Monitoring and Observability</h2>
<h3>Monitoring Stack</h3>
<ul>
<li><strong>Grafana Dashboards</strong>: Real-time monitoring</li>
<li><strong>Prometheus Metrics</strong>: System performance tracking</li>
<li><strong>Log Aggregation</strong>: Centralized logging</li>
<li><strong>Alert Management</strong>: Proactive alerting</li>
</ul>
<h3>Key Metrics</h3>
<ul>
<li><strong>Performance</strong>: Response times, throughput</li>
<li><strong>Security</strong>: Authentication, authorization</li>
<li><strong>Business</strong>: Trading volume, user activity</li>
<li><strong>Infrastructure</strong>: Resource utilization, health</li>
</ul>
<h2>Deployment Architecture</h2>
<h3>Production Deployment</h3>
<ul>
<li><strong>Frontend</strong>: Vercel CDN distribution</li>
<li><strong>Backend</strong>: Vercel serverless functions</li>
<li><strong>Database</strong>: Supabase managed PostgreSQL</li>
<li><strong>Smart Contracts</strong>: Solana mainnet deployment</li>
</ul>
<h3>Development Environment</h3>
<ul>
<li><strong>Local Development</strong>: Docker Compose setup</li>
<li><strong>Testing</strong>: Comprehensive test suites</li>
<li><strong>CI/CD</strong>: Automated deployment pipelines</li>
<li><strong>Quality Gates</strong>: QA validation checkpoints</li>
</ul>
<h2>Scalability Considerations</h2>
<h3>Horizontal Scaling</h3>
<ul>
<li><strong>Microservices</strong>: Independent service scaling</li>
<li><strong>Load Balancing</strong>: Traffic distribution</li>
<li><strong>Caching</strong>: Redis caching layer</li>
<li><strong>CDN</strong>: Content delivery optimization</li>
</ul>
<h3>Performance Optimization</h3>
<ul>
<li><strong>Database Indexing</strong>: Query optimization</li>
<li><strong>Connection Pooling</strong>: Database connection management</li>
<li><strong>Caching Strategies</strong>: Multi-level caching</li>
<li><strong>Code Splitting</strong>: Frontend optimization</li>
</ul>
<h2>Integration Architecture</h2>
<h3>External Integrations</h3>
<ul>
<li><strong>Pyth Network</strong>: Oracle price feeds</li>
<li><strong>Solana RPC</strong>: Blockchain interaction</li>
<li><strong>Supabase</strong>: Database and authentication</li>
<li><strong>Vercel</strong>: Deployment and hosting</li>
</ul>
<h3>API Architecture</h3>
<h4>Core API Endpoints</h4>
<ul>
<li><strong>Authentication</strong>: <code>/api/auth/*</code> - SIWS, OAuth, JWT management</li>
<li><strong>Trading</strong>: <code>/api/positions/*</code>, <code>/api/orders/*</code>, <code>/api/trades/*</code> - Position and order management</li>
<li><strong>Markets</strong>: <code>/api/markets/*</code> - Market data and configuration</li>
<li><strong>Oracle</strong>: <code>/api/oracle/*</code> - Pyth Network price feeds</li>
<li><strong>Portfolio</strong>: <code>/api/portfolio/*</code> - User portfolio analytics</li>
<li><strong>AI Agent</strong>: <code>/api/ai/*</code>, <code>/api/chat/*</code> - MIKEY-AI integration</li>
<li><strong>Admin</strong>: <code>/api/admin/*</code> - Administrative functions</li>
<li><strong>Webhooks</strong>: <code>/api/webhooks/*</code> - Event subscriptions</li>
</ul>
<h4>Real-time Communication</h4>
<ul>
<li><strong>WebSocket</strong>: Live market data, position updates, order status</li>
<li><strong>Socket.IO</strong>: Chat system, notifications, system events</li>
<li><strong>Rate Limiting</strong>: Tiered limits (100/min for trading, 1000/min for data)</li>
</ul>
<h4>API Documentation</h4>
<ul>
<li><strong>OpenAPI/Swagger</strong>: <code>/api/docs/swagger</code> - Complete API specification</li>
<li><strong>AI-Optimized</strong>: Structured for AI assistant integration</li>
<li><strong>Development Endpoints</strong>: <code>/api/dev/*</code> - Architecture introspection</li>
</ul>
<h2>Security Considerations</h2>
<h3>Data Protection</h3>
<ul>
<li><strong>Encryption</strong>: Data encryption at rest and in transit</li>
<li><strong>Access Control</strong>: Role-based access management</li>
<li><strong>Audit Logging</strong>: Comprehensive activity logging</li>
<li><strong>Compliance</strong>: Regulatory compliance measures</li>
</ul>
<h3>Smart Contract Security</h3>
<ul>
<li><strong>Code Audits</strong>: Comprehensive security audits</li>
<li><strong>Input Validation</strong>: Comprehensive input validation</li>
<li><strong>Access Control</strong>: Program-level access control</li>
<li><strong>Upgrade Mechanisms</strong>: Secure upgrade procedures</li>
</ul>
<h2>Future Architecture Considerations</h2>
<h3>Planned Enhancements</h3>
<ul>
<li><strong>Mobile Applications</strong>: Native mobile apps</li>
<li><strong>Cross-Chain Integration</strong>: Multi-blockchain support</li>
<li><strong>Advanced AI</strong>: Enhanced AI capabilities</li>
<li><strong>Institutional Features</strong>: Enterprise-grade features</li>
</ul>
<h3>Scalability Roadmap</h3>
<ul>
<li><strong>Microservices Evolution</strong>: Further service decomposition</li>
<li><strong>Event-Driven Architecture</strong>: Asynchronous processing</li>
<li><strong>Advanced Caching</strong>: Multi-tier caching strategies</li>
<li><strong>Global Distribution</strong>: Multi-region deployment</li>
</ul>
<h2>Current Implementation Status</h2>
<h3>Production Ready Components</h3>
<ul>
<li>✅ <strong>Backend Service</strong>: Full API implementation with 50+ endpoints</li>
<li>✅ <strong>Frontend Service</strong>: Complete trading interface with portfolio management</li>
<li>✅ <strong>Smart Contracts</strong>: Deployed on Solana devnet with comprehensive instruction set</li>
<li>✅ <strong>Database Schema</strong>: Production-ready PostgreSQL schema with TimescaleDB</li>
<li>✅ <strong>Security Architecture</strong>: Enterprise-grade security with 95/100 QA score</li>
<li>✅ <strong>Oracle Integration</strong>: Pyth Network integration with real-time price feeds</li>
<li>✅ <strong>AI Service</strong>: MIKEY-AI with LangChain integration</li>
</ul>
<h3>Deployment Status</h3>
<ul>
<li><strong>Frontend</strong>: Deployed on Vercel (Port 3001)</li>
<li><strong>Backend</strong>: Deployed on Vercel (Port 3002)</li>
<li><strong>AI Service</strong>: Deployed on Railway (Port 3000)</li>
<li><strong>Data Ingestion</strong>: Local deployment (Port 3003)</li>
<li><strong>Smart Contracts</strong>: Deployed on Solana devnet</li>
<li><strong>Database</strong>: Supabase PostgreSQL with production schema</li>
</ul>
<h3>Active Features</h3>
<ul>
<li><strong>Trading</strong>: Position management, order placement, real-time execution</li>
<li><strong>Portfolio</strong>: Multi-asset portfolio tracking and analytics</li>
<li><strong>Chat System</strong>: Multi-channel chat with mentions and system announcements</li>
<li><strong>Admin Panel</strong>: Complete administrative interface</li>
<li><strong>Webhooks</strong>: Event subscription system</li>
<li><strong>API Documentation</strong>: OpenAPI/Swagger specification</li>
<li><strong>Monitoring</strong>: Grafana dashboards and system metrics</li>
</ul>
<hr />
<p><strong>Architecture Status</strong>: Production Ready<br />
<strong>Last Updated</strong>: October 18, 2025<br />
<strong>Next Review</strong>: November 2025<br />
<strong>Implementation</strong>: 95% Complete - Enterprise Grade</p>
    </div>
</body>
</html>