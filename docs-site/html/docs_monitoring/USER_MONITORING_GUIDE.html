<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Monitoring Guide - QuantDesk Documentation</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <style>
        body {
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace;
            line-height: 1.6;
            color: #ffffff;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #000000;
            font-size: 14px;
        }
        .container {
            background: #000000;
            padding: 30px;
            border-radius: 8px;
            border: 1px solid #333333;
        }
        .back-link {
            margin-bottom: 20px;
        }
        .back-link a {
            color: #3b82f6;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s ease;
        }
        .back-link a:hover {
            color: #60a5fa;
            text-decoration: underline;
        }
        h1, h2, h3, h4, h5, h6 {
            color: #ffffff;
            margin-top: 30px;
            margin-bottom: 15px;
            font-weight: 600;
        }
        h1 {
            border-bottom: 2px solid #333333;
            padding-bottom: 10px;
        }
        h2 {
            border-bottom: 1px solid #333333;
            padding-bottom: 8px;
        }
        code {
            background: #1a1a1a;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace;
            color: #ffffff;
            border: 1px solid #333333;
        }
        pre {
            background: #0a0a0a;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            border: 1px solid #333333;
            margin: 20px 0;
        }
        pre code {
            background: none;
            padding: 0;
            color: #ffffff;
            border: none;
        }
        blockquote {
            border-left: 4px solid #3b82f6;
            margin: 0;
            padding-left: 20px;
            color: #d9d9d9;
            background: #1a1a1a;
            padding: 15px 20px;
            border-radius: 0 8px 8px 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            border: 1px solid #333333;
        }
        th, td {
            border: 1px solid #333333;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #1a1a1a;
            font-weight: bold;
            color: #ffffff;
        }
        td {
            color: #d9d9d9;
        }
        ul, ol {
            color: #d9d9d9;
        }
        li {
            margin-bottom: 8px;
        }
        a {
            color: #3b82f6;
            text-decoration: none;
        }
        a:hover {
            color: #60a5fa;
            text-decoration: underline;
        }
        /* Syntax Highlighting Overrides */
        pre[class*="language-"] {
            background: #0a0a0a !important;
            border: 1px solid #333333 !important;
            border-radius: 8px !important;
            padding: 20px !important;
            margin: 20px 0 !important;
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace !important;
            font-size: 13px !important;
            line-height: 1.5 !important;
        }
        .token.comment { color: #6a9955 !important; }
        .token.keyword { color: #569cd6 !important; }
        .token.string { color: #ce9178 !important; }
        .token.number { color: #b5cea8 !important; }
        .token.function { color: #dcdcaa !important; }
        .token.class-name { color: #4ec9b0 !important; }
        .token.operator { color: #d4d4d4 !important; }
        .token.punctuation { color: #d4d4d4 !important; }
        .token.variable { color: #9cdcfe !important; }
        .token.constant { color: #4fc1ff !important; }
    </style>
</head>
<body>
    <div class="container">
        <div class="back-link">
            <a href="/">&larr; Back to Documentation</a>
        </div>
        <h1>QuantDesk User Monitoring Guide</h1>
<h2>Overview</h2>
<p>QuantDesk provides comprehensive monitoring tools to track user accounts, deposits, positions, and trading activity. This guide covers how to monitor users for support, risk management, and compliance purposes.</p>
<hr />
<h2>ğŸ“Š What Data Can You Monitor?</h2>
<h3>User Account Data (18 Fields)</h3>
<div class="codehilite"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">UserAccount</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Identity</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">authority</span>: <span class="nc">Pubkey</span><span class="p">,</span><span class="w">              </span><span class="c1">// User&#39;s wallet address</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">account_index</span>: <span class="kt">u16</span><span class="p">,</span><span class="w">             </span><span class="c1">// Sub-account number (0-65535)</span>

<span class="w">    </span><span class="c1">// Money &amp; Collateral</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">total_collateral</span>: <span class="kt">u64</span><span class="p">,</span><span class="w">          </span><span class="c1">// Total USDC deposited</span>

<span class="w">    </span><span class="c1">// Trading Activity  </span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">total_positions</span>: <span class="kt">u16</span><span class="p">,</span><span class="w">           </span><span class="c1">// Number of open positions</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">total_orders</span>: <span class="kt">u16</span><span class="p">,</span><span class="w">              </span><span class="c1">// Number of active orders</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">max_positions</span>: <span class="kt">u16</span><span class="p">,</span><span class="w">             </span><span class="c1">// Position limit (default: 50)</span>

<span class="w">    </span><span class="c1">// Margin &amp; Risk</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">initial_margin_requirement</span>: <span class="kt">u64</span><span class="p">,</span><span class="w">      </span><span class="c1">// Initial margin needed</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">maintenance_margin_requirement</span>: <span class="kt">u64</span><span class="p">,</span><span class="w">  </span><span class="c1">// Maintenance margin</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">available_margin</span>: <span class="kt">u64</span><span class="p">,</span><span class="w">                </span><span class="c1">// Available for new trades</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">account_health</span>: <span class="kt">u16</span><span class="p">,</span><span class="w">                  </span><span class="c1">// Health score (0-10000 = 0-100%)</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">liquidation_price</span>: <span class="kt">u64</span><span class="p">,</span><span class="w">               </span><span class="c1">// Liquidation threshold</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">liquidation_threshold</span>: <span class="kt">u16</span><span class="p">,</span><span class="w">           </span><span class="c1">// Basis points (e.g., 2000 = 20%)</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">max_leverage</span>: <span class="kt">u16</span><span class="p">,</span><span class="w">                    </span><span class="c1">// Max leverage (e.g., 1000 = 10x)</span>

<span class="w">    </span><span class="c1">// Fees &amp; Funding</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">total_funding_paid</span>: <span class="kt">i64</span><span class="p">,</span><span class="w">        </span><span class="c1">// Funding fees paid (can be negative)</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">total_funding_received</span>: <span class="kt">i64</span><span class="p">,</span><span class="w">    </span><span class="c1">// Funding fees earned</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">total_fees_paid</span>: <span class="kt">u64</span><span class="p">,</span><span class="w">           </span><span class="c1">// Trading fees paid</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">total_rebates_earned</span>: <span class="kt">u64</span><span class="p">,</span><span class="w">      </span><span class="c1">// Maker rebates earned</span>

<span class="w">    </span><span class="c1">// Activity Timestamps</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">created_at</span>: <span class="kt">i64</span><span class="p">,</span><span class="w">                </span><span class="c1">// Account creation (Unix timestamp)</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">last_activity</span>: <span class="kt">i64</span><span class="p">,</span><span class="w">             </span><span class="c1">// Last action timestamp</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">is_active</span>: <span class="kt">bool</span><span class="p">,</span><span class="w">                </span><span class="c1">// Account status</span>
<span class="p">}</span>
</code></pre></div>

<h3>Additional Data You Can Track</h3>
<ul>
<li><strong>Wallet Balance</strong>: Native SOL balance</li>
<li><strong>Account Rent</strong>: SOL locked for account storage</li>
<li><strong>Position Details</strong>: Per-market positions (size, side, PnL, entry price)</li>
<li><strong>Collateral Accounts</strong>: SPL token holdings</li>
<li><strong>Transaction History</strong>: On-chain activity</li>
</ul>
<hr />
<h2>ğŸ› ï¸ Monitoring Tools</h2>
<h3>1. CLI Tool</h3>
<p><strong>Purpose</strong>: Quick user lookup and debugging</p>
<p><strong>Usage</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Monitor any user by wallet address</span>
pnpm<span class="w"> </span>monitor:user<span class="w"> </span>&lt;WALLET_ADDRESS&gt;

<span class="c1"># Examples:</span>
pnpm<span class="w"> </span>monitor:user<span class="w"> </span>6g2rsczYGk6oorSfbt2zGWyU8YUToU8yCmWFYdY1QM3N
pnpm<span class="w"> </span>monitor:user<span class="w"> </span>ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="err">ğŸ‘¤</span><span class="w"> </span><span class="nx">QuantDesk</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="nx">Account</span><span class="w"> </span><span class="nx">Monitor</span>

<span class="nx">Network</span><span class="p">:</span><span class="w"> </span><span class="nx">https</span><span class="p">:</span><span class="c1">//api.devnet.solana.com</span>
<span class="nx">User</span><span class="w"> </span><span class="nx">Wallet</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="nx">g2rsczYGk6oorSfbt2zGWyU8YUToU8yCmWFYdY1QM3N</span>

<span class="err">ğŸ’°</span><span class="w"> </span><span class="nx">WALLET</span><span class="w"> </span><span class="nx">BALANCE</span>
<span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="nx">SOL</span><span class="w"> </span><span class="nx">Balance</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">2.4</span><span class="mi">53891</span><span class="w"> </span><span class="nx">SOL</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="err">$</span><span class="m m-Double">245.3</span><span class="mi">9</span><span class="w"> </span><span class="nx">USD</span><span class="w"> </span><span class="err">@</span><span class="w"> </span><span class="err">$</span><span class="mi">100</span><span class="o">/</span><span class="nx">SOL</span><span class="p">)</span>

<span class="err">ğŸ“Š</span><span class="w"> </span><span class="nx">USER</span><span class="w"> </span><span class="nx">ACCOUNT</span><span class="w"> </span><span class="p">(</span><span class="nx">Index</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="nx">User</span><span class="w"> </span><span class="nx">Account</span><span class="w"> </span><span class="nx">PDA</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="nx">xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRuJosgAsU</span>
<span class="err">âœ…</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="nx">account</span><span class="w"> </span><span class="nx">exists</span>

<span class="nx">Account</span><span class="w"> </span><span class="nx">Details</span><span class="p">:</span>
<span class="w">  </span><span class="nx">Authority</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="nx">g2rsczYGk6oorSfbt2zGWyU8YUToU8yCmWFYdY1QM3N</span>
<span class="w">  </span><span class="nx">Account</span><span class="w"> </span><span class="nx">Index</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="nx">Status</span><span class="p">:</span><span class="w"> </span><span class="nx">Active</span>

<span class="err">ğŸ’µ</span><span class="w"> </span><span class="nx">COLLATERAL</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">DEPOSITS</span>
<span class="w">  </span><span class="nx">Total</span><span class="w"> </span><span class="nx">Collateral</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">1000.0</span><span class="mi">00000</span><span class="w"> </span><span class="nx">USDC</span>
<span class="w">  </span><span class="nx">USD</span><span class="w"> </span><span class="nx">Value</span><span class="p">:</span><span class="w"> </span><span class="err">$</span><span class="m m-Double">1000.0</span><span class="mi">0</span>
<span class="w">  </span><span class="nx">Account</span><span class="w"> </span><span class="nx">Rent</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">0.0</span><span class="mi">02039</span><span class="w"> </span><span class="nx">SOL</span>

<span class="err">ğŸ“ˆ</span><span class="w"> </span><span class="nx">TRADING</span><span class="w"> </span><span class="nx">ACTIVITY</span>
<span class="w">  </span><span class="nx">Open</span><span class="w"> </span><span class="nx">Positions</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">  </span><span class="nx">Active</span><span class="w"> </span><span class="nx">Orders</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="nx">Max</span><span class="w"> </span><span class="nx">Positions</span><span class="w"> </span><span class="nx">Allowed</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="p">(</span><span class="k">default</span><span class="p">)</span>

<span class="err">ğŸ¯</span><span class="w"> </span><span class="nx">POSITIONS</span>
<span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="err">âœ…</span><span class="w"> </span><span class="nx">SOL</span><span class="o">/</span><span class="nx">USD</span><span class="p">:</span>
<span class="w">   </span><span class="nx">PDA</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="nx">xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRuJosgAsV</span>
<span class="w">   </span><span class="nx">Status</span><span class="p">:</span><span class="w"> </span><span class="nx">Active</span>
<span class="w">   </span><span class="nx">BTC</span><span class="o">/</span><span class="nx">USD</span><span class="p">:</span><span class="w"> </span><span class="nx">No</span><span class="w"> </span><span class="nx">position</span>
<span class="w">   </span><span class="nx">ETH</span><span class="o">/</span><span class="nx">USD</span><span class="p">:</span><span class="w"> </span><span class="nx">No</span><span class="w"> </span><span class="nx">position</span>

<span class="err">âš ï¸</span><span class="w">  </span><span class="nx">RISK</span><span class="w"> </span><span class="nx">METRICS</span>
<span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="nx">Account</span><span class="w"> </span><span class="nx">Health</span><span class="p">:</span><span class="w"> </span><span class="mi">85</span><span class="o">%</span><span class="w"> </span><span class="p">(</span><span class="nx">decode</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">account</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span>
<span class="w">  </span><span class="nx">Liquidation</span><span class="w"> </span><span class="nx">Price</span><span class="p">:</span><span class="w"> </span><span class="err">$</span><span class="m m-Double">18.5</span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="nx">SOL</span><span class="w"> </span><span class="nx">position</span><span class="p">)</span>
<span class="w">  </span><span class="nx">Available</span><span class="w"> </span><span class="nx">Margin</span><span class="p">:</span><span class="w"> </span><span class="err">$</span><span class="m m-Double">450.0</span><span class="mi">0</span>
<span class="w">  </span><span class="nx">Margin</span><span class="w"> </span><span class="nx">Used</span><span class="p">:</span><span class="w"> </span><span class="err">$</span><span class="m m-Double">550.0</span><span class="mi">0</span>

<span class="err">ğŸ’¸</span><span class="w"> </span><span class="nx">FEES</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">FUNDING</span>
<span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="nx">Total</span><span class="w"> </span><span class="nx">Fees</span><span class="w"> </span><span class="nx">Paid</span><span class="p">:</span><span class="w"> </span><span class="err">$</span><span class="m m-Double">12.5</span><span class="mi">0</span>
<span class="w">  </span><span class="nx">Total</span><span class="w"> </span><span class="nx">Rebates</span><span class="w"> </span><span class="nx">Earned</span><span class="p">:</span><span class="w"> </span><span class="err">$</span><span class="m m-Double">3.2</span><span class="mi">0</span>
<span class="w">  </span><span class="nx">Funding</span><span class="w"> </span><span class="nx">Paid</span><span class="p">:</span><span class="w"> </span><span class="o">-</span><span class="err">$</span><span class="m m-Double">2.1</span><span class="mi">0</span>
<span class="w">  </span><span class="nx">Funding</span><span class="w"> </span><span class="nx">Received</span><span class="p">:</span><span class="w"> </span><span class="err">$</span><span class="m m-Double">4.3</span><span class="mi">0</span>

<span class="err">â°</span><span class="w"> </span><span class="nx">ACTIVITY</span>
<span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="nx">Account</span><span class="w"> </span><span class="nx">Created</span><span class="p">:</span><span class="w"> </span><span class="mi">2025</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">15</span><span class="w"> </span><span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mi">10</span><span class="w"> </span><span class="nx">UTC</span>
<span class="w">  </span><span class="nx">Last</span><span class="w"> </span><span class="nx">Activity</span><span class="p">:</span><span class="w"> </span><span class="mi">2025</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">20</span><span class="w"> </span><span class="mi">09</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">42</span><span class="w"> </span><span class="nx">UTC</span>

<span class="err">ğŸ”—</span><span class="w"> </span><span class="nx">EXPLORER</span><span class="w"> </span><span class="nx">LINKS</span><span class="w"> </span><span class="p">(</span><span class="nx">Devnet</span><span class="p">)</span>
<span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="nx">Wallet</span><span class="p">:</span><span class="w"> </span><span class="nx">https</span><span class="p">:</span><span class="c1">//explorer.solana.com/address/6g2rsczYGk6oorSfbt2zGWyU8YUToU8yCmWFYdY1QM3N?cluster=devnet</span>
<span class="nx">User</span><span class="w"> </span><span class="nx">Account</span><span class="p">:</span><span class="w"> </span><span class="nx">https</span><span class="p">:</span><span class="c1">//explorer.solana.com/address/7xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRuJosgAsU?cluster=devnet</span>
</code></pre></div>

<hr />
<h3>2. Backend API</h3>
<p><strong>Purpose</strong>: Programmatic access for dashboards and integrations</p>
<p><strong>Endpoint</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="err">GET /api/protocol/user/:wallet</span>
</code></pre></div>

<p><strong>Usage</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Start backend</span>
<span class="nb">cd</span><span class="w"> </span>backend<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>pnpm<span class="w"> </span>run<span class="w"> </span>dev

<span class="c1"># Query user</span>
curl<span class="w"> </span>http://localhost:3002/api/protocol/user/6g2rsczYGk6oorSfbt2zGWyU8YUToU8yCmWFYdY1QM3N
</code></pre></div>

<p><strong>Response</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;success&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;exists&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;wallet&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;6g2rsczYGk6oorSfbt2zGWyU8YUToU8yCmWFYdY1QM3N&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;account&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;pda&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;7xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRuJosgAsU&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;authority&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;6g2rsczYGk6oorSfbt2zGWyU8YUToU8yCmWFYdY1QM3N&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;account_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;wallet_balance_sol&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">2.453891</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;account_rent_sol&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.002039</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;total_collateral_usdc&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1000.0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;total_positions&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;total_orders&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;data_size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">256</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;explorer_links&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;wallet&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://explorer.solana.com/address/6g2rsczYGk6oorSfbt2zGWyU8YUToU8yCmWFYdY1QM3N?cluster=devnet&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;user_account&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://explorer.solana.com/address/7xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRuJosgAsU?cluster=devnet&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;warning&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ADMIN ONLY - Add authentication before production&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Error Response</strong> (Account Not Found):</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;success&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;exists&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;wallet&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;User account not created yet&quot;</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h3>3. Solana Explorer</h3>
<p><strong>Purpose</strong>: Visual inspection of raw account data</p>
<p><strong>URL Format</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">https</span><span class="p">:</span><span class="c1">//explorer.solana.com/address/&lt;USER_ACCOUNT_PDA&gt;?cluster=devnet</span>
</code></pre></div>

<p><strong>What You Can See</strong>:
- Raw account data (hex)
- Account balance (SOL)
- Transaction history
- Program owner
- Rent exemption status</p>
<hr />
<h2>ğŸ¯ Common Use Cases</h2>
<h3>Support Ticket: "My deposit didn't show up"</h3>
<p><strong>Steps</strong>:
1. Get user's wallet address
2. Run CLI tool:
   <code>bash
   pnpm monitor:user &lt;WALLET&gt;</code>
3. Check:
   - âœ… Does user account exist?
   - âœ… Is <code>total_collateral</code> &gt; 0?
   - âœ… Check <code>last_activity</code> timestamp
4. If account doesn't exist:
   - User needs to create account first
   - Guide them to "Create Account" in UI
5. If collateral is 0:
   - Check transaction history on explorer
   - Look for failed deposit transactions
   - Verify they sent to correct vault</p>
<hr />
<h3>Risk Management: Identify At-Risk Users</h3>
<p><strong>Query via API</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Pseudocode for monitoring multiple users</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getAllActiveUsers</span><span class="p">();</span><span class="w"> </span><span class="c1">// From your database</span>

<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">users</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`/api/protocol/user/</span><span class="si">${</span><span class="nx">user</span><span class="p">.</span><span class="nx">wallet</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">total_positions</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Check account health via full Anchor fetch</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">userAccount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">program</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">userAccount</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">pda</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">userAccount</span><span class="p">.</span><span class="nx">accountHealth</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">5000</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// &lt; 50%</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`âš ï¸  User </span><span class="si">${</span><span class="nx">user</span><span class="p">.</span><span class="nx">wallet</span><span class="si">}</span><span class="sb"> at risk!`</span><span class="p">);</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`   Health: </span><span class="si">${</span><span class="nx">userAccount</span><span class="p">.</span><span class="nx">accountHealth</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100</span><span class="si">}</span><span class="sb">%`</span><span class="p">);</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`   Liquidation Price: $</span><span class="si">${</span><span class="nx">userAccount</span><span class="p">.</span><span class="nx">liquidationPrice</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1e6</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">      </span><span class="c1">// Send alert email/notification</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h3>Compliance: Track High-Value Users</h3>
<p><strong>Monitor Large Depositors</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check if user qualifies for VIP tier</span>
pnpm<span class="w"> </span>monitor:user<span class="w"> </span>&lt;WHALE_WALLET&gt;

<span class="c1"># Look for:</span>
<span class="c1"># - total_collateral &gt; $100,000</span>
<span class="c1"># - total_positions &gt; 5</span>
<span class="c1"># - account health &gt; 80%</span>
</code></pre></div>

<p><strong>Programmatic Check</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`/api/protocol/user/</span><span class="si">${</span><span class="nx">wallet</span><span class="si">}</span><span class="sb">`</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">total_collateral_usdc</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">100000</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Upgrade to VIP tier</span>
<span class="w">  </span><span class="c1">// Assign dedicated account manager</span>
<span class="w">  </span><span class="c1">// Enable higher leverage</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h3>Fee Analysis: Calculate User Profitability</h3>
<p><strong>CLI Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>ğŸ’¸ FEES &amp; FUNDING
  Total Fees Paid: $1,250.00
  Total Rebates Earned: $320.00
  Funding Paid: -$45.00
  Funding Received: $78.00

  Net Fee Cost: $897.00
  Net Funding: $33.00
</code></pre></div>

<p><strong>Calculate Protocol Revenue from User</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">userData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`/api/protocol/user/</span><span class="si">${</span><span class="nx">wallet</span><span class="si">}</span><span class="sb">`</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">program</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">userAccount</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">userData</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">pda</span><span class="p">);</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">netFees</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">account</span><span class="p">.</span><span class="nx">totalFeesPaid</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">account</span><span class="p">.</span><span class="nx">totalRebatesEarned</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">protocolRevenue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">netFees</span><span class="p">;</span><span class="w"> </span><span class="c1">// In USDC (e6 precision)</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Revenue from </span><span class="si">${</span><span class="nx">wallet</span><span class="si">}</span><span class="sb">: $</span><span class="si">${</span><span class="nx">protocolRevenue</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1e6</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</code></pre></div>

<hr />
<h2>ğŸ”’ Security &amp; Privacy</h2>
<h3>Devnet (Current State)</h3>
<p><strong>Open Access</strong> âœ… (for testing):
- CLI tool: Anyone can run
- API endpoint: No authentication
- Explorer: Public blockchain data</p>
<p><strong>Safe because</strong>:
- Fake money (devnet SOL/tokens)
- Test accounts only
- Educational purpose</p>
<hr />
<h3>Production (Required Changes)</h3>
<p><strong>1. Add Admin Authentication</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// backend/src/routes/protocol-stats.ts</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">requireAdmin</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../middleware/adminAuth&#39;</span><span class="p">;</span>

<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/user/:wallet&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">requireAdmin</span><span class="p">,</span><span class="w">  </span><span class="c1">// â† Add this</span>
<span class="w">  </span><span class="nx">asyncHandler</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Only authenticated admins can access</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">);</span>
</code></pre></div>

<p><strong>2. Rate Limiting</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nx">rateLimit</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;express-rate-limit&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">userMonitorLimiter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rateLimit</span><span class="p">({</span>
<span class="w">  </span><span class="nx">windowMs</span><span class="o">:</span><span class="w"> </span><span class="kt">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">,</span><span class="w"> </span><span class="c1">// 1 minute</span>
<span class="w">  </span><span class="nx">max</span><span class="o">:</span><span class="w"> </span><span class="kt">10</span><span class="p">,</span><span class="w"> </span><span class="c1">// Max 10 requests per minute</span>
<span class="w">  </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Too many requests, please try again later&#39;</span>
<span class="p">});</span>

<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/user/:wallet&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">userMonitorLimiter</span><span class="p">,</span><span class="w"> </span><span class="nx">requireAdmin</span><span class="p">,</span><span class="w"> </span><span class="p">...);</span>
</code></pre></div>

<p><strong>3. Audit Logging</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/user/:wallet&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">requireAdmin</span><span class="p">,</span><span class="w"> </span><span class="nx">asyncHandler</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Log who accessed what</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">auditLog</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">    </span><span class="nx">admin_id</span><span class="o">:</span><span class="w"> </span><span class="kt">req.user.id</span><span class="p">,</span>
<span class="w">    </span><span class="nx">action</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;VIEW_USER_ACCOUNT&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">target_wallet</span><span class="o">:</span><span class="w"> </span><span class="kt">req.params.wallet</span><span class="p">,</span>
<span class="w">    </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(),</span>
<span class="w">    </span><span class="nx">ip_address</span><span class="o">:</span><span class="w"> </span><span class="kt">req.ip</span>
<span class="w">  </span><span class="p">});</span>

<span class="w">  </span><span class="c1">// ... rest of handler</span>
<span class="p">}));</span>
</code></pre></div>

<p><strong>4. Data Redaction</strong> (for non-admins):</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Show limited data to customer support</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">role</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;support&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
<span class="w">    </span><span class="nx">wallet</span><span class="o">:</span><span class="w"> </span><span class="kt">data.wallet</span><span class="p">,</span>
<span class="w">    </span><span class="nx">total_positions</span><span class="o">:</span><span class="w"> </span><span class="kt">data.account.total_positions</span><span class="p">,</span>
<span class="w">    </span><span class="nx">account_health</span><span class="o">:</span><span class="w"> </span><span class="kt">data.account.account_health</span><span class="p">,</span>
<span class="w">    </span><span class="c1">// Hide: fees, exact collateral, PnL</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">}</span>

<span class="c1">// Full data only for senior admins</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">role</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;admin&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span><span class="w"> </span><span class="c1">// All fields</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2>ğŸ“Š Best Practices</h2>
<h3>DO âœ…</h3>
<ul>
<li><strong>Monitor proactively</strong>: Set up alerts for low account health</li>
<li><strong>Track user activity</strong>: Identify inactive accounts</li>
<li><strong>Audit access</strong>: Log who views user data</li>
<li><strong>Respect privacy</strong>: Only access when necessary (support tickets, compliance)</li>
<li><strong>Automate risk checks</strong>: Regular health score scans</li>
<li><strong>Use API for dashboards</strong>: Build admin UI with real-time data</li>
<li><strong>Test on devnet</strong>: Practice workflows before mainnet</li>
</ul>
<h3>DON'T âŒ</h3>
<ul>
<li><strong>Expose API publicly</strong>: Always require authentication</li>
<li><strong>Share user data</strong>: GDPR/privacy violations</li>
<li><strong>Access without reason</strong>: Document why you viewed an account</li>
<li><strong>Ignore health alerts</strong>: Low health = liquidation risk</li>
<li><strong>Hardcode wallets</strong>: Use database or config files</li>
<li><strong>Skip audit logs</strong>: Legal requirement for financial services</li>
</ul>
<hr />
<h2>ğŸš€ Integration Examples</h2>
<h3>Admin Dashboard Widget</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// React component for admin dashboard</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useEffect</span><span class="p">,</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">UserAccountWidget</span><span class="p">({</span><span class="w"> </span><span class="nx">wallet</span><span class="w"> </span><span class="p">}</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">wallet</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">userData</span><span class="p">,</span><span class="w"> </span><span class="nx">setUserData</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`/api/protocol/user/</span><span class="si">${</span><span class="nx">wallet</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s1">&#39;Authorization&#39;</span><span class="o">:</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">adminToken</span><span class="si">}</span><span class="sb">`</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">      </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setUserData</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">wallet</span><span class="p">]);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">userData</span><span class="o">?</span><span class="p">.</span><span class="nx">exists</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="nx">User</span><span class="w"> </span><span class="nx">account</span><span class="w"> </span><span class="nx">not</span><span class="w"> </span><span class="nx">created</span><span class="o">&lt;</span><span class="err">/div&gt;;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="s2">&quot;user-account-card&quot;</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">h3</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">wallet</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">8</span><span class="p">)}...{</span><span class="nx">wallet</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mf">8</span><span class="p">)}</span><span class="o">&lt;</span><span class="err">/h3&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">label</span><span class="o">&gt;</span><span class="nx">Collateral</span><span class="o">:&lt;</span><span class="err">/label&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">span</span><span class="o">&gt;</span><span class="nx">$</span><span class="p">{</span><span class="nx">userData</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">total_collateral_usdc</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mf">2</span><span class="p">)}</span><span class="o">&lt;</span><span class="err">/span&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">label</span><span class="o">&gt;</span><span class="nx">Positions</span><span class="o">:&lt;</span><span class="err">/label&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">span</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">userData</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">total_positions</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/span&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">label</span><span class="o">&gt;</span><span class="nx">Health</span><span class="o">:&lt;</span><span class="err">/label&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">span</span><span class="w"> </span><span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">getHealthColor</span><span class="p">(</span><span class="nx">userData</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">account_health</span><span class="p">)}</span><span class="o">&gt;</span>
<span class="w">          </span><span class="p">{</span><span class="nx">userData</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">account_health</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100</span><span class="p">}</span><span class="o">%</span>
<span class="w">        </span><span class="o">&lt;</span><span class="err">/span&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nx">a</span><span class="w"> </span><span class="nx">href</span><span class="o">=</span><span class="p">{</span><span class="nx">userData</span><span class="p">.</span><span class="nx">explorer_links</span><span class="p">.</span><span class="nx">user_account</span><span class="p">}</span><span class="w"> </span><span class="nx">target</span><span class="o">=</span><span class="s2">&quot;_blank&quot;</span><span class="o">&gt;</span>
<span class="w">        </span><span class="nx">View</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">Explorer</span>
<span class="w">      </span><span class="o">&lt;</span><span class="err">/a&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3>Automated Risk Alert</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// Cron job to check user health</span>
<span class="k">import</span><span class="w"> </span><span class="nx">cron</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;node-cron&#39;</span><span class="p">;</span>

<span class="c1">// Run every 5 minutes</span>
<span class="nx">cron</span><span class="p">.</span><span class="nx">schedule</span><span class="p">(</span><span class="s1">&#39;*/5 * * * *&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">activeUsers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">getUsersWithPositions</span><span class="p">();</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">activeUsers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`/api/protocol/user/</span><span class="si">${</span><span class="nx">user</span><span class="p">.</span><span class="nx">wallet</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">data</span><span class="p">.</span><span class="nx">exists</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Fetch full account for health score</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">program</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">userAccount</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">pda</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">accountHealth</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">3000</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// &lt; 30%</span>
<span class="w">      </span><span class="c1">// Critical: Near liquidation</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">sendAlert</span><span class="p">({</span>
<span class="w">        </span><span class="nx">level</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;CRITICAL&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">wallet</span><span class="o">:</span><span class="w"> </span><span class="kt">user.wallet</span><span class="p">,</span>
<span class="w">        </span><span class="nx">health</span><span class="o">:</span><span class="w"> </span><span class="kt">account.accountHealth</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100</span><span class="p">,</span>
<span class="w">        </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="sb">`User near liquidation at </span><span class="si">${</span><span class="nx">account</span><span class="p">.</span><span class="nx">accountHealth</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100</span><span class="si">}</span><span class="sb">% health`</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">accountHealth</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">5000</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// &lt; 50%</span>
<span class="w">      </span><span class="c1">// Warning: At risk</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">sendAlert</span><span class="p">({</span>
<span class="w">        </span><span class="nx">level</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;WARNING&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">wallet</span><span class="o">:</span><span class="w"> </span><span class="kt">user.wallet</span><span class="p">,</span>
<span class="w">        </span><span class="nx">health</span><span class="o">:</span><span class="w"> </span><span class="kt">account.accountHealth</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100</span><span class="p">,</span>
<span class="w">        </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="sb">`User health below 50%`</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>

<hr />
<h2>ğŸ“‹ Monitoring Checklist</h2>
<h3>Daily Tasks</h3>
<ul>
<li>[ ] Review low health accounts (&lt; 50%)</li>
<li>[ ] Check for stuck deposits/withdrawals</li>
<li>[ ] Monitor unusual activity (large deposits/withdrawals)</li>
<li>[ ] Verify oracle price updates are current</li>
</ul>
<h3>Weekly Tasks</h3>
<ul>
<li>[ ] Analyze fee revenue by user tier</li>
<li>[ ] Identify inactive accounts (no activity &gt; 7 days)</li>
<li>[ ] Review audit logs for unauthorized access</li>
<li>[ ] Update user tier classifications (VIP, whale, etc.)</li>
</ul>
<h3>Monthly Tasks</h3>
<ul>
<li>[ ] Compliance report: High-value users (&gt; $100k)</li>
<li>[ ] User retention analysis (active vs churned)</li>
<li>[ ] Fee optimization: Compare maker/taker ratios</li>
<li>[ ] System health: Account creation trends</li>
</ul>
<hr />
<h2>ğŸ”§ Troubleshooting</h2>
<h3>Issue: "User account not found"</h3>
<p><strong>Check</strong>:
1. Has user created account in UI?
2. Is wallet address correct?
3. Is account index correct? (default: 0)
4. Is program deployed to correct network?</p>
<p><strong>Solution</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Verify user can create account</span>
<span class="nb">cd</span><span class="w"> </span>frontend<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>pnpm<span class="w"> </span>run<span class="w"> </span>dev
<span class="c1"># Guide user through &quot;Create Account&quot; flow</span>
</code></pre></div>

<hr />
<h3>Issue: "Account data decode error"</h3>
<p><strong>Check</strong>:
1. Is IDL up to date?
2. Did program get redeployed?
3. Is account structure changed?</p>
<p><strong>Solution</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Re-fetch IDL</span>
<span class="nb">cd</span><span class="w"> </span>contracts/smart-contracts
anchor<span class="w"> </span>idl<span class="w"> </span>fetch<span class="w"> </span>GcpEy...Wu3a
cp<span class="w"> </span>.anchor/idl/quantdesk_perp_dex.json<span class="w"> </span>../../frontend/src/types/
</code></pre></div>

<hr />
<h3>Issue: "Collateral shows 0 but user deposited"</h3>
<p><strong>Check</strong>:
1. Transaction succeeded?
2. Correct vault address?
3. SPL token account created?</p>
<p><strong>Solution</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check transaction on explorer</span>
<span class="c1"># Look for:</span>
<span class="c1"># - Transfer instruction</span>
<span class="c1"># - Destination account</span>
<span class="c1"># - Amount transferred</span>

<span class="c1"># Verify vault PDA</span>
<span class="nb">cd</span><span class="w"> </span>solana-sandbox
pnpm<span class="w"> </span>run<span class="w"> </span>derive<span class="w"> </span>--<span class="w"> </span>--type<span class="w"> </span>vault<span class="w"> </span>--mint<span class="w"> </span>&lt;USDC_MINT&gt;
</code></pre></div>

<hr />
<h2>ğŸ“š Related Documentation</h2>
<ul>
<li><strong>Protocol Monitoring</strong>: <code>/docs/monitoring/PROTOCOL_MONITORING_GUIDE.md</code> (protocol fees, treasury)</li>
<li><strong>Deployment Guide</strong>: <code>/docs/deployment/devnet-deployment-guide.md</code></li>
<li><strong>Troubleshooting</strong>: <code>/docs/debugging/devnet-troubleshooting.md</code></li>
<li><strong>Smart Contract Docs</strong>: <code>/contracts/docs/USER_ACCOUNT_STRUCT_GUIDE.md</code></li>
</ul>
<hr />
<h2>ğŸ¤ Support</h2>
<p>For questions or issues:
- Check troubleshooting section above
- Review related documentation
- Ask Solana MCP expert (available via MCP tools)
- Check Solana Stack Exchange: https://solana.stackexchange.com</p>
<hr />
<p><strong>Last Updated</strong>: October 2025<br />
<strong>Status</strong>: Production Ready (add auth for mainnet)<br />
<strong>Version</strong>: 1.0.6</p>
    </div>
</body>
</html>