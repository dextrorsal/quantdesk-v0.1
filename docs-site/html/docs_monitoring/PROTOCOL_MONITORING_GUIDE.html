<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protocol Monitoring Guide - QuantDesk Documentation</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <style>
        body {
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace;
            line-height: 1.6;
            color: #ffffff;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #000000;
            font-size: 14px;
        }
        .container {
            background: #000000;
            padding: 30px;
            border-radius: 8px;
            border: 1px solid #333333;
        }
        .back-link {
            margin-bottom: 20px;
        }
        .back-link a {
            color: #3b82f6;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s ease;
        }
        .back-link a:hover {
            color: #60a5fa;
            text-decoration: underline;
        }
        h1, h2, h3, h4, h5, h6 {
            color: #ffffff;
            margin-top: 30px;
            margin-bottom: 15px;
            font-weight: 600;
        }
        h1 {
            border-bottom: 2px solid #333333;
            padding-bottom: 10px;
        }
        h2 {
            border-bottom: 1px solid #333333;
            padding-bottom: 8px;
        }
        code {
            background: #1a1a1a;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace;
            color: #ffffff;
            border: 1px solid #333333;
        }
        pre {
            background: #0a0a0a;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            border: 1px solid #333333;
            margin: 20px 0;
        }
        pre code {
            background: none;
            padding: 0;
            color: #ffffff;
            border: none;
        }
        blockquote {
            border-left: 4px solid #3b82f6;
            margin: 0;
            padding-left: 20px;
            color: #d9d9d9;
            background: #1a1a1a;
            padding: 15px 20px;
            border-radius: 0 8px 8px 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            border: 1px solid #333333;
        }
        th, td {
            border: 1px solid #333333;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #1a1a1a;
            font-weight: bold;
            color: #ffffff;
        }
        td {
            color: #d9d9d9;
        }
        ul, ol {
            color: #d9d9d9;
        }
        li {
            margin-bottom: 8px;
        }
        a {
            color: #3b82f6;
            text-decoration: none;
        }
        a:hover {
            color: #60a5fa;
            text-decoration: underline;
        }
        /* Syntax Highlighting Overrides */
        pre[class*="language-"] {
            background: #0a0a0a !important;
            border: 1px solid #333333 !important;
            border-radius: 8px !important;
            padding: 20px !important;
            margin: 20px 0 !important;
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace !important;
            font-size: 13px !important;
            line-height: 1.5 !important;
        }
        .token.comment { color: #6a9955 !important; }
        .token.keyword { color: #569cd6 !important; }
        .token.string { color: #ce9178 !important; }
        .token.number { color: #b5cea8 !important; }
        .token.function { color: #dcdcaa !important; }
        .token.class-name { color: #4ec9b0 !important; }
        .token.operator { color: #d4d4d4 !important; }
        .token.punctuation { color: #d4d4d4 !important; }
        .token.variable { color: #9cdcfe !important; }
        .token.constant { color: #4fc1ff !important; }
    </style>
</head>
<body>
    <div class="container">
        <div class="back-link">
            <a href="/">&larr; Back to Documentation</a>
        </div>
        <h1>QuantDesk Protocol Monitoring Guide</h1>
<h2>Overview</h2>
<p>This guide covers monitoring your QuantDesk protocol's financial health, including fees collected, insurance fund, treasury, and overall system metrics.</p>
<hr />
<h2>ğŸ’° What Can You Monitor?</h2>
<h3>1. Protocol Finances</h3>
<ul>
<li><strong>Fee Collector</strong>: Trading fees and funding fees</li>
<li><strong>Insurance Fund</strong>: Liquidation backstop</li>
<li><strong>Treasury/Vault</strong>: Protocol-owned collateral</li>
<li><strong>Program Account</strong>: Infrastructure SOL (rent)</li>
</ul>
<h3>2. Market Metrics</h3>
<ul>
<li><strong>Total Value Locked (TVL)</strong>: Sum of all user collateral</li>
<li><strong>24h Trading Volume</strong>: Transaction value</li>
<li><strong>Active Users</strong>: Users with open positions</li>
<li><strong>Market Utilization</strong>: Open interest by market</li>
</ul>
<h3>3. System Health</h3>
<ul>
<li><strong>Program Status</strong>: Deployed and executable</li>
<li><strong>Oracle Status</strong>: Price feeds current</li>
<li><strong>Account Creation</strong>: New users</li>
<li><strong>Transaction Success Rate</strong>: Failed vs successful</li>
</ul>
<hr />
<h2>ğŸ› ï¸ Monitoring Tools</h2>
<h3>1. CLI Monitor</h3>
<p><strong>Command</strong>:</p>
<div class="codehilite"><pre><span></span><code>pnpm<span class="w"> </span>monitor
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="err">ğŸ”</span><span class="w"> </span><span class="nx">QuantDesk</span><span class="w"> </span><span class="nx">Protocol</span><span class="w"> </span><span class="nx">Monitor</span>

<span class="nx">Network</span><span class="p">:</span><span class="w"> </span><span class="nx">https</span><span class="p">:</span><span class="c1">//api.devnet.solana.com</span>
<span class="nx">Program</span><span class="w"> </span><span class="nx">ID</span><span class="p">:</span><span class="w"> </span><span class="nx">GcpEyGMJg9AvEx8LgAyzyUNTPWFxovHxtmQ4vVWuWu3a</span>

<span class="err">ğŸ“Š</span><span class="w"> </span><span class="nx">PROGRAM</span><span class="w"> </span><span class="nx">ACCOUNT</span>
<span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="nx">Balance</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">6.8</span><span class="mi">324</span><span class="w"> </span><span class="nx">SOL</span>
<span class="nx">Value</span><span class="p">:</span><span class="w"> </span><span class="o">~</span><span class="err">$</span><span class="m m-Double">683.2</span><span class="mi">4</span><span class="w"> </span><span class="nx">USD</span><span class="w"> </span><span class="p">(</span><span class="err">@</span><span class="w"> </span><span class="err">$</span><span class="mi">100</span><span class="o">/</span><span class="nx">SOL</span><span class="p">)</span>
<span class="nx">Note</span><span class="p">:</span><span class="w"> </span><span class="nx">This</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">locked</span><span class="w"> </span><span class="nx">rent</span><span class="p">,</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="nx">revenue</span>

<span class="err">ğŸ’°</span><span class="w"> </span><span class="nx">FEE</span><span class="w"> </span><span class="nx">COLLECTOR</span>
<span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="nx">PDA</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="nx">xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRuJosgAsU</span>
<span class="err">âœ…</span><span class="w"> </span><span class="nx">Fee</span><span class="w"> </span><span class="nx">collector</span><span class="w"> </span><span class="nx">initialized</span>
<span class="nx">SOL</span><span class="w"> </span><span class="nx">Balance</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">0.0</span><span class="mi">05432</span><span class="w"> </span><span class="nx">SOL</span>
<span class="nx">Trading</span><span class="w"> </span><span class="nx">Fees</span><span class="w"> </span><span class="nx">Collected</span><span class="p">:</span><span class="w"> </span><span class="err">$</span><span class="mi">1</span><span class="p">,</span><span class="m m-Double">234.5</span><span class="mi">6</span>
<span class="nx">Funding</span><span class="w"> </span><span class="nx">Fees</span><span class="w"> </span><span class="nx">Collected</span><span class="p">:</span><span class="w"> </span><span class="err">$</span><span class="m m-Double">567.8</span><span class="mi">9</span>
<span class="nx">Total</span><span class="w"> </span><span class="nx">Revenue</span><span class="p">:</span><span class="w"> </span><span class="err">$</span><span class="mi">1</span><span class="p">,</span><span class="m m-Double">802.4</span><span class="mi">5</span>

<span class="err">ğŸ›¡ï¸</span><span class="w">  </span><span class="nx">INSURANCE</span><span class="w"> </span><span class="nx">FUND</span>
<span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="nx">PDA</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="nx">xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRuJosgAsV</span>
<span class="err">âœ…</span><span class="w"> </span><span class="nx">Insurance</span><span class="w"> </span><span class="nx">fund</span><span class="w"> </span><span class="nx">initialized</span>
<span class="nx">SOL</span><span class="w"> </span><span class="nx">Balance</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">0.1</span><span class="mi">25000</span><span class="w"> </span><span class="nx">SOL</span>
<span class="nx">Total</span><span class="w"> </span><span class="nx">Deposits</span><span class="p">:</span><span class="w"> </span><span class="err">$</span><span class="mi">10</span><span class="p">,</span><span class="m m-Double">000.0</span><span class="mi">0</span>
<span class="nx">Total</span><span class="w"> </span><span class="nx">Withdrawals</span><span class="p">:</span><span class="w"> </span><span class="err">$</span><span class="mi">2</span><span class="p">,</span><span class="m m-Double">500.0</span><span class="mi">0</span>
<span class="nx">Available</span><span class="w"> </span><span class="nx">Balance</span><span class="p">:</span><span class="w"> </span><span class="err">$</span><span class="mi">7</span><span class="p">,</span><span class="m m-Double">500.0</span><span class="mi">0</span>
<span class="nx">Utilization</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="o">%</span>

<span class="err">ğŸ“ˆ</span><span class="w"> </span><span class="nx">MARKETS</span>
<span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="nx">SOL</span><span class="o">/</span><span class="nx">USD</span><span class="p">:</span>
<span class="w">  </span><span class="nx">PDA</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="nx">xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRuJosgAsW</span>
<span class="w">  </span><span class="err">âœ…</span><span class="w"> </span><span class="nx">Initialized</span>
<span class="w">  </span><span class="nx">Balance</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">0.0</span><span class="mi">01234</span><span class="w"> </span><span class="nx">SOL</span>

<span class="nx">BTC</span><span class="o">/</span><span class="nx">USD</span><span class="p">:</span>
<span class="w">  </span><span class="nx">PDA</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="nx">xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRuJosgAsX</span>
<span class="w">  </span><span class="err">âœ…</span><span class="w"> </span><span class="nx">Initialized</span>
<span class="w">  </span><span class="nx">Balance</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">0.0</span><span class="mi">01234</span><span class="w"> </span><span class="nx">SOL</span>

<span class="nx">ETH</span><span class="o">/</span><span class="nx">USD</span><span class="p">:</span>
<span class="w">  </span><span class="nx">PDA</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="nx">xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRuJosgAsY</span>
<span class="w">  </span><span class="err">âœ…</span><span class="w"> </span><span class="nx">Initialized</span>
<span class="w">  </span><span class="nx">Balance</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">0.0</span><span class="mi">01234</span><span class="w"> </span><span class="nx">SOL</span>

<span class="err">ğŸ”—</span><span class="w"> </span><span class="nx">EXPLORER</span><span class="w"> </span><span class="nx">LINKS</span><span class="w"> </span><span class="p">(</span><span class="nx">Devnet</span><span class="p">)</span>
<span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="nx">Program</span><span class="p">:</span><span class="w"> </span><span class="nx">https</span><span class="p">:</span><span class="c1">//explorer.solana.com/address/GcpEy...?cluster=devnet</span>
<span class="nx">Fee</span><span class="w"> </span><span class="nx">Collector</span><span class="p">:</span><span class="w"> </span><span class="nx">https</span><span class="p">:</span><span class="c1">//explorer.solana.com/address/7xKXt...?cluster=devnet</span>
<span class="nx">Insurance</span><span class="w"> </span><span class="nx">Fund</span><span class="p">:</span><span class="w"> </span><span class="nx">https</span><span class="p">:</span><span class="c1">//explorer.solana.com/address/8xKXt...?cluster=devnet</span>

<span class="err">ğŸ“‹</span><span class="w"> </span><span class="nx">SUMMARY</span>
<span class="err">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="nx">Total</span><span class="w"> </span><span class="nx">Protocol</span><span class="w"> </span><span class="nx">SOL</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">6.8</span><span class="mi">324</span><span class="w"> </span><span class="nx">SOL</span><span class="w"> </span><span class="p">(</span><span class="nx">infrastructure</span><span class="p">)</span>
<span class="nx">Total</span><span class="w"> </span><span class="nx">Revenue</span><span class="p">:</span><span class="w"> </span><span class="err">$</span><span class="mi">1</span><span class="p">,</span><span class="m m-Double">802.4</span><span class="mi">5</span>
<span class="nx">Insurance</span><span class="w"> </span><span class="nx">Fund</span><span class="w"> </span><span class="nx">Health</span><span class="p">:</span><span class="w"> </span><span class="mi">75</span><span class="o">%</span><span class="w"> </span><span class="nx">available</span>
<span class="nx">Status</span><span class="p">:</span><span class="w"> </span><span class="err">âœ…</span><span class="w"> </span><span class="nx">Deployed</span>

<span class="nx">â„¹</span><span class="err">ï¸</span><span class="w">  </span><span class="nx">Note</span><span class="p">:</span><span class="w"> </span><span class="nx">Fee</span><span class="w"> </span><span class="nx">collection</span><span class="w"> </span><span class="nx">requires</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="nx">trading</span><span class="w"> </span><span class="nx">activity</span>
</code></pre></div>

<hr />
<h3>2. Backend API</h3>
<p><strong>Endpoint</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="err">GET /api/protocol/stats</span>
</code></pre></div>

<p><strong>Usage</strong>:</p>
<div class="codehilite"><pre><span></span><code>curl<span class="w"> </span>http://localhost:3002/api/protocol/stats
</code></pre></div>

<p><strong>Response</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;success&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;network&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;devnet&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;program&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GcpEyGMJg9AvEx8LgAyzyUNTPWFxovHxtmQ4vVWuWu3a&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;balance_lamports&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6832400000</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;balance_sol&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">6.8324</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;deployed&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;fee_collector&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;address&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;7xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRuJosgAsU&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;initialized&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;balance_lamports&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5432000</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;balance_sol&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.005432</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;insurance_fund&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;address&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;8xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRuJosgAsV&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;initialized&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;balance_lamports&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">125000000</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;balance_sol&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.125</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;explorer_links&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;program&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://explorer.solana.com/address/GcpEy...?cluster=devnet&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;fee_collector&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://explorer.solana.com/address/7xKXt...?cluster=devnet&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;insurance_fund&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://explorer.solana.com/address/8xKXt...?cluster=devnet&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h3>3. Admin Treasury Endpoint</h3>
<p><strong>Endpoint</strong> (Admin Only):</p>
<div class="codehilite"><pre><span></span><code><span class="err">GET /api/protocol/treasury</span>
</code></pre></div>

<p><strong>Usage</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Requires admin authentication in production</span>
curl<span class="w"> </span>http://localhost:3002/api/protocol/treasury<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer &lt;ADMIN_TOKEN&gt;&quot;</span>
</code></pre></div>

<p><strong>Response</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;success&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;treasury&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total_value_locked_sol&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">125.5</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;fee_revenue_sol&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.8</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;insurance_fund_sol&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.125</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;breakdown&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;trading_fees&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1234.56</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;funding_fees&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">567.89</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;liquidation_fees&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">123.45</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;warning&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ADMIN ONLY - Do not expose publicly in production&quot;</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2>ğŸ“Š Understanding the Data</h2>
<h3>Program Account Balance</h3>
<p><strong>What it is</strong>: SOL locked for program rent<br />
<strong>Typical value</strong>: ~7 SOL on devnet<br />
<strong>Is it revenue?</strong>: âŒ No - this is infrastructure cost</p>
<div class="codehilite"><pre><span></span><code>Program Account: 6.8324 SOL
â†³ Rent exempt: Yes
â†³ Withdrawable: No (locked forever)
â†³ Purpose: Keep program deployed
</code></pre></div>

<hr />
<h3>Fee Collector</h3>
<p><strong>What it is</strong>: Protocol revenue from trading<br />
<strong>Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">FeeCollector</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">trading_fees_collected</span>: <span class="kt">u64</span><span class="p">,</span><span class="w">  </span><span class="c1">// Maker/taker fees</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">funding_fees_collected</span>: <span class="kt">u64</span><span class="p">,</span><span class="w">  </span><span class="c1">// Funding rate fees</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">maker_fee_rate</span>: <span class="kt">u16</span><span class="p">,</span><span class="w">          </span><span class="c1">// Basis points</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">taker_fee_rate</span>: <span class="kt">u16</span><span class="p">,</span><span class="w">          </span><span class="c1">// Basis points</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">funding_rate_cap</span>: <span class="kt">i64</span><span class="p">,</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">funding_rate_floor</span>: <span class="kt">i64</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Is it revenue?</strong>: âœ… Yes - this is your income</p>
<p><strong>How it grows</strong>:
1. User opens position â†’ Taker fee charged
2. User closes position â†’ Another fee
3. Funding payments â†’ Percentage kept by protocol
4. Liquidations â†’ Liquidation bonus</p>
<hr />
<h3>Insurance Fund</h3>
<p><strong>What it is</strong>: Safety net for underwater accounts<br />
<strong>Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">InsuranceFund</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">total_deposits</span>: <span class="kt">u64</span><span class="p">,</span><span class="w">      </span><span class="c1">// Initial + additions</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">total_withdrawals</span>: <span class="kt">u64</span><span class="p">,</span><span class="w">   </span><span class="c1">// Payouts</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">utilization_rate</span>: <span class="kt">u16</span><span class="p">,</span><span class="w">    </span><span class="c1">// How much is used</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">max_utilization</span>: <span class="kt">u16</span><span class="p">,</span><span class="w">     </span><span class="c1">// Max allowed (80%)</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">is_active</span>: <span class="kt">bool</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Health Metric</strong>:</p>
<div class="codehilite"><pre><span></span><code>Utilization = (total_withdrawals / total_deposits) * 100%

âœ… Good: &lt; 50%
âš ï¸  Warning: 50-80%
ğŸ”´ Critical: &gt; 80%
</code></pre></div>

<p><strong>When it's used</strong>:
- User gets liquidated but position underwater
- Liquidator gets partial fill
- Insurance fund covers the difference</p>
<hr />
<h2>ğŸ¯ Common Monitoring Tasks</h2>
<h3>Daily: Check Protocol Health</h3>
<div class="codehilite"><pre><span></span><code>pnpm<span class="w"> </span>monitor

<span class="c1"># Look for:</span>
<span class="c1"># - Fee collector growing âœ…</span>
<span class="c1"># - Insurance fund stable âœ…</span>
<span class="c1"># - No markets down âœ…</span>
<span class="c1"># - All PDAs initialized âœ…</span>
</code></pre></div>

<hr />
<h3>Weekly: Revenue Analysis</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// Fetch current stats</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;http://localhost:3002/api/protocol/stats&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>

<span class="c1">// Calculate revenue</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">feeCollector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">program</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">feeCollector</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span>
<span class="w">  </span><span class="nx">stats</span><span class="p">.</span><span class="nx">fee_collector</span><span class="p">.</span><span class="nx">address</span>
<span class="p">);</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">totalRevenue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">  </span><span class="nx">feeCollector</span><span class="p">.</span><span class="nx">tradingFeesCollected</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">  </span><span class="nx">feeCollector</span><span class="p">.</span><span class="nx">fundingFeesCollected</span><span class="p">;</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Weekly Revenue: $</span><span class="si">${</span><span class="nx">totalRevenue</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1e6</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="c1">// Compare to last week</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">growth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="nx">currentRevenue</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">lastWeekRevenue</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">lastWeekRevenue</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">100</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Growth: </span><span class="si">${</span><span class="nx">growth</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mf">2</span><span class="p">)</span><span class="si">}</span><span class="sb">%`</span><span class="p">);</span>
</code></pre></div>

<hr />
<h3>Monthly: Compliance Report</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// Generate monthly report</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">report</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">period</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;2025-10&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">metrics</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">total_revenue</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;$12,345.67&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">trading_fees</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;$8,901.23&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">funding_fees</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;$3,444.44&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">liquidation_fees</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;$0.00&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">insurance_fund_balance</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;$7,500.00&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">insurance_fund_utilization</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;25%&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">active_users</span><span class="o">:</span><span class="w"> </span><span class="mf">156</span><span class="p">,</span>
<span class="w">    </span><span class="nx">total_volume</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;$2,345,678.90&#39;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nx">health</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">program_deployed</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nx">oracles_functional</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nx">no_critical_issues</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Save to database</span>
<span class="k">await</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">monthlyReports</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">report</span><span class="p">);</span>
</code></pre></div>

<hr />
<h2>ğŸ”’ Security Best Practices</h2>
<h3>Public vs Private Data</h3>
<p><strong>Public (Safe to Show)</strong>:
- âœ… Total trading volume
- âœ… Number of markets
- âœ… TVL (Total Value Locked)
- âœ… Insurance fund health percentage</p>
<p><strong>Private (Admin Only)</strong>:
- âŒ Exact fee amounts
- âŒ Treasury wallet addresses
- âŒ Fee distribution logic
- âŒ Admin wallet addresses</p>
<hr />
<h3>Production Checklist</h3>
<p>Before going live:</p>
<ul>
<li>[ ] Add authentication to <code>/api/protocol/treasury</code></li>
<li>[ ] Add rate limiting to all endpoints</li>
<li>[ ] Set up audit logging</li>
<li>[ ] Configure multi-sig for fee withdrawals</li>
<li>[ ] Set up alerts for low insurance fund</li>
<li>[ ] Implement monitoring dashboard</li>
<li>[ ] Test emergency pause functionality</li>
</ul>
<hr />
<h2>ğŸ“ˆ Advanced Metrics</h2>
<h3>Total Value Locked (TVL)</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// Calculate TVL</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">calculateTVL</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">markets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">program</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">market</span><span class="p">.</span><span class="nx">all</span><span class="p">();</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">totalTVL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">market</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">markets</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Get all positions for this market</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">positions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">program</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nx">memcmp</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">offset</span><span class="o">:</span><span class="w"> </span><span class="mf">40</span><span class="p">,</span><span class="w"> </span><span class="nx">bytes</span><span class="o">:</span><span class="w"> </span><span class="nx">market</span><span class="p">.</span><span class="nx">publicKey</span><span class="p">.</span><span class="nx">toBase58</span><span class="p">()</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">]);</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">position</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">positions</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">totalTVL</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">position</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">margin</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">totalTVL</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1e6</span><span class="p">;</span><span class="w"> </span><span class="c1">// Convert to USD</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">tvl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">calculateTVL</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Total Value Locked: $</span><span class="si">${</span><span class="nx">tvl</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mf">2</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</code></pre></div>

<hr />
<h3>Fee APR (Annual Percentage Return)</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// Calculate fee APR</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">calculateFeeAPR</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">feeCollector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">program</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">feeCollector</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">feeCollectorPDA</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">tvl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">calculateTVL</span><span class="p">();</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">dailyFees</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">feeCollector</span><span class="p">.</span><span class="nx">tradingFeesCollected</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1e6</span><span class="p">;</span><span class="w"> </span><span class="c1">// Last 24h</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">annualizedFees</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dailyFees</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">365</span><span class="p">;</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">apr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">annualizedFees</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">tvl</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">100</span><span class="p">;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">apr</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">apr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">calculateFeeAPR</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Protocol Fee APR: </span><span class="si">${</span><span class="nx">apr</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mf">2</span><span class="p">)</span><span class="si">}</span><span class="sb">%`</span><span class="p">);</span>
</code></pre></div>

<hr />
<h2>ğŸš€ Integration Examples</h2>
<h3>Grafana Dashboard</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// Prometheus metrics endpoint</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/metrics&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getProtocolStats</span><span class="p">();</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">metrics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`</span>
<span class="sb"># HELP quantdesk_tvl Total Value Locked in USD</span>
<span class="sb"># TYPE quantdesk_tvl gauge</span>
<span class="sb">quantdesk_tvl </span><span class="si">${</span><span class="nx">stats</span><span class="p">.</span><span class="nx">tvl</span><span class="si">}</span>

<span class="sb"># HELP quantdesk_fees_collected Total fees collected in USD</span>
<span class="sb"># TYPE quantdesk_fees_collected counter</span>
<span class="sb">quantdesk_fees_collected </span><span class="si">${</span><span class="nx">stats</span><span class="p">.</span><span class="nx">fees</span><span class="si">}</span>

<span class="sb"># HELP quantdesk_insurance_fund Insurance fund balance in USD</span>
<span class="sb"># TYPE quantdesk_insurance_fund gauge</span>
<span class="sb">quantdesk_insurance_fund </span><span class="si">${</span><span class="nx">stats</span><span class="p">.</span><span class="nx">insurance</span><span class="si">}</span>
<span class="sb">  `</span><span class="p">;</span>

<span class="w">  </span><span class="nx">res</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;text/plain&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">metrics</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<hr />
<h3>Discord Alert Bot</h3>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">WebhookClient</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;discord.js&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">webhook</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">WebhookClient</span><span class="p">({</span><span class="w"> </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DISCORD_WEBHOOK</span><span class="w"> </span><span class="p">});</span>

<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">sendProtocolAlert</span><span class="p">(</span><span class="nx">level</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s1">&#39;info&#39;</span><span class="o">:</span><span class="w"> </span><span class="mh">0x0099ff</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;warning&#39;</span><span class="o">:</span><span class="w"> </span><span class="mh">0xffaa00</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;critical&#39;</span><span class="o">:</span><span class="w"> </span><span class="mh">0xff0000</span>
<span class="w">  </span><span class="p">}[</span><span class="nx">level</span><span class="p">];</span>

<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">webhook</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
<span class="w">    </span><span class="nx">embeds</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">      </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="sb">`QuantDesk Protocol Alert`</span><span class="p">,</span>
<span class="w">      </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="nx">message</span><span class="p">,</span>
<span class="w">      </span><span class="nx">color</span><span class="p">,</span>
<span class="w">      </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(),</span>
<span class="w">      </span><span class="nx">footer</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;QuantDesk Monitoring System&#39;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}]</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">}</span>

<span class="c1">// Example usage</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">insuranceFundUtilization</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">80</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">sendProtocolAlert</span><span class="p">(</span><span class="s1">&#39;critical&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="sb">`Insurance fund utilization at </span><span class="si">${</span><span class="nx">insuranceFundUtilization</span><span class="si">}</span><span class="sb">%!`</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2>ğŸ”§ Troubleshooting</h2>
<h3>Issue: "Fee collector not initialized"</h3>
<p><strong>Solution</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Initialize fee collector (one-time setup)</span>
<span class="nb">cd</span><span class="w"> </span>contracts/smart-contracts
anchor<span class="w"> </span>run<span class="w"> </span>init-fee-collector
</code></pre></div>

<hr />
<h3>Issue: "Insurance fund balance decreasing"</h3>
<p><strong>Check</strong>:
1. Recent liquidations?
2. Liquidations profitable?
3. Is utilization &gt; 80%?</p>
<p><strong>Solution</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Add funds to insurance fund</span>
<span class="k">await</span><span class="w"> </span><span class="nx">program</span><span class="p">.</span><span class="nx">methods</span>
<span class="w">  </span><span class="p">.</span><span class="nx">depositInsuranceFund</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">BN</span><span class="p">(</span><span class="mf">10000</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1e6</span><span class="p">))</span><span class="w"> </span><span class="c1">// $10,000</span>
<span class="w">  </span><span class="p">.</span><span class="nx">accounts</span><span class="p">({</span>
<span class="w">    </span><span class="nx">insuranceFund</span><span class="o">:</span><span class="w"> </span><span class="nx">insuranceFundPDA</span><span class="p">,</span>
<span class="w">    </span><span class="nx">authority</span><span class="o">:</span><span class="w"> </span><span class="nx">adminWallet</span><span class="p">.</span><span class="nx">publicKey</span><span class="p">,</span>
<span class="w">  </span><span class="p">})</span>
<span class="w">  </span><span class="p">.</span><span class="nx">rpc</span><span class="p">();</span>
</code></pre></div>

<hr />
<h2>ğŸ“š Related Documentation</h2>
<ul>
<li><strong>User Monitoring</strong>: <code>/docs/monitoring/USER_MONITORING_GUIDE.md</code></li>
<li><strong>Deployment</strong>: <code>/docs/deployment/devnet-deployment-guide.md</code></li>
<li><strong>Troubleshooting</strong>: <code>/docs/debugging/devnet-troubleshooting.md</code></li>
</ul>
<hr />
<p><strong>Last Updated</strong>: October 2025<br />
<strong>Status</strong>: Production Ready<br />
<strong>Version</strong>: 1.0.6</p>
    </div>
</body>
</html>