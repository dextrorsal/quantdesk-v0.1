<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indicators - QuantDesk Documentation</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <style>
        body {
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace;
            line-height: 1.6;
            color: #ffffff;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #000000;
            font-size: 14px;
        }
        .container {
            background: #000000;
            padding: 30px;
            border-radius: 8px;
            border: 1px solid #333333;
        }
        .back-link {
            margin-bottom: 20px;
        }
        .back-link a {
            color: #3b82f6;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s ease;
        }
        .back-link a:hover {
            color: #60a5fa;
            text-decoration: underline;
        }
        h1, h2, h3, h4, h5, h6 {
            color: #ffffff;
            margin-top: 30px;
            margin-bottom: 15px;
            font-weight: 600;
        }
        h1 {
            border-bottom: 2px solid #333333;
            padding-bottom: 10px;
        }
        h2 {
            border-bottom: 1px solid #333333;
            padding-bottom: 8px;
        }
        code {
            background: #1a1a1a;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace;
            color: #ffffff;
            border: 1px solid #333333;
        }
        pre {
            background: #0a0a0a;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            border: 1px solid #333333;
            margin: 20px 0;
        }
        pre code {
            background: none;
            padding: 0;
            color: #ffffff;
            border: none;
        }
        blockquote {
            border-left: 4px solid #3b82f6;
            margin: 0;
            padding-left: 20px;
            color: #d9d9d9;
            background: #1a1a1a;
            padding: 15px 20px;
            border-radius: 0 8px 8px 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            border: 1px solid #333333;
        }
        th, td {
            border: 1px solid #333333;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #1a1a1a;
            font-weight: bold;
            color: #ffffff;
        }
        td {
            color: #d9d9d9;
        }
        ul, ol {
            color: #d9d9d9;
        }
        li {
            margin-bottom: 8px;
        }
        a {
            color: #3b82f6;
            text-decoration: none;
        }
        a:hover {
            color: #60a5fa;
            text-decoration: underline;
        }
        /* Syntax Highlighting Overrides */
        pre[class*="language-"] {
            background: #0a0a0a !important;
            border: 1px solid #333333 !important;
            border-radius: 8px !important;
            padding: 20px !important;
            margin: 20px 0 !important;
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace !important;
            font-size: 13px !important;
            line-height: 1.5 !important;
        }
        .token.comment { color: #6a9955 !important; }
        .token.keyword { color: #569cd6 !important; }
        .token.string { color: #ce9178 !important; }
        .token.number { color: #b5cea8 !important; }
        .token.function { color: #dcdcaa !important; }
        .token.class-name { color: #4ec9b0 !important; }
        .token.operator { color: #d4d4d4 !important; }
        .token.punctuation { color: #d4d4d4 !important; }
        .token.variable { color: #9cdcfe !important; }
        .token.constant { color: #4fc1ff !important; }
    </style>
</head>
<body>
    <div class="container">
        <div class="back-link">
            <a href="/docs">&larr; Back to Documentation</a>
        </div>
        <h1>ðŸ“Š Custom Technical Indicators</h1>
<p><em>What is this doc?</em><br />
This guide details all custom technical indicators used in the project, including their math, code, and how they fit into the trading system. It's for developers, quants, and anyone curious about the feature engineering side.</p>
<p><a href="ML_MODEL.html">ML Model</a> | <a href="TECHNICAL_STRATEGY.html">Technical Strategy</a> | <a href="../README.html">Project README</a></p>
<h2>Table of Contents</h2>
<ol>
<li><a href="#pytorch-acceleration">PyTorch Acceleration</a></li>
<li><a href="#indicator-organization">Indicator Organization</a></li>
<li><a href="#lorentzian-classifier">Lorentzian Classifier</a></li>
<li><a href="#wave-trend-enhanced">Wave Trend Enhanced</a></li>
<li><a href="#custom-rsi-implementation">Custom RSI Implementation</a></li>
<li><a href="#custom-cci-implementation">Custom CCI Implementation</a></li>
<li><a href="#adx-implementation">ADX Implementation</a></li>
</ol>
<h2>PyTorch Acceleration</h2>
<p>All our technical indicators leverage PyTorch for GPU acceleration and automatic differentiation. This enables:</p>
<ul>
<li>Up to 100x faster calculation on GPUs</li>
<li>Automatic differentiation for gradient-based optimization</li>
<li>Batch processing for efficient backtesting</li>
<li>Seamless integration with deep learning models</li>
</ul>
<h3>Base Indicator Implementation</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">BaseTorchIndicator</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">dtype</span>

    <span class="k">def</span> <span class="nf">to_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert data to PyTorch tensor&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calculate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Main calculation method with GPU acceleration&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">amp</span><span class="o">.</span><span class="n">autocast</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">use_amp</span> <span class="k">else</span> <span class="n">nullcontext</span><span class="p">():</span>
            <span class="n">signals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_signals</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> 
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">signals</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</code></pre></div>

<h2>Indicator Organization</h2>
<p>Our indicators are organized into these key directories:</p>
<div class="codehilite"><pre><span></span><code>src/
â”œâ”€â”€ features/         # Core technical indicators (RSI, CCI, ADX, WaveTrend)
â”œâ”€â”€ indicators/       # Base indicator foundations
â””â”€â”€ models/strategy/  # Strategy indicators (Lorentzian, Logistic Regression, Chandelier)
</code></pre></div>

<h2>Lorentzian Classifier</h2>
<p>The core of our signal generation system, using a unique distance metric for pattern recognition.</p>
<h3>Mathematical Foundation</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">lorentzian_distance</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">))</span>
</code></pre></div>

<h3>Key Components</h3>
<ol>
<li>
<p><strong>Distance Calculation</strong>
   <code>python
   distances = np.array([
       lorentzian_distance(current_point, historical_point)
       for historical_point in historical_data
   ])</code></p>
</li>
<li>
<p><strong>Neighbor Selection</strong></p>
</li>
<li>Uses k=8 nearest neighbors</li>
<li>Chronological sampling (4 bar spacing)</li>
<li>
<p>Dynamic threshold adjustment</p>
</li>
<li>
<p><strong>Signal Generation</strong>
   <code>python
   signal_strength = np.mean(np.sort(distances)[:n_neighbors])
   signal = 1 if signal_strength &gt; upper_threshold else -1 if signal_strength &lt; lower_threshold else 0</code></p>
</li>
</ol>
<h3>Optimization Parameters</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Range</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>n_neighbors</td>
<td>8</td>
<td>4-12</td>
<td>Number of neighbors</td>
</tr>
<tr>
<td>bar_spacing</td>
<td>4</td>
<td>2-8</td>
<td>Chronological spacing</td>
</tr>
<tr>
<td>threshold</td>
<td>0.1</td>
<td>0.05-0.2</td>
<td>Signal threshold</td>
</tr>
</tbody>
</table>
<h2>Wave Trend Enhanced</h2>
<p>Custom implementation of the WaveTrend indicator with enhanced sensitivity.</p>
<h3>Calculation</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_wave_trend</span><span class="p">(</span><span class="n">close</span><span class="p">,</span> <span class="n">channel_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">avg_length</span><span class="o">=</span><span class="mi">11</span><span class="p">):</span>
    <span class="c1"># Step 1: Calculate ESA (Exponential Moving Average)</span>
    <span class="n">esa</span> <span class="o">=</span> <span class="n">ema</span><span class="p">(</span><span class="n">close</span><span class="p">,</span> <span class="n">channel_length</span><span class="p">)</span>

    <span class="c1"># Step 2: Calculate absolute distance</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">ema</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">close</span> <span class="o">-</span> <span class="n">esa</span><span class="p">),</span> <span class="n">channel_length</span><span class="p">)</span>

    <span class="c1"># Step 3: Calculate CI (Raw Wave Trend)</span>
    <span class="n">ci</span> <span class="o">=</span> <span class="p">(</span><span class="n">close</span> <span class="o">-</span> <span class="n">esa</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.015</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span>

    <span class="c1"># Step 4: Calculate Wave Trend Lines</span>
    <span class="n">wt1</span> <span class="o">=</span> <span class="n">ema</span><span class="p">(</span><span class="n">ci</span><span class="p">,</span> <span class="n">avg_length</span><span class="p">)</span>      <span class="c1"># Wave Trend Line 1</span>
    <span class="n">wt2</span> <span class="o">=</span> <span class="n">sma</span><span class="p">(</span><span class="n">wt1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>             <span class="c1"># Wave Trend Line 2</span>

    <span class="k">return</span> <span class="n">wt1</span><span class="p">,</span> <span class="n">wt2</span>
</code></pre></div>

<h3>Signal Zones</h3>
<ul>
<li><strong>Overbought</strong>: &gt; 60</li>
<li><strong>Oversold</strong>: &lt; -60</li>
<li><strong>Extreme Overbought</strong>: &gt; 80</li>
<li><strong>Extreme Oversold</strong>: &lt; -80</li>
</ul>
<h3>Cross Signals</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">wave_trend_cross</span><span class="p">(</span><span class="n">wt1</span><span class="p">,</span> <span class="n">wt2</span><span class="p">):</span>
    <span class="c1"># Bullish Cross</span>
    <span class="n">bullish</span> <span class="o">=</span> <span class="p">(</span><span class="n">wt1</span> <span class="o">&gt;</span> <span class="n">wt2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wt1</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">wt2</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

    <span class="c1"># Bearish Cross</span>
    <span class="n">bearish</span> <span class="o">=</span> <span class="p">(</span><span class="n">wt1</span> <span class="o">&lt;</span> <span class="n">wt2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wt1</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">wt2</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">bullish</span><span class="p">,</span> <span class="n">bearish</span>
</code></pre></div>

<h2>Custom RSI Implementation</h2>
<p>Enhanced RSI with GPU acceleration and advanced signal processing.</p>
<h3>Features</h3>
<ol>
<li>
<p><strong>PyTorch Implementation</strong>
   ```python
   class RSIIndicator(BaseTorchIndicator):
       def <strong>init</strong>(self, period=14, overbought=70.0, oversold=30.0, device=None, dtype=None):
           config = RSIConfig(
               period=period,
               overbought=overbought,
               oversold=oversold,
               device=device,
               dtype=dtype
           )
           super().<strong>init</strong>(config)</p>
<p>def forward(self, close):
       # Calculate price changes
       price_diff = torch.diff(close, dim=0)
       padding = torch.zeros(1, device=self.device, dtype=self.dtype)
       price_diff = torch.cat([padding, price_diff])</p>
<div class="codehilite"><pre><span></span><code><span class="w">   </span><span class="c1"># Separate gains and losses</span>
<span class="w">   </span><span class="n">gains</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">price_diff</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">price_diff</span><span class="p">,</span><span class="w"> </span><span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">price_diff</span><span class="p">))</span>
<span class="w">   </span><span class="n">losses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">price_diff</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">price_diff</span><span class="p">,</span><span class="w"> </span><span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">price_diff</span><span class="p">))</span>

<span class="w">   </span><span class="c1"># Calculate average gains and losses</span>
<span class="w">   </span><span class="n">avg_gains</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">torch_ema</span><span class="p">(</span><span class="n">gains</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
<span class="w">   </span><span class="n">avg_losses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">torch_ema</span><span class="p">(</span><span class="n">losses</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>

<span class="w">   </span><span class="c1"># Calculate relative strength and RSI</span>
<span class="w">   </span><span class="n">rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">avg_gains</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">avg_losses</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1e-10</span><span class="p">)</span>
<span class="w">   </span><span class="n">rsi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mf">100.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rs</span><span class="p">))</span>

<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="s1">&#39;rsi&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">rsi</span><span class="p">,</span>
<span class="w">       </span><span class="s1">&#39;buy_signals&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">rsi</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">oversold</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span>
<span class="w">       </span><span class="s1">&#39;sell_signals&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">rsi</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">overbought</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<span class="w">   </span><span class="p">}</span>
</code></pre></div>

<p>```</p>
</li>
<li>
<p><strong>Configuration</strong>
   <code>python
   @dataclass
   class RSIConfig(TorchIndicatorConfig):
       period: int = 14
       overbought: float = 70.0
       oversold: float = 30.0</code></p>
</li>
</ol>
<h3>Signal Generation</h3>
<ul>
<li><strong>Strong Buy</strong>: RSI &lt; 30 (oversold condition)</li>
<li><strong>Strong Sell</strong>: RSI &gt; 70 (overbought condition)</li>
<li><strong>Neutral</strong>: 30 â‰¤ RSI â‰¤ 70</li>
</ul>
<h3>Usage Example</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Initialize indicator</span>
<span class="n">rsi</span> <span class="o">=</span> <span class="n">RSIIndicator</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span><span class="p">)</span>

<span class="c1"># Calculate signals</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">rsi</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">price_data</span><span class="p">)</span>

<span class="c1"># Access results</span>
<span class="n">rsi_values</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;rsi&#39;</span><span class="p">]</span>
<span class="n">buy_signals</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;buy_signals&#39;</span><span class="p">]</span>
<span class="n">sell_signals</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;sell_signals&#39;</span><span class="p">]</span>
</code></pre></div>

<h2>Custom CCI Implementation</h2>
<p>Modified CCI with enhanced sensitivity and noise reduction.</p>
<h3>Calculation</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">enhanced_cci</span><span class="p">(</span><span class="n">high</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">close</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1"># Calculate Typical Price</span>
    <span class="n">tp</span> <span class="o">=</span> <span class="p">(</span><span class="n">high</span> <span class="o">+</span> <span class="n">low</span> <span class="o">+</span> <span class="n">close</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span>

    <span class="c1"># Calculate SMA of Typical Price</span>
    <span class="n">sma_tp</span> <span class="o">=</span> <span class="n">talib</span><span class="o">.</span><span class="n">SMA</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span> <span class="n">timeperiod</span><span class="o">=</span><span class="n">length</span><span class="p">)</span>

    <span class="c1"># Calculate Mean Deviation</span>
    <span class="n">mean_dev</span> <span class="o">=</span> <span class="n">mean_deviation</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span> <span class="n">sma_tp</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>

    <span class="c1"># Calculate Raw CCI</span>
    <span class="n">cci</span> <span class="o">=</span> <span class="p">(</span><span class="n">tp</span> <span class="o">-</span> <span class="n">sma_tp</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.015</span> <span class="o">*</span> <span class="n">mean_dev</span><span class="p">)</span>

    <span class="c1"># Apply smoothing</span>
    <span class="k">if</span> <span class="n">smooth</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cci</span> <span class="o">=</span> <span class="n">talib</span><span class="o">.</span><span class="n">EMA</span><span class="p">(</span><span class="n">cci</span><span class="p">,</span> <span class="n">timeperiod</span><span class="o">=</span><span class="n">smooth</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cci</span>
</code></pre></div>

<h3>Signal Thresholds</h3>
<table>
<thead>
<tr>
<th>Zone</th>
<th>Range</th>
<th>Signal Strength</th>
</tr>
</thead>
<tbody>
<tr>
<td>Extreme Overbought</td>
<td>&gt; 200</td>
<td>Strong Sell</td>
</tr>
<tr>
<td>Overbought</td>
<td>100 to 200</td>
<td>Weak Sell</td>
</tr>
<tr>
<td>Neutral</td>
<td>-100 to 100</td>
<td>No Signal</td>
</tr>
<tr>
<td>Oversold</td>
<td>-200 to -100</td>
<td>Weak Buy</td>
</tr>
<tr>
<td>Extreme Oversold</td>
<td>&lt; -200</td>
<td>Strong Buy</td>
</tr>
</tbody>
</table>
<h3>Divergence Detection</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">detect_cci_divergence</span><span class="p">(</span><span class="n">price</span><span class="p">,</span> <span class="n">cci</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>
    <span class="c1"># Price making higher highs</span>
    <span class="n">price_hh</span> <span class="o">=</span> <span class="n">price</span> <span class="o">&gt;</span> <span class="n">price</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

    <span class="c1"># CCI making lower highs</span>
    <span class="n">cci_lh</span> <span class="o">=</span> <span class="n">cci</span> <span class="o">&lt;</span> <span class="n">cci</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

    <span class="c1"># Bearish divergence</span>
    <span class="n">bearish_div</span> <span class="o">=</span> <span class="n">price_hh</span> <span class="o">&amp;</span> <span class="n">cci_lh</span>

    <span class="c1"># Similar for bullish divergence</span>
    <span class="k">return</span> <span class="n">bearish_div</span>
</code></pre></div>

<h2>Integration with ML Pipeline</h2>
<h3>Feature Engineering</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_all_features</span><span class="p">(</span><span class="n">ohlcv_data</span><span class="p">):</span>
    <span class="n">features</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Add Wave Trend</span>
    <span class="n">features</span><span class="p">[</span><span class="s1">&#39;wt1&#39;</span><span class="p">],</span> <span class="n">features</span><span class="p">[</span><span class="s1">&#39;wt2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculate_wave_trend</span><span class="p">(</span>
        <span class="n">ohlcv_data</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># Add RSI</span>
    <span class="n">features</span><span class="p">[</span><span class="s1">&#39;rsi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">smooth_rsi</span><span class="p">(</span>
        <span class="n">ohlcv_data</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># Add CCI</span>
    <span class="n">features</span><span class="p">[</span><span class="s1">&#39;cci&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">enhanced_cci</span><span class="p">(</span>
        <span class="n">ohlcv_data</span><span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">],</span>
        <span class="n">ohlcv_data</span><span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">],</span>
        <span class="n">ohlcv_data</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">features</span>
</code></pre></div>

<h3>Signal Combination</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">combine_indicator_signals</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
    <span class="n">signals</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;wave_trend&#39;</span><span class="p">:</span> <span class="n">get_wt_signal</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;wt1&#39;</span><span class="p">],</span> <span class="n">features</span><span class="p">[</span><span class="s1">&#39;wt2&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;rsi&#39;</span><span class="p">:</span> <span class="n">get_rsi_signal</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;rsi&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;cci&#39;</span><span class="p">:</span> <span class="n">get_cci_signal</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;cci&#39;</span><span class="p">])</span>
    <span class="p">}</span>

    <span class="c1"># Weight and combine signals</span>
    <span class="n">final_signal</span> <span class="o">=</span> <span class="n">weighted_signal_combination</span><span class="p">(</span><span class="n">signals</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">final_signal</span>
</code></pre></div>

<hr />
<p><em>This documentation provides detailed insights into our custom technical indicators and their implementation. Each indicator has been optimized for our specific trading strategy and market conditions.</em> </p>
<h2>See Also</h2>
<ul>
<li><a href="../README.html">Project README</a> â€” Project overview and structure</li>
<li><a href="ML_MODEL.html">ML Model Architecture</a> â€” How indicators are used in the model</li>
<li><a href="TECHNICAL_STRATEGY.html">Technical Strategy</a> â€” How indicators drive trading logic</li>
<li><a href="../src/features/">src/features/</a> â€” Core indicator code (<a href="../src/features/rsi.py">rsi.py</a>, <a href="../src/features/cci.py">cci.py</a>, <a href="../src/features/adx.py">adx.py</a>, <a href="../src/features/wave_trend.py">wave_trend.py</a>)</li>
<li><a href="../src/indicators/base_torch_indicator.py">src/indicators/base_torch_indicator.py</a> â€” PyTorch base class for indicators</li>
<li><a href="../src/models/strategy/">src/models/strategy/</a> â€” Strategy code using these indicators </li>
</ul>
    </div>
</body>
</html>