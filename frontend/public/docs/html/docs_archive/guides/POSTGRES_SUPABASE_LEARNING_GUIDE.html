<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Postgres Supabase Learning Guide - QuantDesk Documentation</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <style>
        body {
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace;
            line-height: 1.6;
            color: #ffffff;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #000000;
            font-size: 14px;
        }
        .container {
            background: #000000;
            padding: 30px;
            border-radius: 8px;
            border: 1px solid #333333;
        }
        .back-link {
            margin-bottom: 20px;
        }
        .back-link a {
            color: #3b82f6;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s ease;
        }
        .back-link a:hover {
            color: #60a5fa;
            text-decoration: underline;
        }
        h1, h2, h3, h4, h5, h6 {
            color: #ffffff;
            margin-top: 30px;
            margin-bottom: 15px;
            font-weight: 600;
        }
        h1 {
            border-bottom: 2px solid #333333;
            padding-bottom: 10px;
        }
        h2 {
            border-bottom: 1px solid #333333;
            padding-bottom: 8px;
        }
        code {
            background: #1a1a1a;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace;
            color: #ffffff;
            border: 1px solid #333333;
        }
        pre {
            background: #0a0a0a;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            border: 1px solid #333333;
            margin: 20px 0;
        }
        pre code {
            background: none;
            padding: 0;
            color: #ffffff;
            border: none;
        }
        blockquote {
            border-left: 4px solid #3b82f6;
            margin: 0;
            padding-left: 20px;
            color: #d9d9d9;
            background: #1a1a1a;
            padding: 15px 20px;
            border-radius: 0 8px 8px 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            border: 1px solid #333333;
        }
        th, td {
            border: 1px solid #333333;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #1a1a1a;
            font-weight: bold;
            color: #ffffff;
        }
        td {
            color: #d9d9d9;
        }
        ul, ol {
            color: #d9d9d9;
        }
        li {
            margin-bottom: 8px;
        }
        a {
            color: #3b82f6;
            text-decoration: none;
        }
        a:hover {
            color: #60a5fa;
            text-decoration: underline;
        }
        /* Syntax Highlighting Overrides */
        pre[class*="language-"] {
            background: #0a0a0a !important;
            border: 1px solid #333333 !important;
            border-radius: 8px !important;
            padding: 20px !important;
            margin: 20px 0 !important;
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace !important;
            font-size: 13px !important;
            line-height: 1.5 !important;
        }
        .token.comment { color: #6a9955 !important; }
        .token.keyword { color: #569cd6 !important; }
        .token.string { color: #ce9178 !important; }
        .token.number { color: #b5cea8 !important; }
        .token.function { color: #dcdcaa !important; }
        .token.class-name { color: #4ec9b0 !important; }
        .token.operator { color: #d4d4d4 !important; }
        .token.punctuation { color: #d4d4d4 !important; }
        .token.variable { color: #9cdcfe !important; }
        .token.constant { color: #4fc1ff !important; }
    </style>
</head>
<body>
    <div class="container">
        <div class="back-link">
            <a href="/docs">&larr; Back to Documentation</a>
        </div>
        <h1>🎓 PostgreSQL &amp; Supabase Complete Learning Guide</h1>
<h2>Table of Contents</h2>
<ol>
<li><a href="#postgresql-fundamentals">PostgreSQL Fundamentals</a></li>
<li><a href="#supabase-overview">Supabase Overview</a></li>
<li><a href="#current-project-setup-analysis">Current Project Setup Analysis</a></li>
<li><a href="#security-deep-dive">Security Deep Dive</a></li>
<li><a href="#deployment-levels">Deployment Levels</a></li>
<li><a href="#postgresql-vs-alternatives">PostgreSQL vs Alternatives</a></li>
<li><a href="#database-routines--maintenance">Database Routines &amp; Maintenance</a></li>
<li><a href="#hands-on-examples">Hands-On Examples</a></li>
<li><a href="#best-practices">Best Practices</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
</ol>
<hr />
<h2>📚 PostgreSQL Fundamentals</h2>
<h3>What is PostgreSQL?</h3>
<p><strong>PostgreSQL</strong> (often called "Postgres") is a powerful, open-source relational database management system. Think of it as a super-smart filing cabinet that can:</p>
<ul>
<li>Store massive amounts of structured data</li>
<li>Handle complex relationships between data</li>
<li>Perform lightning-fast searches</li>
<li>Ensure data integrity and consistency</li>
<li>Scale to handle millions of users</li>
</ul>
<h3>Key Concepts You Need to Know</h3>
<h4>1. Tables &amp; Rows</h4>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Your users table is like a spreadsheet</span>
<span class="n">users</span><span class="w"> </span><span class="k">table</span><span class="p">:</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">wallet_address</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="c1">----|----------------|----------|-------|------------|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="n">x123</span><span class="p">...</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">trader1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="p">...</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="n">x456</span><span class="p">...</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">trader2</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="p">...</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span><span class="w"> </span><span class="o">|</span>
</code></pre></div>

<h4>2. Relationships</h4>
<p>Your schema shows beautiful relationships:
- <code>users</code> → <code>positions</code> (one user can have many positions)
- <code>markets</code> → <code>positions</code> (one market can have many positions)
- <code>positions</code> → <code>trades</code> (one position can have many trades)</p>
<h4>3. Data Types</h4>
<p>PostgreSQL is strict about data types:
- <code>UUID</code> - Unique identifiers (like your user IDs)
- <code>DECIMAL(20,8)</code> - Precise numbers for crypto (20 digits total, 8 after decimal)
- <code>TIMESTAMP WITH TIME ZONE</code> - Dates with timezone info
- <code>JSONB</code> - Flexible JSON data (like your metadata fields)</p>
<h4>4. Indexes</h4>
<p>These are like book indexes - they make searches super fast:</p>
<div class="codehilite"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_users_wallet_address</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="n">wallet_address</span><span class="p">);</span>
<span class="c1">-- Now finding a user by wallet address is lightning fast!</span>
</code></pre></div>

<h4>5. Functions &amp; Triggers</h4>
<p>Your schema has smart automation:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">-- This function automatically updates the &quot;updated_at&quot; field</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TRIGGER</span><span class="w"> </span><span class="n">update_users_updated_at</span><span class="w"> </span><span class="k">BEFORE</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span>
<span class="w">    </span><span class="k">FOR</span><span class="w"> </span><span class="k">EACH</span><span class="w"> </span><span class="k">ROW</span><span class="w"> </span><span class="k">EXECUTE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">update_updated_at_column</span><span class="p">();</span>
</code></pre></div>

<hr />
<h2>🚀 Supabase Overview</h2>
<h3>Supabase = PostgreSQL + Superpowers</h3>
<p><strong>Supabase</strong> is PostgreSQL with a bunch of amazing features added on top:</p>
<h4>What Supabase Gives You:</h4>
<ol>
<li><strong>Managed PostgreSQL</strong> - No server management needed</li>
<li><strong>Real-time subscriptions</strong> - Your app gets live updates automatically</li>
<li><strong>Authentication</strong> - Built-in user management</li>
<li><strong>Row Level Security (RLS)</strong> - Automatic data protection</li>
<li><strong>Auto-generated APIs</strong> - REST and GraphQL APIs for free</li>
<li><strong>Dashboard</strong> - Visual database management</li>
<li><strong>Backups</strong> - Automatic daily backups</li>
</ol>
<h3>How Your Project Uses Supabase</h3>
<p>Looking at your schema, you're using Supabase's RLS (Row Level Security):</p>
<div class="codehilite"><pre><span></span><code><span class="c1">-- This policy ensures users only see their own data</span>
<span class="k">CREATE</span><span class="w"> </span><span class="n">POLICY</span><span class="w"> </span><span class="ss">&quot;Users can view own data&quot;</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span>
<span class="w">    </span><span class="k">FOR</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">auth</span><span class="p">.</span><span class="n">jwt</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;&gt;</span><span class="w"> </span><span class="s1">&#39;wallet_address&#39;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wallet_address</span><span class="p">);</span>
</code></pre></div>

<p>This is <strong>incredibly powerful</strong> - it means even if someone hacks your frontend, they can't see other users' data!</p>
<hr />
<h2>🔍 Current Project Setup Analysis</h2>
<h3>Your Database Architecture</h3>
<h4>Core Trading Tables:</h4>
<ul>
<li><code>users</code> - Wallet-based authentication (no passwords!)</li>
<li><code>markets</code> - Trading pairs like BTC-PERP, ETH-PERP</li>
<li><code>user_balances</code> - Collateral management</li>
<li><code>positions</code> - Active trading positions</li>
<li><code>orders</code> - Order management system</li>
<li><code>trades</code> - Trade execution history</li>
</ul>
<h4>Risk Management:</h4>
<ul>
<li><code>funding_rates</code> - Perpetual contract funding</li>
<li><code>liquidations</code> - Risk management events</li>
<li><code>oracle_prices</code> - Price feeds from Pyth</li>
</ul>
<h4>Advanced Features:</h4>
<ul>
<li><code>auctions</code> - JIT (Just-In-Time) liquidity system</li>
<li><code>system_events</code> - Monitoring and debugging</li>
<li>TimescaleDB hypertables for time-series data</li>
</ul>
<h3>What Makes This Professional-Grade</h3>
<ol>
<li><strong>TimescaleDB Integration</strong> - Optimized for time-series data (prices, trades)</li>
<li><strong>Comprehensive Indexing</strong> - Fast queries even with millions of records</li>
<li><strong>Generated Columns</strong> - Automatic calculations (like <code>available_balance</code>)</li>
<li><strong>Views</strong> - Pre-built complex queries (<code>active_positions</code>, <code>market_summary</code>)</li>
<li><strong>Functions</strong> - Reusable business logic (<code>calculate_position_health</code>)</li>
</ol>
<hr />
<h2>🛡️ Security Deep Dive</h2>
<h3>The Horror Stories You Heard About</h3>
<h4>Common Supabase Security Mistakes:</h4>
<ol>
<li><strong>Exposing Service Role Key</strong> - This gives full database access</li>
<li><strong>Disabling RLS</strong> - Users can see all data</li>
<li><strong>Weak JWT Secrets</strong> - Authentication can be broken</li>
<li><strong>No Rate Limiting</strong> - APIs can be abused</li>
<li><strong>Missing Input Validation</strong> - SQL injection attacks</li>
</ol>
<h3>Your Security Setup (What You're Doing Right)</h3>
<h4>1. Row Level Security (RLS)</h4>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Users can ONLY see their own data</span>
<span class="k">CREATE</span><span class="w"> </span><span class="n">POLICY</span><span class="w"> </span><span class="ss">&quot;Users can view own balances&quot;</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">user_balances</span>
<span class="w">    </span><span class="k">FOR</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">auth</span><span class="p">.</span><span class="n">jwt</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;&gt;</span><span class="w"> </span><span class="s1">&#39;wallet_address&#39;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">wallet_address</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">user_id</span>
<span class="w">    </span><span class="p">));</span>
</code></pre></div>

<h4>2. Wallet-Based Authentication</h4>
<ul>
<li>No passwords to hack</li>
<li>Users sign transactions with their wallet</li>
<li>Much more secure than traditional auth</li>
</ul>
<h4>3. Environment Variables</h4>
<p>Your <code>.env.example</code> shows proper secret management:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">SUPABASE_SERVICE_ROLE_KEY</span><span class="o">=</span><span class="w">  </span><span class="c1"># Never expose this!</span>
<span class="nv">JWT_SECRET</span><span class="o">=</span><span class="w">                  </span><span class="c1"># Keep this secret!</span>
</code></pre></div>

<h3>Security Best Practices</h3>
<h4>1. Environment Security:</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Never commit .env files</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;.env&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>.gitignore
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;*.env&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>.gitignore

<span class="c1"># Use strong secrets</span>
<span class="nv">JWT_SECRET</span><span class="o">=</span><span class="k">$(</span>openssl<span class="w"> </span>rand<span class="w"> </span>-hex<span class="w"> </span><span class="m">32</span><span class="k">)</span>
</code></pre></div>

<h4>2. Database Security:</h4>
<ul>
<li>Always use SSL connections</li>
<li>Enable connection pooling</li>
<li>Regular security audits</li>
<li>Monitor access logs</li>
</ul>
<h4>3. Application Security:</h4>
<ul>
<li>Validate all inputs</li>
<li>Use parameterized queries</li>
<li>Implement rate limiting</li>
<li>Monitor for suspicious activity</li>
</ul>
<hr />
<h2>🎯 Deployment Levels</h2>
<h3>Base Deployment Level (MVP)</h3>
<p><strong>What you need:</strong>
- Supabase free tier (good for development)
- Basic RLS policies
- Essential tables only
- Simple authentication</p>
<p><strong>Your current setup is already beyond this!</strong></p>
<h3>Production Deployment Level</h3>
<p><strong>What you need:</strong>
- Supabase Pro plan ($25/month)
- Comprehensive monitoring
- Automated backups
- Performance optimization
- Security hardening</p>
<p><strong>You're very close to this level!</strong></p>
<h3>Enterprise Deployment Level</h3>
<p><strong>What you need:</strong>
- Supabase Enterprise
- Custom infrastructure
- Advanced monitoring
- Compliance features
- 24/7 support</p>
<hr />
<h2>🆚 PostgreSQL vs Alternatives</h2>
<h3>Why PostgreSQL (Not SQLite)</h3>
<h4>SQLite:</h4>
<ul>
<li>❌ Single file database</li>
<li>❌ No concurrent writes</li>
<li>❌ No network access</li>
<li>❌ Limited scalability</li>
<li>❌ No advanced features</li>
</ul>
<h4>PostgreSQL:</h4>
<ul>
<li>✅ Multi-user database</li>
<li>✅ Concurrent read/write</li>
<li>✅ Network accessible</li>
<li>✅ Scales to millions of users</li>
<li>✅ Advanced features (JSON, full-text search, etc.)</li>
</ul>
<h3>Why Supabase (Not Raw PostgreSQL)</h3>
<h4>Raw PostgreSQL:</h4>
<ul>
<li>❌ You manage the server</li>
<li>❌ You handle backups</li>
<li>❌ You build APIs</li>
<li>❌ You implement auth</li>
<li>❌ You manage scaling</li>
</ul>
<h4>Supabase:</h4>
<ul>
<li>✅ Managed service</li>
<li>✅ Automatic backups</li>
<li>✅ Auto-generated APIs</li>
<li>✅ Built-in authentication</li>
<li>✅ Automatic scaling</li>
</ul>
<hr />
<h2>🔧 Database Routines &amp; Maintenance</h2>
<h3>Daily Routines</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Check system health</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">system_events</span><span class="w"> </span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">severity</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;critical&#39;</span><span class="p">)</span><span class="w"> </span>
<span class="k">AND</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;1 day&#39;</span><span class="p">;</span>

<span class="c1">-- Monitor slow queries</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">pg_stat_statements</span><span class="w"> </span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">total_time</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</code></pre></div>

<h3>Weekly Routines</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Clean up old data</span>
<span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">system_events</span><span class="w"> </span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;30 days&#39;</span><span class="p">;</span>

<span class="c1">-- Update statistics</span>
<span class="k">ANALYZE</span><span class="p">;</span>
</code></pre></div>

<h3>Monthly Routines</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Check index usage</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">pg_stat_user_indexes</span><span class="p">;</span>

<span class="c1">-- Review security logs</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">system_events</span><span class="w"> </span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">event_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;security&#39;</span><span class="w"> </span>
<span class="k">AND</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;30 days&#39;</span><span class="p">;</span>
</code></pre></div>

<hr />
<h2>🛠️ Hands-On Examples</h2>
<h3>Common Queries for Your Project</h3>
<h4>1. Get User's Active Positions</h4>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">p</span><span class="p">.</span><span class="o">*</span><span class="p">,</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">symbol</span><span class="p">,</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">base_asset</span><span class="p">,</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">quote_asset</span><span class="p">,</span>
<span class="w">    </span><span class="n">p</span><span class="p">.</span><span class="n">unrealized_pnl</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">positions</span><span class="w"> </span><span class="n">p</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">markets</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">market_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;user-uuid-here&#39;</span>
<span class="k">AND</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="k">size</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span>
<span class="k">AND</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">is_liquidated</span><span class="p">;</span>
</code></pre></div>

<h4>2. Get Market Summary</h4>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">symbol</span><span class="p">,</span>
<span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">user_id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">active_traders</span><span class="p">,</span>
<span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="k">size</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">total_open_interest</span><span class="p">,</span>
<span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">leverage</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">avg_leverage</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">markets</span><span class="w"> </span><span class="n">m</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">positions</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">market_id</span><span class="w"> </span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="k">size</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">is_liquidated</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">symbol</span><span class="p">;</span>
</code></pre></div>

<h4>3. Check Recent Oracle Prices</h4>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">symbol</span><span class="p">,</span>
<span class="w">    </span><span class="n">op</span><span class="p">.</span><span class="n">price</span><span class="p">,</span>
<span class="w">    </span><span class="n">op</span><span class="p">.</span><span class="n">confidence</span><span class="p">,</span>
<span class="w">    </span><span class="n">op</span><span class="p">.</span><span class="n">created_at</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">oracle_prices</span><span class="w"> </span><span class="n">op</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">markets</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">op</span><span class="p">.</span><span class="n">market_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">op</span><span class="p">.</span><span class="n">created_at</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;1 hour&#39;</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">op</span><span class="p">.</span><span class="n">created_at</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</code></pre></div>

<h4>4. Monitor System Health</h4>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">event_type</span><span class="p">,</span>
<span class="w">    </span><span class="n">severity</span><span class="p">,</span>
<span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">count</span><span class="p">,</span>
<span class="w">    </span><span class="k">MAX</span><span class="p">(</span><span class="n">created_at</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">last_occurrence</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">system_events</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;24 hours&#39;</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">event_type</span><span class="p">,</span><span class="w"> </span><span class="n">severity</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">count</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</code></pre></div>

<h3>Testing Your RLS Policies</h3>
<h4>1. Test User Data Isolation</h4>
<div class="codehilite"><pre><span></span><code><span class="c1">-- This should only return the current user&#39;s data</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">user_balances</span><span class="p">;</span>

<span class="c1">-- This should only return the current user&#39;s positions</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">positions</span><span class="p">;</span>
</code></pre></div>

<h4>2. Test Market Data Access</h4>
<div class="codehilite"><pre><span></span><code><span class="c1">-- This should work for all users (markets are public)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">markets</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">is_active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>

<span class="c1">-- This should work for all users (prices are public)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">oracle_prices</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</code></pre></div>

<hr />
<h2>📋 Best Practices</h2>
<h3>Database Design</h3>
<ol>
<li><strong>Use UUIDs for primary keys</strong> - Better for distributed systems</li>
<li><strong>Always include timestamps</strong> - <code>created_at</code>, <code>updated_at</code></li>
<li><strong>Use appropriate data types</strong> - <code>DECIMAL</code> for money, <code>TIMESTAMP WITH TIME ZONE</code> for dates</li>
<li><strong>Create indexes on frequently queried columns</strong></li>
<li><strong>Use foreign key constraints</strong> - Maintain data integrity</li>
</ol>
<h3>Security</h3>
<ol>
<li><strong>Enable RLS on all user tables</strong></li>
<li><strong>Use strong, unique secrets</strong></li>
<li><strong>Never expose service role keys</strong></li>
<li><strong>Validate all inputs</strong></li>
<li><strong>Monitor access logs</strong></li>
</ol>
<h3>Performance</h3>
<ol>
<li><strong>Use TimescaleDB for time-series data</strong></li>
<li><strong>Create indexes on query columns</strong></li>
<li><strong>Use views for complex queries</strong></li>
<li><strong>Monitor slow queries</strong></li>
<li><strong>Regular maintenance (ANALYZE, VACUUM)</strong></li>
</ol>
<h3>Development</h3>
<ol>
<li><strong>Use migrations for schema changes</strong></li>
<li><strong>Test RLS policies thoroughly</strong></li>
<li><strong>Backup before major changes</strong></li>
<li><strong>Use staging environment</strong></li>
<li><strong>Monitor system events</strong></li>
</ol>
<hr />
<h2>🚨 Troubleshooting</h2>
<h3>Common Issues</h3>
<h4>1. TimescaleDB Extension Missing</h4>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Enable TimescaleDB</span>
<span class="k">CREATE</span><span class="w"> </span><span class="n">EXTENSION</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">timescaledb</span><span class="p">;</span>

<span class="c1">-- Create hypertables</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">create_hypertable</span><span class="p">(</span><span class="s1">&#39;oracle_prices&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;created_at&#39;</span><span class="p">);</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">create_hypertable</span><span class="p">(</span><span class="s1">&#39;trades&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;created_at&#39;</span><span class="p">);</span>
</code></pre></div>

<h4>2. RLS Policies Not Working</h4>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Check if RLS is enabled</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">schemaname</span><span class="p">,</span><span class="w"> </span><span class="n">tablename</span><span class="p">,</span><span class="w"> </span><span class="n">rowsecurity</span><span class="w"> </span>
<span class="k">FROM</span><span class="w"> </span><span class="n">pg_tables</span><span class="w"> </span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">tablename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;users&#39;</span><span class="p">;</span>

<span class="c1">-- Check policies</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">pg_policies</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">tablename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;users&#39;</span><span class="p">;</span>
</code></pre></div>

<h4>3. Performance Issues</h4>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Check index usage</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">pg_stat_user_indexes</span><span class="p">;</span>

<span class="c1">-- Analyze slow queries</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">pg_stat_statements</span><span class="w"> </span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">total_time</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>

<span class="c1">-- Check table sizes</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">schemaname</span><span class="p">,</span>
<span class="w">    </span><span class="n">tablename</span><span class="p">,</span>
<span class="w">    </span><span class="n">pg_size_pretty</span><span class="p">(</span><span class="n">pg_total_relation_size</span><span class="p">(</span><span class="n">schemaname</span><span class="o">||</span><span class="s1">&#39;.&#39;</span><span class="o">||</span><span class="n">tablename</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">size</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">pg_tables</span><span class="w"> </span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">pg_total_relation_size</span><span class="p">(</span><span class="n">schemaname</span><span class="o">||</span><span class="s1">&#39;.&#39;</span><span class="o">||</span><span class="n">tablename</span><span class="p">)</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</code></pre></div>

<h4>4. Connection Issues</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Test connection</span>
psql<span class="w"> </span><span class="s2">&quot;your-connection-string&quot;</span><span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;SELECT version();&quot;</span>

<span class="c1"># Check connection limits</span>
SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>pg_stat_activity<span class="p">;</span>
</code></pre></div>

<h3>Getting Help</h3>
<ol>
<li><strong>Check system_events table</strong> for errors</li>
<li><strong>Review Supabase logs</strong> in dashboard</li>
<li><strong>Use EXPLAIN ANALYZE</strong> for slow queries</li>
<li><strong>Monitor TimescaleDB metrics</strong></li>
<li><strong>Check PostgreSQL documentation</strong></li>
</ol>
<hr />
<h2>🎉 What You've Already Built (Impressive!)</h2>
<p>Looking at your project, you've created a <strong>professional-grade trading platform</strong> with:</p>
<ol>
<li><strong>Sophisticated Schema</strong> - All the tables a real DEX needs</li>
<li><strong>Risk Management</strong> - Liquidation, funding, health factors</li>
<li><strong>Real-time Features</strong> - Oracle price feeds, live updates</li>
<li><strong>Security</strong> - RLS policies, wallet authentication</li>
<li><strong>Performance</strong> - TimescaleDB, optimized indexes</li>
<li><strong>Monitoring</strong> - System events, comprehensive logging</li>
</ol>
<hr />
<h2>🚀 Next Steps for Your Learning</h2>
<ol>
<li><strong>Practice Queries</strong> - Try writing some SQL queries on your data</li>
<li><strong>Explore Supabase Dashboard</strong> - See your data visually</li>
<li><strong>Test RLS Policies</strong> - Verify security is working</li>
<li><strong>Monitor Performance</strong> - Check query speeds</li>
<li><strong>Backup Strategy</strong> - Understand your backup options</li>
</ol>
<hr />
<h2>📚 Additional Resources</h2>
<ul>
<li><a href="https://www.postgresql.org/docs/">PostgreSQL Documentation</a></li>
<li><a href="https://docs.timescale.com/">TimescaleDB Documentation</a></li>
<li><a href="https://supabase.com/docs">Supabase Documentation</a></li>
<li><a href="https://spl.solana.com/">Solana Program Library</a></li>
</ul>
<hr />
<h2>🤔 Questions to Explore</h2>
<ol>
<li><strong>What specific part</strong> of PostgreSQL/Supabase do you want to dive deeper into?</li>
<li><strong>Are there any security concerns</strong> you're particularly worried about?</li>
<li><strong>What's your current deployment target</strong> - development, staging, or production?</li>
<li><strong>Do you want to practice</strong> with some hands-on SQL queries?</li>
</ol>
<p>Your setup is already quite advanced! You're using professional-grade patterns that many developers never learn. The fact that you have TimescaleDB, RLS policies, and comprehensive indexing shows you're building something serious.</p>
<hr />
<p><strong>Happy Learning! 🚀</strong></p>
<p><em>This guide covers everything from basics to advanced concepts. Bookmark it and refer back as you continue building your trading platform!</em></p>
    </div>
</body>
</html>