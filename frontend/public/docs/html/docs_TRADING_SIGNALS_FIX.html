<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Signals Fix - QuantDesk Documentation</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <style>
        body {
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace;
            line-height: 1.6;
            color: #ffffff;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #000000;
            font-size: 14px;
        }
        .container {
            background: #000000;
            padding: 30px;
            border-radius: 8px;
            border: 1px solid #333333;
        }
        .back-link {
            margin-bottom: 20px;
        }
        .back-link a {
            color: #3b82f6;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s ease;
        }
        .back-link a:hover {
            color: #60a5fa;
            text-decoration: underline;
        }
        h1, h2, h3, h4, h5, h6 {
            color: #ffffff;
            margin-top: 30px;
            margin-bottom: 15px;
            font-weight: 600;
        }
        h1 {
            border-bottom: 2px solid #333333;
            padding-bottom: 10px;
        }
        h2 {
            border-bottom: 1px solid #333333;
            padding-bottom: 8px;
        }
        code {
            background: #1a1a1a;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace;
            color: #ffffff;
            border: 1px solid #333333;
        }
        pre {
            background: #0a0a0a;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            border: 1px solid #333333;
            margin: 20px 0;
        }
        pre code {
            background: none;
            padding: 0;
            color: #ffffff;
            border: none;
        }
        blockquote {
            border-left: 4px solid #3b82f6;
            margin: 0;
            padding-left: 20px;
            color: #d9d9d9;
            background: #1a1a1a;
            padding: 15px 20px;
            border-radius: 0 8px 8px 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            border: 1px solid #333333;
        }
        th, td {
            border: 1px solid #333333;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #1a1a1a;
            font-weight: bold;
            color: #ffffff;
        }
        td {
            color: #d9d9d9;
        }
        ul, ol {
            color: #d9d9d9;
        }
        li {
            margin-bottom: 8px;
        }
        a {
            color: #3b82f6;
            text-decoration: none;
        }
        a:hover {
            color: #60a5fa;
            text-decoration: underline;
        }
        /* Syntax Highlighting Overrides */
        pre[class*="language-"] {
            background: #0a0a0a !important;
            border: 1px solid #333333 !important;
            border-radius: 8px !important;
            padding: 20px !important;
            margin: 20px 0 !important;
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace !important;
            font-size: 13px !important;
            line-height: 1.5 !important;
        }
        .token.comment { color: #6a9955 !important; }
        .token.keyword { color: #569cd6 !important; }
        .token.string { color: #ce9178 !important; }
        .token.number { color: #b5cea8 !important; }
        .token.function { color: #dcdcaa !important; }
        .token.class-name { color: #4ec9b0 !important; }
        .token.operator { color: #d4d4d4 !important; }
        .token.punctuation { color: #d4d4d4 !important; }
        .token.variable { color: #9cdcfe !important; }
        .token.constant { color: #4fc1ff !important; }
    </style>
</head>
<body>
    <div class="container">
        <div class="back-link">
            <a href="/docs">&larr; Back to Documentation</a>
        </div>
        <h1>Trading Signal Generation Fix</h1>
<h2>The Problem We Fixed</h2>
<p>We found and fixed three key issues that were preventing our ML models from generating good trading signals:</p>
<ol>
<li><strong>Unrealistic Threshold Expectations</strong>: </li>
<li>Our original code expected confidence values &gt;0.65, but our models output in a much lower range</li>
<li>5m model outputs: 0.26-0.40 range</li>
<li>15m model outputs: 0.12-0.35 range</li>
<li>
<p>Solution: We adjusted thresholds to match actual model output ranges</p>
</li>
<li>
<p><strong>Overly Strict Requirements</strong>:</p>
</li>
<li>Original approach required both models to agree AND have high confidence</li>
<li>
<p>Solution: Created multiple signal strategies including a "TradingView-style" approach that's less strict</p>
</li>
<li>
<p><strong>Better Visualization</strong>:</p>
</li>
<li>Added clear visualization of all signal types</li>
<li>Displayed thresholds based on actual model output ranges</li>
</ol>
<h2>The Results</h2>
<h3>30-Day Backtest</h3>
<p>After our fixes, the backtest now shows:</p>
<ol>
<li><strong>TradingView-Style Signals</strong>: </li>
<li>60 signals (21% of candles)</li>
<li>0.46% average return, 63% win rate</li>
<li>
<p>Equity growth: $100 → $131 over 30 days</p>
</li>
<li>
<p><strong>Combined Signals</strong> (weighted approach):</p>
</li>
<li>133 signals (47% of candles)</li>
<li>0.23% average return, 59% win rate</li>
<li>
<p>Equity growth: $100 → $133 over 30 days</p>
</li>
<li>
<p><strong>Strong Signals</strong> (original approach with adjusted thresholds):</p>
</li>
<li>46 signals (16% of candles)</li>
<li>0.70% average return, 70% win rate</li>
<li>Equity growth: $100 → $137 over 30 days</li>
</ol>
<h3>60-Day Backtest</h3>
<p>When testing over a longer 60-day period to see how the strategy performs in different market conditions:</p>
<ol>
<li><strong>TradingView-Style Signals</strong>: </li>
<li>71 signals (25% of candles)</li>
<li>-0.16% average return, 46% win rate</li>
<li>
<p>Equity performance: $100 → $87.53 (losing)</p>
</li>
<li>
<p><strong>Combined Signals</strong> (weighted approach):</p>
</li>
<li>163 signals (57% of candles)</li>
<li>0.12% average return, 52% win rate</li>
<li>
<p>Equity performance: $100 → $118.03 (profitable)</p>
</li>
<li>
<p><strong>Strong Signals</strong> (original approach with adjusted thresholds):</p>
</li>
<li>66 signals (23% of candles)</li>
<li>-0.15% average return, 47% win rate</li>
<li>Equity performance: $100 → $88.84 (losing)</li>
</ol>
<h3>Analysis of Longer-Term Performance</h3>
<p>The 60-day backtest reveals important insights:</p>
<ol>
<li>
<p><strong>Market Regime Matters</strong>: The recent 30 days showed strong performance across all signal types, but looking back 60 days shows more challenging market conditions.</p>
</li>
<li>
<p><strong>The Combined Approach Is Most Robust</strong>: While TradingView-style and Strong signals performed better in the recent 30 days, over 60 days the Combined approach is the only profitable strategy.</p>
</li>
<li>
<p><strong>Signal Frequency vs Quality</strong>: The Combined approach generates more signals (57% of candles) with a lower average return, but demonstrates better consistency across changing market conditions.</p>
</li>
</ol>
<h2>Key Takeaways</h2>
<ol>
<li><strong>Neural Network Output Ranges</strong>: </li>
<li>Neural networks don't always output in the full 0.0-1.0 range</li>
<li>The actual range depends on your training data, class distribution, and model architecture</li>
<li>
<p>Lesson: Always inspect your model output distribution before setting thresholds</p>
</li>
<li>
<p><strong>Signal Strategy Matters</strong>:</p>
</li>
<li>Different signal strategies perform differently in various market conditions</li>
<li>More frequent, lower-conviction signals (Combined approach) provide more consistency</li>
<li>
<p>High-conviction signals (Strong approach) can outperform in favorable markets</p>
</li>
<li>
<p><strong>Market Regime Adaptation</strong>:</p>
</li>
<li>Consider implementing a market regime detection system</li>
<li>Adjust signal strategy based on current market conditions</li>
</ol>
<h2>What To Do Next</h2>
<ol>
<li>
<p><strong>Run Live with Combined Strategy</strong>:
   <code>bash
   python scripts/combined_model_trader.py --live --confidence-threshold 0.3 --combined-threshold 0.25</code></p>
</li>
<li>
<p><strong>Consider Model Calibration</strong>:</p>
</li>
<li>Implement a calibration layer that maps raw model outputs to a more intuitive 0-1 range</li>
<li>
<p>This makes threshold selection more natural (e.g., 0.7 means 70% confident)</p>
</li>
<li>
<p><strong>Try Different Signal Combinations</strong>:</p>
</li>
<li>The Combined approach proved most robust over 60 days</li>
<li>
<p>Experiment with different weightings for 5m vs 15m signals</p>
</li>
<li>
<p><strong>Implement Market Regime Detection</strong>:</p>
</li>
<li>Add features to detect different market conditions (trending, ranging, volatile)</li>
<li>
<p>Adjust signal strategy based on detected market regime</p>
</li>
<li>
<p><strong>Retraining Opportunities</strong>:</p>
</li>
<li>Consider retraining with different labeling thresholds (e.g., 0.3% for 5m, 0.5% for 15m)</li>
<li>Include more diverse market conditions in training data</li>
</ol>
<p>Remember: Most trading indicators on TradingView are relatively simple and generate frequent signals. Our ML model approach with appropriate thresholds can now generate useful signals while maintaining profitability over longer time horizons. </p>
    </div>
</body>
</html>