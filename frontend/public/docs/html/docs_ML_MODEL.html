<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ml Model - QuantDesk Documentation</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <style>
        body {
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace;
            line-height: 1.6;
            color: #ffffff;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #000000;
            font-size: 14px;
        }
        .container {
            background: #000000;
            padding: 30px;
            border-radius: 8px;
            border: 1px solid #333333;
        }
        .back-link {
            margin-bottom: 20px;
        }
        .back-link a {
            color: #3b82f6;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s ease;
        }
        .back-link a:hover {
            color: #60a5fa;
            text-decoration: underline;
        }
        h1, h2, h3, h4, h5, h6 {
            color: #ffffff;
            margin-top: 30px;
            margin-bottom: 15px;
            font-weight: 600;
        }
        h1 {
            border-bottom: 2px solid #333333;
            padding-bottom: 10px;
        }
        h2 {
            border-bottom: 1px solid #333333;
            padding-bottom: 8px;
        }
        code {
            background: #1a1a1a;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace;
            color: #ffffff;
            border: 1px solid #333333;
        }
        pre {
            background: #0a0a0a;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            border: 1px solid #333333;
            margin: 20px 0;
        }
        pre code {
            background: none;
            padding: 0;
            color: #ffffff;
            border: none;
        }
        blockquote {
            border-left: 4px solid #3b82f6;
            margin: 0;
            padding-left: 20px;
            color: #d9d9d9;
            background: #1a1a1a;
            padding: 15px 20px;
            border-radius: 0 8px 8px 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            border: 1px solid #333333;
        }
        th, td {
            border: 1px solid #333333;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #1a1a1a;
            font-weight: bold;
            color: #ffffff;
        }
        td {
            color: #d9d9d9;
        }
        ul, ol {
            color: #d9d9d9;
        }
        li {
            margin-bottom: 8px;
        }
        a {
            color: #3b82f6;
            text-decoration: none;
        }
        a:hover {
            color: #60a5fa;
            text-decoration: underline;
        }
        /* Syntax Highlighting Overrides */
        pre[class*="language-"] {
            background: #0a0a0a !important;
            border: 1px solid #333333 !important;
            border-radius: 8px !important;
            padding: 20px !important;
            margin: 20px 0 !important;
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace !important;
            font-size: 13px !important;
            line-height: 1.5 !important;
        }
        .token.comment { color: #6a9955 !important; }
        .token.keyword { color: #569cd6 !important; }
        .token.string { color: #ce9178 !important; }
        .token.number { color: #b5cea8 !important; }
        .token.function { color: #dcdcaa !important; }
        .token.class-name { color: #4ec9b0 !important; }
        .token.operator { color: #d4d4d4 !important; }
        .token.punctuation { color: #d4d4d4 !important; }
        .token.variable { color: #9cdcfe !important; }
        .token.constant { color: #4fc1ff !important; }
    </style>
</head>
<body>
    <div class="container">
        <div class="back-link">
            <a href="/docs">&larr; Back to Documentation</a>
        </div>
        <h1>ðŸ§  Machine Learning Model Architecture</h1>
<p><em>What is this doc?</em><br />
This guide explains the structure, training, and deployment of the project's main ML model. It's for anyone wanting to understand, extend, or use the modelâ€”whether you're a developer, researcher, or curious trader.</p>
<p><a href="../README.md#project-structure">Project Structure</a> | <a href="INDICATORS.html">Indicators</a> | <a href="TECHNICAL_STRATEGY.html">Technical Strategy</a> | <a href="MODEL_TRAINING.html">Model Training</a> | <a href="ML_MODEL_STRUCTURE.html">ML Structure Guide</a></p>
<h2>Overview</h2>
<p>Our trading model uses PyTorch to implement a hybrid architecture combining traditional technical analysis with deep learning. This document explains the model's structure, training process, and deployment.</p>
<h2>Table of Contents</h2>
<ol>
<li><a href="#project-structure">Project Structure</a></li>
<li><a href="#model-architecture">Model Architecture</a></li>
<li><a href="#training-pipeline">Training Pipeline</a></li>
<li><a href="#feature-engineering">Feature Engineering</a></li>
<li><a href="#performance-optimization">Performance Optimization</a></li>
<li><a href="#deployment">Deployment</a></li>
</ol>
<h2>Project Structure</h2>
<p>The project is organized into the following directory structure:</p>
<div class="codehilite"><pre><span></span><code><span class="n">src</span><span class="o">/</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">features</span><span class="o">/</span><span class="w">           </span><span class="p">#</span><span class="w"> </span><span class="n">Core</span><span class="w"> </span><span class="n">technical</span><span class="w"> </span><span class="n">indicators</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">rsi</span><span class="p">.</span><span class="n">py</span><span class="w">          </span><span class="p">#</span><span class="w"> </span><span class="n">Relative</span><span class="w"> </span><span class="n">Strength</span><span class="w"> </span><span class="n">Index</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">cci</span><span class="p">.</span><span class="n">py</span><span class="w">          </span><span class="p">#</span><span class="w"> </span><span class="n">Commodity</span><span class="w"> </span><span class="n">Channel</span><span class="w"> </span><span class="n">Index</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">adx</span><span class="p">.</span><span class="n">py</span><span class="w">          </span><span class="p">#</span><span class="w"> </span><span class="n">Average</span><span class="w"> </span><span class="n">Directional</span><span class="w"> </span><span class="n">Index</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">wave_trend</span><span class="p">.</span><span class="n">py</span><span class="w">   </span><span class="p">#</span><span class="w"> </span><span class="n">WaveTrend</span><span class="w"> </span><span class="n">Oscillator</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">indicators</span><span class="o">/</span><span class="w">         </span><span class="p">#</span><span class="w"> </span><span class="n">Base</span><span class="w"> </span><span class="n">indicator</span><span class="w"> </span><span class="n">foundations</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">base_torch_indicator</span><span class="p">.</span><span class="n">py</span><span class="w">  </span><span class="p">#</span><span class="w"> </span><span class="n">PyTorch</span><span class="w"> </span><span class="n">base</span><span class="w"> </span><span class="n">indicator</span><span class="w"> </span><span class="n">class</span>
<span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">models</span><span class="o">/</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">strategy</span><span class="o">/</span><span class="w">       </span><span class="p">#</span><span class="w"> </span><span class="n">Trading</span><span class="w"> </span><span class="n">strategies</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">lorentzian_classifier</span><span class="p">.</span><span class="n">py</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â”œâ”€â”€</span><span class="w"> </span><span class="n">logistic_regression_torch</span><span class="p">.</span><span class="n">py</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">chandelier_exit</span><span class="p">.</span><span class="n">py</span>
<span class="err">â”‚</span><span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">training</span><span class="o">/</span><span class="w">       </span><span class="p">#</span><span class="w"> </span><span class="n">Model</span><span class="w"> </span><span class="n">training</span><span class="w"> </span><span class="n">utilities</span>
<span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">pattern</span><span class="o">-</span><span class="n">recognition</span><span class="o">/</span><span class="w"> </span><span class="p">#</span><span class="w"> </span><span class="n">Pattern</span><span class="w"> </span><span class="n">detection</span><span class="w"> </span><span class="n">algorithms</span>
</code></pre></div>

<h2>Model Architecture</h2>
<h3>Base Model Structure</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">TradingModel</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Feature extraction layers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_extractor</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">input_channels</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># LSTM for temporal patterns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span>
            <span class="n">input_size</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
            <span class="n">hidden_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
            <span class="n">num_layers</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">dropout</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
            <span class="n">batch_first</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="c1"># Attention mechanism</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attention</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MultiheadAttention</span><span class="p">(</span>
            <span class="n">embed_dim</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
            <span class="n">num_heads</span><span class="o">=</span><span class="mi">4</span>
        <span class="p">)</span>

        <span class="c1"># Technical indicator integration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">technical_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">n_indicators</span><span class="p">,</span>
            <span class="mi">64</span>
        <span class="p">)</span>

        <span class="c1"># Final prediction layers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictor</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">128</span> <span class="o">+</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">output_dim</span><span class="p">)</span>
        <span class="p">)</span>
</code></pre></div>

<h3>Model Components</h3>
<ol>
<li><strong>Feature Extraction</strong></li>
<li>Convolutional layers for pattern recognition</li>
<li>Batch normalization for training stability</li>
<li>
<p>Dropout for regularization</p>
</li>
<li>
<p><strong>Temporal Processing</strong></p>
</li>
<li>LSTM layers for sequence modeling</li>
<li>Attention mechanism for important pattern focus</li>
<li>
<p>Residual connections for gradient flow</p>
</li>
<li>
<p><strong>Technical Integration</strong></p>
</li>
<li>Direct input of technical indicators</li>
<li>Learned feature combination</li>
<li>Adaptive weighting mechanism</li>
</ol>
<h2>Training Pipeline</h2>
<h3>1. Data Loading</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">TradingDataset</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">lookback</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lookback</span> <span class="o">=</span> <span class="n">lookback</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="c1"># Get sequence of price data</span>
        <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">:</span><span class="n">idx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookback</span><span class="p">]</span>

        <span class="c1"># Get technical indicators</span>
        <span class="n">indicators</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_indicators</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>

        <span class="c1"># Get target (future price movement)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookback</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;sequence&#39;</span><span class="p">:</span> <span class="n">sequence</span><span class="p">,</span>
            <span class="s1">&#39;indicators&#39;</span><span class="p">:</span> <span class="n">indicators</span><span class="p">,</span>
            <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="n">target</span>
        <span class="p">}</span>
</code></pre></div>

<h3>2. Training Loop</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">train_epoch</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">dataloader</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">dataloader</span><span class="p">:</span>
        <span class="c1"># Move data to device</span>
        <span class="n">sequences</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;sequence&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="n">indicators</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;indicators&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

        <span class="c1"># Forward pass</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="n">indicators</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>

        <span class="c1"># Backward pass</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

        <span class="c1"># Update metrics</span>
        <span class="n">update_metrics</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
</code></pre></div>

<h3>3. Validation</h3>
<div class="codehilite"><pre><span></span><code><span class="nd">@torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">val_loader</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">val_loader</span><span class="p">:</span>
        <span class="c1"># Generate predictions</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span>
            <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;sequence&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span>
            <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;indicators&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Calculate metrics</span>
        <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">criterion</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">calculate_accuracy</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</code></pre></div>

<h2>Feature Engineering</h2>
<h3>1. Price Features</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_price_features</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">features</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Price changes</span>
    <span class="n">features</span><span class="p">[</span><span class="s1">&#39;returns&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>
    <span class="n">features</span><span class="p">[</span><span class="s1">&#39;log_returns&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;returns&#39;</span><span class="p">])</span>

    <span class="c1"># Moving averages</span>
    <span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">]:</span>
        <span class="n">features</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;ma_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="c1"># Volatility</span>
    <span class="n">features</span><span class="p">[</span><span class="s1">&#39;volatility&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="s1">&#39;returns&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">features</span>
</code></pre></div>

<h3>2. GPU-Accelerated Technical Indicators</h3>
<p>We use PyTorch-based implementations of technical indicators for improved performance:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Initialize RSI with GPU support</span>
<span class="n">rsi_indicator</span> <span class="o">=</span> <span class="n">RSIIndicator</span><span class="p">(</span>
    <span class="n">period</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
    <span class="n">overbought</span><span class="o">=</span><span class="mf">70.0</span><span class="p">,</span>
    <span class="n">oversold</span><span class="o">=</span><span class="mf">30.0</span><span class="p">,</span>
    <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span>
<span class="p">)</span>

<span class="c1"># Calculate RSI values and signals</span>
<span class="n">rsi_results</span> <span class="o">=</span> <span class="n">rsi_indicator</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Access RSI values and signals</span>
<span class="n">rsi_values</span> <span class="o">=</span> <span class="n">rsi_results</span><span class="p">[</span><span class="s1">&#39;rsi&#39;</span><span class="p">]</span>
<span class="n">buy_signals</span> <span class="o">=</span> <span class="n">rsi_results</span><span class="p">[</span><span class="s1">&#39;buy_signals&#39;</span><span class="p">]</span>
<span class="n">sell_signals</span> <span class="o">=</span> <span class="n">rsi_results</span><span class="p">[</span><span class="s1">&#39;sell_signals&#39;</span><span class="p">]</span>
</code></pre></div>

<h3>3. Indicator Integration</h3>
<p>Our PyTorch indicators provide a unified interface:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">create_feature_matrix</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1"># Initialize indicators</span>
    <span class="n">indicators</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;rsi&#39;</span><span class="p">:</span> <span class="n">RSIIndicator</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mi">14</span><span class="p">),</span>
        <span class="s1">&#39;cci&#39;</span><span class="p">:</span> <span class="n">CCIIndicator</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
        <span class="s1">&#39;adx&#39;</span><span class="p">:</span> <span class="n">ADXIndicator</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mi">14</span><span class="p">),</span>
        <span class="s1">&#39;wavetrend&#39;</span><span class="p">:</span> <span class="n">WaveTrendIndicator</span><span class="p">(</span><span class="n">channel_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">average_length</span><span class="o">=</span><span class="mi">21</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1"># Calculate all indicator values</span>
    <span class="n">features</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">indicator</span> <span class="ow">in</span> <span class="n">indicators</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">indicator</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">features</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
</code></pre></div>

<h3>4. Feature Normalization</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">normalize_features</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">scaler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
        <span class="n">features_normalized</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">features_normalized</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">features_normalized</span><span class="p">,</span> <span class="n">scaler</span>
</code></pre></div>

<h2>Performance Optimization</h2>
<h3>1. GPU Acceleration</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">setup_training</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span><span class="p">):</span>
    <span class="c1"># Move model to GPU if available</span>
    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="ow">and</span> <span class="n">device</span> <span class="o">==</span> <span class="s1">&#39;cuda&#39;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>

    <span class="c1"># Enable automatic mixed precision</span>
    <span class="n">scaler</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">amp</span><span class="o">.</span><span class="n">GradScaler</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">model</span><span class="p">,</span> <span class="n">scaler</span>
</code></pre></div>

<h3>2. Memory Management</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">optimize_memory</span><span class="p">(</span><span class="n">dataloader</span><span class="p">):</span>
    <span class="c1"># Pin memory for faster GPU transfer</span>
    <span class="n">dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span>
        <span class="n">dataset</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
        <span class="n">pin_memory</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">num_workers</span><span class="o">=</span><span class="mi">4</span>
    <span class="p">)</span>

    <span class="c1"># Enable gradient checkpointing</span>
    <span class="n">model</span><span class="o">.</span><span class="n">gradient_checkpointing_enable</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">dataloader</span>
</code></pre></div>

<h3>3. Training Optimization</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">optimize_training</span><span class="p">():</span>
    <span class="c1"># Use mixed precision training</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">amp</span><span class="o">.</span><span class="n">autocast</span><span class="p">():</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="n">indicators</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>

    <span class="c1"># Scale loss and backpropagate</span>
    <span class="n">scaler</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
    <span class="n">scaler</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">optimizer</span><span class="p">)</span>
    <span class="n">scaler</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</code></pre></div>

<h2>Deployment</h2>
<h3>1. Model Export</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">export_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="c1"># Save model architecture and weights</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">({</span>
        <span class="s1">&#39;model_state&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span>
        <span class="s1">&#39;config&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
        <span class="s1">&#39;scaler&#39;</span><span class="p">:</span> <span class="n">scaler</span><span class="p">,</span>
    <span class="p">},</span> <span class="n">path</span><span class="p">)</span>
</code></pre></div>

<h3>2. Inference Pipeline</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">setup_inference</span><span class="p">(</span><span class="n">model_path</span><span class="p">):</span>
    <span class="c1"># Load model for inference</span>
    <span class="n">checkpoint</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">TradingModel</span><span class="p">(</span><span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">])</span>
    <span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;model_state&#39;</span><span class="p">])</span>
    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">model</span>

<span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sequence&#39;</span><span class="p">],</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;indicators&#39;</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">predictions</span>
</code></pre></div>

<h3>3. Real-time Processing</h3>
<div class="codehilite"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">process_realtime</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data_stream</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">data_stream</span><span class="p">:</span>
        <span class="c1"># Preprocess data</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">calculate_features</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Generate prediction</span>
        <span class="n">prediction</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">features</span><span class="p">)</span>

        <span class="c1"># Update trading signals</span>
        <span class="k">await</span> <span class="n">update_signals</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span>
</code></pre></div>

<hr />
<p><em>This documentation provides a comprehensive overview of our machine learning model architecture. For implementation details or specific questions, please refer to the relevant sections or contact the development team.</em> </p>
<h2>See Also</h2>
<ul>
<li><a href="../README.html">Project README</a> â€” Project overview, directory map, and quick start</li>
<li><a href="INDICATORS.html">Technical Indicators</a> â€” Details on all custom indicators</li>
<li><a href="TECHNICAL_STRATEGY.html">Technical Strategy</a> â€” How the model fits into the trading system</li>
<li><a href="MODEL_TRAINING.html">Model Training Guide</a> â€” How to train and evaluate models</li>
<li><strong><a href="ML_MODEL_STRUCTURE.html">ML Structure Guide</a> â€” CRITICAL: Features vs Strategies organization</strong></li>
<li><a href="NEON_PIPELINE.html">Neon Data Pipeline</a> â€” Data ingestion and feature engineering</li>
<li><a href="../src/features/">src/features/</a> â€” Core indicator code (e.g., <a href="../src/features/rsi.py">rsi.py</a>, <a href="../src/features/cci.py">cci.py</a>)</li>
<li><a href="../src/models/strategy/">src/models/strategy/</a> â€” Strategy/model code (e.g., <a href="../src/models/strategy/lorentzian_classifier.py">lorentzian_classifier.py</a>) </li>
</ul>
    </div>
</body>
</html>