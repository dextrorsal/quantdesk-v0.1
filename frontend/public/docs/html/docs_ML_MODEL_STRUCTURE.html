<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ml Model Structure - QuantDesk Documentation</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <style>
        body {
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace;
            line-height: 1.6;
            color: #ffffff;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #000000;
            font-size: 14px;
        }
        .container {
            background: #000000;
            padding: 30px;
            border-radius: 8px;
            border: 1px solid #333333;
        }
        .back-link {
            margin-bottom: 20px;
        }
        .back-link a {
            color: #3b82f6;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s ease;
        }
        .back-link a:hover {
            color: #60a5fa;
            text-decoration: underline;
        }
        h1, h2, h3, h4, h5, h6 {
            color: #ffffff;
            margin-top: 30px;
            margin-bottom: 15px;
            font-weight: 600;
        }
        h1 {
            border-bottom: 2px solid #333333;
            padding-bottom: 10px;
        }
        h2 {
            border-bottom: 1px solid #333333;
            padding-bottom: 8px;
        }
        code {
            background: #1a1a1a;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace;
            color: #ffffff;
            border: 1px solid #333333;
        }
        pre {
            background: #0a0a0a;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            border: 1px solid #333333;
            margin: 20px 0;
        }
        pre code {
            background: none;
            padding: 0;
            color: #ffffff;
            border: none;
        }
        blockquote {
            border-left: 4px solid #3b82f6;
            margin: 0;
            padding-left: 20px;
            color: #d9d9d9;
            background: #1a1a1a;
            padding: 15px 20px;
            border-radius: 0 8px 8px 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            border: 1px solid #333333;
        }
        th, td {
            border: 1px solid #333333;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #1a1a1a;
            font-weight: bold;
            color: #ffffff;
        }
        td {
            color: #d9d9d9;
        }
        ul, ol {
            color: #d9d9d9;
        }
        li {
            margin-bottom: 8px;
        }
        a {
            color: #3b82f6;
            text-decoration: none;
        }
        a:hover {
            color: #60a5fa;
            text-decoration: underline;
        }
        /* Syntax Highlighting Overrides */
        pre[class*="language-"] {
            background: #0a0a0a !important;
            border: 1px solid #333333 !important;
            border-radius: 8px !important;
            padding: 20px !important;
            margin: 20px 0 !important;
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace !important;
            font-size: 13px !important;
            line-height: 1.5 !important;
        }
        .token.comment { color: #6a9955 !important; }
        .token.keyword { color: #569cd6 !important; }
        .token.string { color: #ce9178 !important; }
        .token.number { color: #b5cea8 !important; }
        .token.function { color: #dcdcaa !important; }
        .token.class-name { color: #4ec9b0 !important; }
        .token.operator { color: #d4d4d4 !important; }
        .token.punctuation { color: #d4d4d4 !important; }
        .token.variable { color: #9cdcfe !important; }
        .token.constant { color: #4fc1ff !important; }
    </style>
</head>
<body>
    <div class="container">
        <div class="back-link">
            <a href="/docs">&larr; Back to Documentation</a>
        </div>
        <h1>🧠 ML Model Structure Guide</h1>
<h2>Overview</h2>
<p>This document explains the correct organization of the ML model components to prevent confusion between <strong>features</strong> and <strong>strategies</strong>.</p>
<h2>Directory Structure</h2>
<div class="codehilite"><pre><span></span><code><span class="n">src</span><span class="o">/</span><span class="n">ml</span><span class="o">/</span>
<span class="err">├──</span><span class="w"> </span><span class="n">features</span><span class="o">/</span><span class="w">                    </span><span class="p">#</span><span class="w"> </span><span class="n">Technical</span><span class="w"> </span><span class="n">Indicators</span><span class="w"> </span><span class="p">(</span><span class="n">FEATURES</span><span class="p">)</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">rsi</span><span class="p">.</span><span class="n">py</span><span class="w">                  </span><span class="p">#</span><span class="w"> </span><span class="n">RSI</span><span class="w"> </span><span class="n">indicator</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">adx</span><span class="p">.</span><span class="n">py</span><span class="w">                  </span><span class="p">#</span><span class="w"> </span><span class="n">ADX</span><span class="w"> </span><span class="n">indicator</span><span class="w">  </span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">cci</span><span class="p">.</span><span class="n">py</span><span class="w">                  </span><span class="p">#</span><span class="w"> </span><span class="n">CCI</span><span class="w"> </span><span class="n">indicator</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">wave_trend</span><span class="p">.</span><span class="n">py</span><span class="w">           </span><span class="p">#</span><span class="w"> </span><span class="n">WaveTrend</span><span class="w"> </span><span class="n">indicator</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">chandelier_exit</span><span class="p">.</span><span class="n">py</span><span class="w">      </span><span class="p">#</span><span class="w"> </span><span class="n">Chandelier</span><span class="w"> </span><span class="n">Exit</span><span class="w"> </span><span class="n">indicator</span><span class="w"> </span><span class="p">(</span><span class="mh">13</span><span class="n">KB</span><span class="p">,</span><span class="w"> </span><span class="mh">346</span><span class="w"> </span><span class="n">lines</span><span class="p">)</span>
<span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">base_torch_indicator</span><span class="p">.</span><span class="n">py</span><span class="w"> </span><span class="p">#</span><span class="w"> </span><span class="n">Base</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">indicators</span>
<span class="err">├──</span><span class="w"> </span><span class="n">models</span><span class="o">/</span>
<span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">strategy</span><span class="o">/</span><span class="w">               </span><span class="p">#</span><span class="w"> </span><span class="n">Trading</span><span class="w"> </span><span class="n">Strategies</span><span class="w"> </span><span class="p">(</span><span class="n">STRATEGIES</span><span class="p">)</span>
<span class="err">│</span><span class="w">       </span><span class="err">├──</span><span class="w"> </span><span class="n">logistic_regression_torch</span><span class="p">.</span><span class="n">py</span><span class="w">  </span><span class="p">#</span><span class="w"> </span><span class="n">Logistic</span><span class="w"> </span><span class="n">regression</span><span class="w"> </span><span class="n">strategy</span>
<span class="err">│</span><span class="w">       </span><span class="err">├──</span><span class="w"> </span><span class="n">lorentzian_classifier</span><span class="p">.</span><span class="n">py</span><span class="w">      </span><span class="p">#</span><span class="w"> </span><span class="n">Lorentzian</span><span class="w"> </span><span class="n">classifier</span><span class="w"> </span><span class="n">strategy</span>
<span class="err">│</span><span class="w">       </span><span class="err">├──</span><span class="w"> </span><span class="n">chandelier_exit</span><span class="p">.</span><span class="n">py</span><span class="w">            </span><span class="p">#</span><span class="w"> </span><span class="n">Risk</span><span class="w"> </span><span class="n">management</span><span class="w"> </span><span class="n">strategy</span><span class="w"> </span><span class="p">(</span><span class="mh">8</span><span class="n">KB</span><span class="p">,</span><span class="w"> </span><span class="mh">253</span><span class="w"> </span><span class="n">lines</span><span class="p">)</span>
<span class="err">│</span><span class="w">       </span><span class="err">└──</span><span class="w"> </span><span class="n">lag_based_strategy</span><span class="p">.</span><span class="n">py</span><span class="w">         </span><span class="p">#</span><span class="w"> </span><span class="n">Lag</span><span class="o">-</span><span class="n">based</span><span class="w"> </span><span class="n">strategy</span>
<span class="err">└──</span><span class="w"> </span><span class="n">indicators</span><span class="o">/</span><span class="w">                 </span><span class="p">#</span><span class="w"> </span><span class="n">Base</span><span class="w"> </span><span class="n">indicator</span><span class="w"> </span><span class="n">foundations</span>
<span class="w">    </span><span class="err">└──</span><span class="w"> </span><span class="n">base_torch_indicator</span><span class="p">.</span><span class="n">py</span>
</code></pre></div>

<h2>Key Distinction: Features vs Strategies</h2>
<h3>🎯 Features (<code>src/ml/features/</code>)</h3>
<p><strong>Purpose</strong>: Technical indicators used as <strong>input features</strong> for ML models
- <strong>What they do</strong>: Calculate technical indicator values (RSI, ADX, CCI, etc.)
- <strong>How they're used</strong>: As input features in ML model training and prediction
- <strong>Example</strong>: RSI value of 65, ADX value of 25, etc.</p>
<h3>🎯 Strategies (<code>src/ml/models/strategy/</code>)</h3>
<p><strong>Purpose</strong>: Trading strategies that generate buy/sell signals
- <strong>What they do</strong>: Use features to generate trading decisions
- <strong>How they're used</strong>: For actual trading decisions and risk management
- <strong>Example</strong>: Buy when RSI &lt; 30, sell when RSI &gt; 70</p>
<h2>Chandelier Exit: The Confusion Point</h2>
<h3>❌ WRONG: Using Chandelier Exit as a Feature</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># DON&#39;T DO THIS in ML models</span>
<span class="kn">from</span> <span class="nn">src.ml.features.chandelier_exit</span> <span class="kn">import</span> <span class="n">ChandelierExitIndicator</span>

<span class="c1"># Using it as a feature input</span>
<span class="n">chandelier</span> <span class="o">=</span> <span class="n">ChandelierExitIndicator</span><span class="p">()</span>
<span class="n">ce_feat</span> <span class="o">=</span> <span class="n">chandelier</span><span class="o">.</span><span class="n">calculate_signals</span><span class="p">(</span><span class="n">df</span><span class="p">)[</span><span class="s2">&quot;long&quot;</span><span class="p">]</span>  <span class="c1"># ❌ WRONG</span>
</code></pre></div>

<h3>✅ CORRECT: Using Chandelier Exit for Risk Management</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># DO THIS for risk management</span>
<span class="kn">from</span> <span class="nn">src.ml.models.strategy.chandelier_exit</span> <span class="kn">import</span> <span class="n">ChandelierExit</span>

<span class="c1"># Using it for stop losses and position management</span>
<span class="n">chandelier</span> <span class="o">=</span> <span class="n">ChandelierExit</span><span class="p">()</span>
<span class="n">stops</span> <span class="o">=</span> <span class="n">chandelier</span><span class="o">.</span><span class="n">calculate_signals</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>  <span class="c1"># ✅ CORRECT</span>
</code></pre></div>

<h2>File Size Guidelines</h2>
<h3>Features Folder</h3>
<ul>
<li><strong>chandelier_exit.py</strong>: ~13KB, ~346 lines (technical indicator implementation)</li>
<li><strong>rsi.py</strong>: ~11KB, ~349 lines</li>
<li><strong>adx.py</strong>: ~7.8KB, ~247 lines</li>
<li><strong>cci.py</strong>: ~8.1KB, ~261 lines</li>
<li><strong>wave_trend.py</strong>: ~10KB, ~322 lines</li>
</ul>
<h3>Strategy Folder</h3>
<ul>
<li><strong>chandelier_exit.py</strong>: ~8KB, ~253 lines (risk management strategy)</li>
<li><strong>logistic_regression_torch.py</strong>: ~18KB, ~536 lines</li>
<li><strong>lorentzian_classifier.py</strong>: ~21KB, ~603 lines</li>
</ul>
<h2>Correct Usage Patterns</h2>
<h3>1. ML Models Should Use Features</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># ✅ CORRECT: ML models use technical indicators as features</span>
<span class="kn">from</span> <span class="nn">src.ml.features.rsi</span> <span class="kn">import</span> <span class="n">RSIIndicator</span>
<span class="kn">from</span> <span class="nn">src.ml.features.adx</span> <span class="kn">import</span> <span class="n">ADXIndicator</span>
<span class="kn">from</span> <span class="nn">src.ml.features.cci</span> <span class="kn">import</span> <span class="n">CCIIndicator</span>
<span class="kn">from</span> <span class="nn">src.ml.features.wave_trend</span> <span class="kn">import</span> <span class="n">WaveTrendIndicator</span>

<span class="c1"># Calculate features for ML input</span>
<span class="n">rsi_feat</span> <span class="o">=</span> <span class="n">rsi</span><span class="o">.</span><span class="n">calculate_signals</span><span class="p">(</span><span class="n">df</span><span class="p">)[</span><span class="s2">&quot;rsi&quot;</span><span class="p">]</span>
<span class="n">adx_feat</span> <span class="o">=</span> <span class="n">adx</span><span class="o">.</span><span class="n">calculate_signals</span><span class="p">(</span><span class="n">df</span><span class="p">)[</span><span class="s2">&quot;adx&quot;</span><span class="p">]</span>
<span class="n">cci_feat</span> <span class="o">=</span> <span class="n">cci</span><span class="o">.</span><span class="n">calculate_signals</span><span class="p">(</span><span class="n">df</span><span class="p">)[</span><span class="s2">&quot;cci&quot;</span><span class="p">]</span>
<span class="n">wt_feat</span> <span class="o">=</span> <span class="n">wavetrend</span><span class="o">.</span><span class="n">calculate_signals</span><span class="p">(</span><span class="n">df</span><span class="p">)[</span><span class="s2">&quot;wt1&quot;</span><span class="p">]</span>
</code></pre></div>

<h3>2. Risk Management Should Use Strategies</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># ✅ CORRECT: Risk management uses strategy implementations</span>
<span class="kn">from</span> <span class="nn">src.ml.models.strategy.chandelier_exit</span> <span class="kn">import</span> <span class="n">ChandelierExit</span>

<span class="c1"># Calculate stop losses and risk management signals</span>
<span class="n">chandelier</span> <span class="o">=</span> <span class="n">ChandelierExit</span><span class="p">()</span>
<span class="n">risk_signals</span> <span class="o">=</span> <span class="n">chandelier</span><span class="o">.</span><span class="n">calculate_signals</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div>

<h2>Common Mistakes to Avoid</h2>
<h3>❌ Mistake 1: Importing Chandelier Exit as Feature in ML Models</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># WRONG - Don&#39;t import from features in strategy models</span>
<span class="kn">from</span> <span class="nn">src.ml.features.chandelier_exit</span> <span class="kn">import</span> <span class="n">ChandelierExitIndicator</span>
</code></pre></div>

<h3>❌ Mistake 2: Using Chandelier Exit Values as ML Features</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># WRONG - Don&#39;t use chandelier exit as input feature</span>
<span class="n">ce_feat</span> <span class="o">=</span> <span class="n">chandelier</span><span class="o">.</span><span class="n">calculate_signals</span><span class="p">(</span><span class="n">df</span><span class="p">)[</span><span class="s2">&quot;long&quot;</span><span class="p">]</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">rsi_feat</span><span class="p">,</span> <span class="n">adx_feat</span><span class="p">,</span> <span class="n">cci_feat</span><span class="p">,</span> <span class="n">ce_feat</span><span class="p">])</span>  <span class="c1"># ❌</span>
</code></pre></div>

<h3>❌ Mistake 3: Confusing File Sizes</h3>
<ul>
<li>If <code>chandelier_exit.py</code> in features is &gt;10KB, it's likely the indicator</li>
<li>If <code>chandelier_exit.py</code> in strategy is &lt;10KB, it's likely the strategy wrapper</li>
</ul>
<h2>Validation Checklist</h2>
<p>Before committing changes, verify:</p>
<ul>
<li>[ ] ML models only import from <code>src/ml/features/</code> for technical indicators</li>
<li>[ ] ML models do NOT import chandelier exit from features</li>
<li>[ ] Risk management imports from <code>src/ml/models/strategy/</code></li>
<li>[ ] File sizes match expected patterns</li>
<li>[ ] No circular imports between features and strategies</li>
</ul>
<h2>Recovery Steps</h2>
<p>If confusion occurs again:</p>
<ol>
<li><strong>Check file sizes</strong>: Features should be larger than strategy wrappers</li>
<li><strong>Check imports</strong>: ML models should not import chandelier exit from features</li>
<li><strong>Restore from backup</strong>: Use <code>/home/dex/ML-MODEL/src/</code> as backup reference</li>
<li><strong>Follow this guide</strong>: Use the patterns documented above</li>
</ol>
<h2>Related Documentation</h2>
<ul>
<li><a href="ML_MODEL.html">ML Model Architecture</a> - Overall ML model design</li>
<li><a href="INDICATORS.html">Technical Indicators</a> - Indicator implementations</li>
<li><a href="TECHNICAL_STRATEGY.html">Technical Strategy</a> - Strategy implementations </li>
</ul>
    </div>
</body>
</html>