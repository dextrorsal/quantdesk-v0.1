<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Pipeline - QuantDesk Documentation</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <style>
        body {
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace;
            line-height: 1.6;
            color: #ffffff;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #000000;
            font-size: 14px;
        }
        .container {
            background: #000000;
            padding: 30px;
            border-radius: 8px;
            border: 1px solid #333333;
        }
        .back-link {
            margin-bottom: 20px;
        }
        .back-link a {
            color: #3b82f6;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s ease;
        }
        .back-link a:hover {
            color: #60a5fa;
            text-decoration: underline;
        }
        h1, h2, h3, h4, h5, h6 {
            color: #ffffff;
            margin-top: 30px;
            margin-bottom: 15px;
            font-weight: 600;
        }
        h1 {
            border-bottom: 2px solid #333333;
            padding-bottom: 10px;
        }
        h2 {
            border-bottom: 1px solid #333333;
            padding-bottom: 8px;
        }
        code {
            background: #1a1a1a;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace;
            color: #ffffff;
            border: 1px solid #333333;
        }
        pre {
            background: #0a0a0a;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            border: 1px solid #333333;
            margin: 20px 0;
        }
        pre code {
            background: none;
            padding: 0;
            color: #ffffff;
            border: none;
        }
        blockquote {
            border-left: 4px solid #3b82f6;
            margin: 0;
            padding-left: 20px;
            color: #d9d9d9;
            background: #1a1a1a;
            padding: 15px 20px;
            border-radius: 0 8px 8px 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            border: 1px solid #333333;
        }
        th, td {
            border: 1px solid #333333;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #1a1a1a;
            font-weight: bold;
            color: #ffffff;
        }
        td {
            color: #d9d9d9;
        }
        ul, ol {
            color: #d9d9d9;
        }
        li {
            margin-bottom: 8px;
        }
        a {
            color: #3b82f6;
            text-decoration: none;
        }
        a:hover {
            color: #60a5fa;
            text-decoration: underline;
        }
        /* Syntax Highlighting Overrides */
        pre[class*="language-"] {
            background: #0a0a0a !important;
            border: 1px solid #333333 !important;
            border-radius: 8px !important;
            padding: 20px !important;
            margin: 20px 0 !important;
            font-family: 'JetBrains Mono', 'Monaco', 'Consolas', monospace !important;
            font-size: 13px !important;
            line-height: 1.5 !important;
        }
        .token.comment { color: #6a9955 !important; }
        .token.keyword { color: #569cd6 !important; }
        .token.string { color: #ce9178 !important; }
        .token.number { color: #b5cea8 !important; }
        .token.function { color: #dcdcaa !important; }
        .token.class-name { color: #4ec9b0 !important; }
        .token.operator { color: #d4d4d4 !important; }
        .token.punctuation { color: #d4d4d4 !important; }
        .token.variable { color: #9cdcfe !important; }
        .token.constant { color: #4fc1ff !important; }
    </style>
</head>
<body>
    <div class="container">
        <div class="back-link">
            <a href="/docs">&larr; Back to Documentation</a>
        </div>
        <h1>ðŸ”„ Neon Data Pipeline</h1>
<p><em>What is this doc?</em><br />
This guide explains how the data pipeline collects, processes, and stores trading data using Neon PostgreSQL. It's for anyone working with data ingestion, feature engineering, or database integration.</p>
<p><a href="ML_MODEL.html">ML Model</a> | <a href="MODEL_TRAINING.html">Model Training</a> | <a href="TROUBLESHOOTING.html">Troubleshooting</a> | <a href="../README.html">Project README</a></p>
<h2>Overview</h2>
<p>Our data pipeline integrates with Neon's PostgreSQL database to efficiently collect, process, and store cryptocurrency trading data. This document explains the pipeline architecture and usage.</p>
<h2>Table of Contents</h2>
<ol>
<li><a href="#data-flow">Data Flow</a></li>
<li><a href="#database-schema">Database Schema</a></li>
<li><a href="#pipeline-components">Pipeline Components</a></li>
<li><a href="#usage-examples">Usage Examples</a></li>
<li><a href="#performance-optimization">Performance Optimization</a></li>
</ol>
<h2>Data Flow</h2>
<div class="codehilite"><pre><span></span><code><span class="n">graph</span><span class="w"> </span><span class="n">LR</span>
<span class="w">    </span><span class="n">A</span><span class="p">[</span><span class="n">Market</span><span class="w"> </span><span class="n">Data</span><span class="p">]</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">Data</span><span class="w"> </span><span class="n">Collector</span><span class="p">]</span>
<span class="w">    </span><span class="n">B</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">C</span><span class="p">[</span><span class="n">Data</span><span class="w"> </span><span class="n">Processor</span><span class="p">]</span>
<span class="w">    </span><span class="n">C</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">D</span><span class="p">[</span><span class="n">Feature</span><span class="w"> </span><span class="n">Engineering</span><span class="p">]</span>
<span class="w">    </span><span class="n">D</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">E</span><span class="p">[</span><span class="n">Neon</span><span class="w"> </span><span class="n">Database</span><span class="p">]</span>
<span class="w">    </span><span class="n">E</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">F</span><span class="p">[</span><span class="n">Model</span><span class="w"> </span><span class="n">Training</span><span class="p">]</span>
<span class="w">    </span><span class="n">E</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">G</span><span class="p">[</span><span class="n">Real</span><span class="o">-</span><span class="n">time</span><span class="w"> </span><span class="n">Signals</span><span class="p">]</span>
</code></pre></div>

<h3>Process Steps</h3>
<ol>
<li><strong>Data Collection</strong>: Fetch OHLCV data from exchanges</li>
<li><strong>Processing</strong>: Clean and normalize data</li>
<li><strong>Feature Engineering</strong>: Calculate technical indicators</li>
<li><strong>Storage</strong>: Store in Neon database</li>
<li><strong>Retrieval</strong>: Efficient data access for training/inference</li>
</ol>
<h2>Database Schema</h2>
<h3>Price Data Table</h3>
<div class="codehilite"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">price_data</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">symbol</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="k">timestamp</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="k">open</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">high</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">low</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="k">close</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">volume</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="k">UNIQUE</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>

<h3>Model Predictions Table</h3>
<div class="codehilite"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">model_predictions</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="k">timestamp</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">symbol</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">prediction</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">confidence</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">model_version</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">price_data</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>

<h3>Trading Signals Table</h3>
<div class="codehilite"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">trading_signals</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="k">timestamp</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">symbol</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">signal</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">  </span><span class="c1">-- -1 (sell), 0 (neutral), 1 (buy)</span>
<span class="w">    </span><span class="n">strength</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="k">source</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">price_data</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>

<h2>Pipeline Components</h2>
<h3>1. Data Collector</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">src.data.pipeline.neon_collector</span> <span class="kn">import</span> <span class="n">NeonDataCollector</span>

<span class="k">class</span> <span class="nc">NeonDataCollector</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection_string</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">create_connection</span><span class="p">(</span><span class="n">connection_string</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">collect_historical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Collect historical data for a given symbol and date range&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">collect_realtime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stream real-time data for a given symbol&quot;&quot;&quot;</span>
        <span class="k">pass</span>
</code></pre></div>

<h3>2. Data Processor</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">DataProcessor</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">clean_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove outliers and handle missing values&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">normalize_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Normalize feature values&quot;&quot;&quot;</span>
        <span class="k">pass</span>
</code></pre></div>

<h3>3. Feature Calculator</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">FeatureCalculator</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">calculate_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate technical indicators and features&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">store_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Store calculated features in database&quot;&quot;&quot;</span>
        <span class="k">pass</span>
</code></pre></div>

<h2>Usage Examples</h2>
<h3>Historical Data Collection</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Initialize collector</span>
<span class="n">collector</span> <span class="o">=</span> <span class="n">NeonDataCollector</span><span class="p">(</span><span class="n">connection_string</span><span class="p">)</span>

<span class="c1"># Collect 30 days of BTC/USD data</span>
<span class="k">await</span> <span class="n">collector</span><span class="o">.</span><span class="n">collect_historical</span><span class="p">(</span>
    <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;BTC/USD&#39;</span><span class="p">,</span>
    <span class="n">start_date</span><span class="o">=</span><span class="s1">&#39;2024-01-01&#39;</span><span class="p">,</span>
    <span class="n">end_date</span><span class="o">=</span><span class="s1">&#39;2024-01-30&#39;</span>
<span class="p">)</span>
</code></pre></div>

<h3>Real-time Processing</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Initialize pipeline components</span>
<span class="n">collector</span> <span class="o">=</span> <span class="n">NeonDataCollector</span><span class="p">(</span><span class="n">connection_string</span><span class="p">)</span>
<span class="n">processor</span> <span class="o">=</span> <span class="n">DataProcessor</span><span class="p">()</span>
<span class="n">calculator</span> <span class="o">=</span> <span class="n">FeatureCalculator</span><span class="p">()</span>

<span class="c1"># Start real-time processing</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">process_realtime</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">collector</span><span class="o">.</span><span class="n">collect_realtime</span><span class="p">(</span><span class="s1">&#39;BTC/USD&#39;</span><span class="p">):</span>
        <span class="n">cleaned_data</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">clean_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">calculator</span><span class="o">.</span><span class="n">calculate_features</span><span class="p">(</span><span class="n">cleaned_data</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">calculator</span><span class="o">.</span><span class="n">store_features</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
</code></pre></div>

<h2>Performance Optimization</h2>
<h3>1. Batch Processing</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">batch_insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Insert data in batches for better performance&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">):</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</code></pre></div>

<h3>2. Indexing Strategy</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Create indexes for common queries</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_price_data_symbol_timestamp</span><span class="w"> </span>
<span class="k">ON</span><span class="w"> </span><span class="n">price_data</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span><span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_predictions_timestamp</span><span class="w"> </span>
<span class="k">ON</span><span class="w"> </span><span class="n">model_predictions</span><span class="p">(</span><span class="k">timestamp</span><span class="p">);</span>
</code></pre></div>

<h3>3. Query Optimization</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">get_training_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">timeframe</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Optimized query for training data retrieval&quot;&quot;&quot;</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        SELECT p.*, m.prediction, t.signal</span>
<span class="s2">        FROM price_data p</span>
<span class="s2">        LEFT JOIN model_predictions m </span>
<span class="s2">            ON p.symbol = m.symbol </span>
<span class="s2">            AND p.timestamp = m.timestamp</span>
<span class="s2">        LEFT JOIN trading_signals t </span>
<span class="s2">            ON p.symbol = t.symbol </span>
<span class="s2">            AND p.timestamp = t.timestamp</span>
<span class="s2">        WHERE p.symbol = </span><span class="si">%s</span><span class="s2"> </span>
<span class="s2">        AND p.timestamp &gt;= </span><span class="si">%s</span>
<span class="s2">        ORDER BY p.timestamp</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">timeframe</span><span class="p">))</span>
</code></pre></div>

<h2>Monitoring and Maintenance</h2>
<h3>1. Data Quality Checks</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">validate_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform data quality validation&quot;&quot;&quot;</span>
    <span class="n">checks</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;missing_values&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
        <span class="s1">&#39;duplicates&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
        <span class="s1">&#39;price_range&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
        <span class="s1">&#39;volume_positive&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">checks</span>
</code></pre></div>

<h3>2. Performance Metrics</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">monitor_pipeline_performance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Monitor pipeline performance metrics&quot;&quot;&quot;</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;insertion_rate&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_insertion_rate</span><span class="p">(),</span>
        <span class="s1">&#39;query_latency&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_query_latency</span><span class="p">(),</span>
        <span class="s1">&#39;data_freshness&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_data_freshness</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">metrics</span>
</code></pre></div>

<h3>3. WebSocket Connection Management</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">handle_websocket_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Properly manage WebSocket connections&quot;&quot;&quot;</span>
    <span class="c1"># Initialize WebSocket with proper callbacks</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="n">websocket</span><span class="o">.</span><span class="n">WebSocketApp</span><span class="p">(</span>
        <span class="s2">&quot;wss://stream.binance.com:9443/ws/solusdt@kline_1m&quot;</span><span class="p">,</span>
        <span class="n">on_message</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_message</span><span class="p">,</span>
        <span class="n">on_error</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_error</span><span class="p">,</span>
        <span class="n">on_close</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_close</span><span class="p">,</span>
        <span class="n">on_open</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_open</span><span class="p">,</span>
        <span class="n">on_ping</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_ping</span>
    <span class="p">)</span>

    <span class="c1"># Implement ping/pong for connection maintenance</span>
    <span class="k">def</span> <span class="nf">on_ping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wsapp</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle ping frames by responding with pong&quot;&quot;&quot;</span>
        <span class="n">wsapp</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">websocket</span><span class="o">.</span><span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_PONG</span><span class="p">)</span>

    <span class="c1"># Implement reconnection with backoff</span>
    <span class="k">def</span> <span class="nf">reconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reconnect with exponential backoff&quot;&quot;&quot;</span>
        <span class="n">attempts</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">attempts</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_reconnect_attempts</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">attempts</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start_websocket</span><span class="p">()</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reconnection attempt </span><span class="si">{</span><span class="n">attempts</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">attempts</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>

<h3>4. Error Handling</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">PipelineError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom exception for pipeline errors&quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">handle_pipeline_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handle pipeline errors gracefully&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="ne">ConnectionError</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconnect</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">DataValidationError</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_validation_error</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">PipelineError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unhandled error: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<p><em>This documentation provides a comprehensive overview of our Neon data pipeline implementation. For specific questions or issues, please refer to the relevant sections or contact the development team.</em> </p>
<h2>See Also</h2>
<ul>
<li><a href="../README.html">Project README</a> â€” Project overview and structure</li>
<li><a href="ML_MODEL.html">ML Model Architecture</a> â€” How data flows into the model</li>
<li><a href="MODEL_TRAINING.html">Model Training Guide</a> â€” Using the pipeline for training</li>
<li><a href="TROUBLESHOOTING.html">Troubleshooting Guide</a> â€” Database and connection issues</li>
<li><a href="../src/data/pipeline/neon_collector.py">src/data/pipeline/neon_collector.py</a> â€” Main data collector code</li>
<li><a href="../src/data/processors/">src/data/processors/</a> â€” Data processing code</li>
<li><a href="../src/features/">src/features/</a> â€” Feature engineering code </li>
</ul>
    </div>
</body>
</html>